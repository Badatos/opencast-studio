{"version":3,"sources":["util.js","recording-context.js","ui/about.js","ui/navigation.js","ui/opencast-header.js","ui/studio/steps.js","ui/studio/capturer.js","ui/studio/elements.js","ui/notification.js","ui/studio/audio-setup/preview-audio.js","ui/studio/audio-setup/index.js","opencast-api.js","ui/studio/save-creation/form-field.js","ui/studio/save-creation/recording-preview.js","ui/studio/save-creation/index.js","ui/studio/video-setup/preview.js","ui/studio/video-setup/index.js","ui/studio/recording/media-device.js","ui/studio/recording/media-devices.js","recorder.js","ui/studio/recording/recording-buttons.js","ui/studio/recording/clock.js","ui/studio/recording/recording-controls.js","ui/studio/recording/index.js","ui/studio/page.js","languages.js","ui/settings/elements.js","ui/settings/language.js","ui/settings/opencast.js","ui/settings/page.js","ui/warnings.js","App.js"],"names":["isDisplayCaptureSupported","navigator","mediaDevices","test","platform","userAgent","isUserCaptureSupported","reducer","state","action","type","audioStream","payload","audioAllowed","displayStream","displayAllowed","userStream","userAllowed","recordings","Error","stateContext","createContext","dispatchContext","Provider","children","useReducer","audioSupported","displaySupported","userSupported","dispatch","value","useDispatch","useContext","useRecordingState","property","Code","props","sx","background","color","borderWidth","borderStyle","borderColor","borderLeftWidth","borderLeftColor","fontFamily","lineHeight","my","px","py","maxWidth","overflow","pageBreakInside","wordWrap","Impressum","h2","p","h3","icon","faGlobeEurope","a","href","faEnvelope","faPhone","About","h1","process","aria-label","NavElement","target","rest","attrs","pl","pr","textDecoration","fontSize","height","borderLeft","theme","colors","gray","display","width","backgroundColor","inner","textAlign","mr","startsWith","to","exact","activeStyle","Navigation","useState","isOpened","updateIsOpened","closeMenu","t","useTranslation","onClick","border","borderRadius","mx","whiteSpace","faTimes","faCaretDown","ml","ref","n","style","scrollHeight","zIndex","top","heights","headerHeight","position","transition","scrollX","faVideo","faWrench","faInfoCircle","faGithub","opacity","bottom","left","right","BetaBubble","verticalAlign","padding","Brand","media","srcSet","src","alt","OpencastHeader","justifyContent","Steps","activeStep","updateActiveStep","childProps","currentStep","totalSteps","length","nextStep","setActiveStep","previousStep","goToStep","firstStep","lastStep","childrenWithProps","React","Children","map","child","i","isActive","isReactComponent","cloneElement","Fragment","step","next","isInvalidStep","console","error","deviceId","getUserMedia","audio","video","stream","getTracks","forEach","track","onended","startDisplayCapture","displayMediaOptions","getDisplayMedia","defaultUserConstraints","ideal","max","startUserCapture","userMediaOptions","constraints","stopAudioCapture","stop","ActionButtons","prev","alignItems","mt","flex","disabled","faCaretLeft","faCaretRight","Notification","isDanger","marginBottom","PreviewAudio","canvasRef","useRef","useThemeUI","useEffect","canvas","current","ctx","getContext","lineWidth","strokeStyle","source","window","AudioContext","webkitAudioContext","createMediaStreamSource","scope","Oscilloscope","fftSize","animate","bg","m","mb","AudioSetup","choice","updateChoice","nextIsDisabled","backToSetupVideo","useCallback","enterStudio","flexDirection","maxHeight","faMicrophone","label","selected","startAudioCapture","then","success","as","variant","faMicrophoneSlash","OptionButton","selectedStyle","size","OpencastAPI","settings","this","server_url","serverUrl","endsWith","slice","workflow_id","workflowId","username","loginName","password","loginPassword","login","validateState","onsuccess","onloginfailed","onserverunreachable","oninetorpermfailed","title","creator","isLoggedIn","uploadFromRecordings","onnotloggedin","getMediaPackage","mp","dc","DOMParser","parseFromString","dc_created","getElementsByTagName","dc_creator","dc_title","textContent","Date","now","toISOString","addDCCatalog","data","XMLSerializer","serializeToString","deviceType","trackFlavor","downloadName","addTrack","ingest","getMeInfo","me_info_json","me_info","url","axios","method","withCredentials","get","responseType","flavor","FormData","append","track_filename","tags","FormField","fontWeight","boxSizing","clear","RecordingPreview","margin","svg","download","rel","autoPlay","muted","transform","faFileDownload","Input","initialState","recordingData","presenter","uploading","uploaded","name","SaveCreation","handleInputChange","event","checked","uploadPossible","areSettingsComplete","opencast","onBeforeunload","preventDefault","autoComplete","onChange","overflowY","flexWrap","recording","index","key","button","minWidth","i18nKey","loginAndUpload","filter","Boolean","err","faUpload","faTrash","SourcePreview","preview","reselectSource","warnings","inputs","hideUnshare","input","allowed","StreamPreview","text","gap","columns","minHeight","handleClick","getVideoTracks","getSettings","PreviewVideo","videoRef","srcObject","faExclamationTriangle","UnshareButton","VideoSetup","body","hasStreams","anySupported","bothSupported","activeSource","setActiveSource","USER_CONSTRAINTS","facingMode","clickUser","clickDisplay","clickBoth","stopDisplayCapture","stopUserCapture","stopCapture","nextDisabled","userWarning","displayWarning","faChalkboard","faChalkboardTeacher","faUser","MediaDevice","data-title","boxShadow","cursor","outline","MediaDevices","faDesktop","Recorder","options","mimeType","undefined","_recData","recorder","MediaRecorder","ondataavailable","e","push","onerror","onError","onstop","Blob","URL","createObjectURL","onStop","isRecording","isPaused","start","pause","resume","Button","large","PauseButton","className","faPauseCircle","RecordButton","countdown","faCircleNotch","faCircle","spin","ResumeButton","faPlayCircle","StopButton","faStopCircle","Clock","milliseconds","setInterval","tick","stopTimer","timerId","clearInterval","prevProps","resumeTimer","passed","setState","duration","timeArr","content","unit","join","Component","addRecordOnStop","mixAudioIntoVideo","videoStream","getAudioTracks","MediaStream","RecordingControls","handleRecorded","handleStart","setCountdown","recordingState","setRecordingState","desktopRecorder","videoRecorder","setTimeout","record","Recording","setIsRecording","backToAudio","flexGrow","Wizard","audioChoice","updateAudioChoice","languages","short","long","rtl","errors","register","required","aria-invalid","aria-describedby","id","SettingsSection","borderBottom","pb","LanguageSettings","i18n","defaultValue","language","changeLanguage","OpencastSettings","settingsManager","setError","useForm","defaultValues","formValues","handleSubmit","status","setStatus","hasRecording","ocUploader","checkConnection","saveSettings","log","fixedServerUrl","isFixed","fixedWorkflowId","fixedLoginName","fixedLoginPassword","testing","faExclamationCircle","saved","faCheckCircle","onSubmit","SettingsPage","Warnings","location","protocol","hostname","App","updateSettings","newSettings","basename","path"],"mappings":"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","file":"static/js/4.04433b8c.chunk.js","sourcesContent":["// Checks if we app is running on a mobile device.\n//\n// This check could be more exhaustive, but this includes all browser we\n// officially support.\nexport const onMobileDevice = () =>\n  /Android|iPhone|iPad|iPod/i.test(navigator.platform) ||\n  /Android/i.test(navigator.userAgent);\n\n// Checks if the client supports capturing the device's display (or individual\n// windows).\n//\n// Detecting whether display capture is supported is hard. There is currently\n// no proper solution. See these two links for more information:\n// - https://stackoverflow.com/q/58842831/2408867\n// - https://github.com/w3c/mediacapture-screen-share/issues/127\n//\n// To work around this problem, we simply check if the browser runs on a\n// mobile device. Currently, no mobile device/browser supports display\n// capture. However, this will probably change in the future, so we have to\n// revisit this issue again. This is tracked in this issue:\n// https://github.com/elan-ev/opencast-studio/issues/204\nexport const isDisplayCaptureSupported = () =>\n  \"mediaDevices\" in navigator &&\n  \"getDisplayMedia\" in navigator.mediaDevices &&\n  !onMobileDevice();\n\n// Checks if the client supports capturing \"user devices\" (usually webcams or\n// phone cameras).\nexport const isUserCaptureSupported = () =>\n  'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;\n\n// Checks if the browsers supports the `MediaRecorder` API required to actually\n// record the media streams.\nexport const isRecordingSupported = () => typeof MediaRecorder !== 'undefined';\n\n// Checks if this runs in Safari.\nexport const onSafari = () => /Safari/i.test(navigator.userAgent);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { createContext, useContext, useReducer } from 'react';\nimport { isDisplayCaptureSupported, isUserCaptureSupported } from './util';\n\nconst initialState = () => ({\n  audioAllowed: null,\n  audioStream: null,\n  audioSupported: isUserCaptureSupported(),\n\n  displayAllowed: null,\n  displayStream: null,\n  displaySupported: isDisplayCaptureSupported(),\n\n  userAllowed: null,\n  userStream: null,\n  userSupported: isUserCaptureSupported(),\n\n  recordings: []\n});\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'SHARE_AUDIO':\n      return { ...state, audioStream: action.payload, audioAllowed: true };\n\n    case 'BLOCK_AUDIO':\n      return { ...state, audioStream: null, audioAllowed: false };\n\n    case 'UNSHARE_AUDIO':\n      return { ...state, audioStream: null };\n\n    case 'SHARE_DISPLAY':\n      return { ...state, displayStream: action.payload, displayAllowed: true };\n\n    case 'BLOCK_DISPLAY':\n      return { ...state, displayStream: null, displayAllowed: false };\n\n    case 'UNSHARE_DISPLAY':\n      return { ...state, displayStream: null };\n\n    case 'SHARE_USER':\n      return { ...state, userStream: action.payload, userAllowed: true };\n\n    case 'BLOCK_USER':\n      return { ...state, userStream: null, userAllowed: false };\n\n    case 'UNSHARE_USER':\n      return { ...state, userStream: null };\n\n    case 'ADD_RECORDING':\n      return { ...state, recordings: [...state.recordings, action.payload] };\n\n    case 'CLEAR_RECORDINGS':\n      return { ...state, recordings: [] };\n\n    default:\n      throw new Error();\n  }\n};\n\nconst stateContext = createContext(null);\nconst dispatchContext = createContext(null);\n\nexport const Provider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState());\n\n  return (\n    <dispatchContext.Provider value={dispatch}>\n      <stateContext.Provider value={state}>{children}</stateContext.Provider>\n    </dispatchContext.Provider>\n  );\n};\n\nexport const useDispatch = () => useContext(dispatchContext);\n\nexport const useRecordingState = (property = null) => {\n  const state = useContext(stateContext);\n  return property !== null ? state[property] : state;\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\nimport { Box, Container } from '@theme-ui/components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faGlobeEurope, faEnvelope, faPhone } from '@fortawesome/free-solid-svg-icons';\n\nconst Code = props => (\n  <Box\n    sx={{\n      background: 'gray.2',\n      color: 'gray.1',\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: 'gray.2',\n      borderLeftWidth: 3,\n      borderLeftColor: 'primary',\n      fontFamily: 'monospace',\n      lineHeight: 'body',\n      my: 3,\n      px: 3,\n      py: 2,\n      maxWidth: '100%',\n      overflow: 'auto',\n      pageBreakInside: 'avoid',\n      wordWrap: 'break-word'\n    }}\n    {...props}\n  />\n);\n\nfunction Impressum() {\n  return (\n    <article>\n      <Styled.h2>ELAN e.V.</Styled.h2>\n\n      <Styled.p>\n        The e-learning academic network (ELAN e.V.) is a German non-profit organization supporting\n        higher-education organizations in all matters related to e-learning. Our services include\n        practical tips about how to use digital technologies in education, legal advice and\n        development of free, open-source software to support education.\n      </Styled.p>\n\n      <Styled.h3>Contact</Styled.h3>\n\n      <Styled.p>\n        Dr. Norbert Kleinefeld, Geschäftsführer\n        <br />\n        Karlstr. 23\n        <br />\n        D-26123 Oldenburg\n      </Styled.p>\n\n      <Styled.p>\n        <FontAwesomeIcon icon={faGlobeEurope} />{' '}\n        <Styled.a href=\"https://elan-ev.de\">elan-ev.de</Styled.a>\n        <br />\n        <FontAwesomeIcon icon={faEnvelope} />{' '}\n        <Styled.a href=\"mailto:kontakt@elan-ev.de\">kontakt@elan-ev.de</Styled.a>\n        <br />\n        <FontAwesomeIcon icon={faPhone} />{' '}\n        <Styled.a href=\"tel:+4944199866610\">+49&thinsp;441 998&thinsp;666&thinsp;10</Styled.a>\n      </Styled.p>\n\n      <Styled.p>\n        Registergericht: Amtsgericht Oldenburg\n        <br />\n        Registernummer: VR 200644\n        <br />\n        USt.-ID-Nr.: DE 265901392\n      </Styled.p>\n    </article>\n  );\n}\n\nfunction About(props) {\n  return (\n    <Container>\n      <article>\n        <header>\n          <Styled.h1>Opencast Studio</Styled.h1>\n        </header>\n        <Styled.p>\n          A web-based recording studio for <Styled.a href=\"https://opencast.org\">Opencast</Styled.a>\n          .\n        </Styled.p>\n        <Styled.p>\n          This is free software under the terms of the{' '}\n          <Styled.a href=\"https://github.com/elan-ev/opencast-studio/blob/master/LICENSE\">\n            MIT License\n          </Styled.a>{' '}\n          developed by the <Styled.a href=\"https://elan-ev.de\">ELAN e.V.</Styled.a> in cooperation\n          with the <Styled.a href=\"https://ethz.ch\">ETH Zürich</Styled.a>.\n          {\" Please report bugs or submit new features on the project's \"}\n          <Styled.a href=\"https://github.com/elan-ev/opencast-studio\">GitHub page</Styled.a>.\n        </Styled.p>\n        <Styled.p>\n          If you are interested in additional development or integrations into specific tools (e.g.\n          LMS), please contact{' '}\n          <Styled.a href=\"mailto:opencast-support@elan-ev.de\">opencast-support@elan-ev.de</Styled.a>\n          .\n        </Styled.p>\n        <Styled.h2>How it works</Styled.h2>\n        <Styled.p>\n          {`Opencast Studio uses the recording capabilities build into browsers to record audio and video streams.\n            The recording happens in the user's browser.\n            No server is involved in the recording.\n            Finally, the recording is transferred directly from the users browser to the target Opencast.`}\n        </Styled.p>\n        <Styled.h2>Allow Studio to interact with your Opencast</Styled.h2>\n        <Styled.p>\n          For Studio to work with your Opencast, your need to allow this on your Opencast by serving\n          a special HTTP header. The mechanism used is called{' '}\n          <Styled.a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">\n            Cross-Origin Resource Sharing\n          </Styled.a>\n          .\n        </Styled.p>\n        <Styled.p>\n          {\"Here is a list of the required headers in Nginx's configuration format:\"}\n        </Styled.p>\n        <Code>\n          # Basic open CORS for studio.opencast.org\n          <br />\n          add_header Access-Control-Allow-Origin https://studio.opencast.org;\n          <br />\n          {\"add_header Access-Control-Allow-Methods 'GET, POST';\"}\n          <br />\n          add_header Access-Control-Allow-Credentials true;\n          <br />\n          {\"add_header Access-Control-Allow-Headers 'Origin,Content-Type,Accept,Authorization';\"}\n        </Code>\n        <Styled.p>\n          For a complete configuration file, take a look at the{' '}\n          <Styled.a href=\"https://github.com/opencast/opencast-project-infrastructure/blob/9f09638e922d623cd4d3c91dd90aca39c421530d/ansible-allinone-demo-vm/roles/nginx/templates/nginx.conf#L158-L162\">\n            test server configuration\n          </Styled.a>\n          .\n        </Styled.p>\n\n        <Styled.h2>Credits</Styled.h2>\n        <Styled.p>\n          Thanks to the following people and institutions for contributing to this project:\n        </Styled.p>\n        <ul>\n          <li>\n            <Styled.a href=\"https://github.com/slampunk\">Duncan Smith</Styled.a> for starting this\n            project\n          </li>\n          <li>\n            <Styled.a href=\"https://github.com/cilt-uct\">University of Cape Town (CILT)</Styled.a>\n            {' '}for letting Duncan start the project\n          </li>\n          <li>\n            <Styled.a href=\"https://ethz.ch\">ETH Zürich</Styled.a> for financial support and\n            testing\n          </li>\n          <li>\n            <Styled.a href=\"https://github.com/elan-ev\">ELAN e.V.</Styled.a> for the final\n            development\n          </li>\n        </ul>\n\n        <Impressum />\n\n        <Styled.h2>Version</Styled.h2>\n        <Styled.p>\n          Build date {process.env.REACT_APP_BUILD_DATE || '?'},\n          commit{' '}\n          <Styled.a\n            aria-label=\"Git commit on GitHub\"\n            href={\"https://github.com/elan-ev/opencast-studio/commit/\"\n                  + process.env.REACT_APP_GIT_SHA }\n            >\n            {process.env.REACT_APP_GIT_SHA || '?'}\n          </Styled.a>.\n        </Styled.p>\n      </article>\n    </Container>\n  );\n}\n\nexport default About;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { NavLink } from 'react-router-dom';\nimport { Fragment, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCaretDown,\n  faTimes,\n  faWrench,\n  faInfoCircle,\n  faVideo,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { faGithub } from '@fortawesome/free-brands-svg-icons';\n\n\n// One element (link) in the navigation.\nconst NavElement = ({ target, children, icon, ...rest }) => {\n  const attrs = {\n    sx: {\n      color: 'white',\n      pl: [3, 3, '10px'],\n      pr: [3, 3, '14px'],\n      textDecoration: 'none',\n      fontSize: '18px',\n      height: ['auto', 'auto', '100%'],\n      borderLeft: ['none', 'none', theme => `1px solid ${theme.colors.gray[3]}`],\n      display: ['block', 'block', 'inline-block'],\n      width: ['100%', '100%', 'auto'],\n\n      '&:hover': {\n        backgroundColor: 'gray.1',\n      },\n    },\n    ...rest\n  };\n\n  const inner = (\n    <Fragment>\n      <div sx={{\n        width: '20px',\n        display: 'inline-block',\n        textAlign: 'right',\n        mr: [3, 3, 2],\n      }}>\n        <FontAwesomeIcon icon={icon} />\n      </div>\n      {children}\n    </Fragment>\n  );\n\n  if (target.startsWith('/')) {\n    return (\n      <NavLink\n        to={target}\n        exact\n        activeStyle={{\n          backgroundColor: 'black',\n        }}\n        {...attrs}\n      >{inner}</NavLink>\n    );\n  } else {\n    return <a href={target} {...attrs}>{inner}</a>\n  }\n};\n\n// The whole responsive navigation element.\nconst Navigation = props => {\n  const [isOpened, updateIsOpened] = useState(false);\n  const toggleMenu = () => updateIsOpened(!isOpened);\n  const closeMenu = () => updateIsOpened(false);\n  const { t } = useTranslation();\n\n  return (\n    <Fragment>\n      <button\n        onClick={toggleMenu}\n        sx={{\n          display: ['inline-block', 'inline-block', 'none'],\n          border: theme => `2px solid ${theme.colors.gray[3]}`,\n          borderRadius: '10px',\n          color: 'white',\n          my: 1,\n          px: 3,\n          mx: 1,\n          fontSize: '20px',\n          whiteSpace: 'nowrap',\n          backgroundColor: 'transparent',\n          '&:hover': {\n            backgroundColor: 'gray.1',\n          },\n          '&:active': {},\n        }}\n      >\n        {t('nav-open-menu-button')}\n        <span sx={{ width: '23px', display: 'inline-block' }}>\n          <FontAwesomeIcon\n            icon={isOpened ? faTimes : faCaretDown}\n            sx={{ ml: '10px' }}\n          />\n        </span>\n      </button>\n      <nav\n        ref={n => {\n          if (n) {\n            n.style.height = isOpened ? n.scrollHeight + 'px' : \"\";\n          }\n        }}\n        sx={{\n          overflow: 'hidden',\n          zIndex: 10,\n          // This \"!important\" is necessary unfortunately to override the inline\n          // style set in the `ref` attribute above. Otherwise opening the menu\n          // in mobile view and switching to desktop view (e.g. by rotating\n          // phone) would result in a very strange artifact.\n          height: ['0px', '0px', '100% !important'],\n          top: [theme => theme.heights.headerHeight, theme => theme.heights.headerHeight, 0],\n          position: ['absolute', 'absolute', 'static'],\n          width: ['100%', '100%', 'auto'],\n          backgroundColor: ['gray.0', 'gray.0', 'none'],\n          transition: ['height 0.25s ease-out 0s', 'height 0.25s ease-out 0s', 'none'],\n          scrollX: ['none', 'none', 'auto'],\n        }}\n      >\n        <NavElement target=\"/\" icon={faVideo} onClick={closeMenu}>\n          {t('nav-recording')}\n        </NavElement>\n        <NavElement target=\"/settings\" icon={faWrench} onClick={closeMenu}>\n          {t('nav-settings')}\n        </NavElement>\n        <NavElement target=\"/about\" icon={faInfoCircle} onClick={closeMenu}>\n          {t('nav-about')}\n        </NavElement>\n        <NavElement\n          target=\"https://github.com/elan-ev/opencast-studio/issues\"\n          icon={faGithub}\n          onClick={closeMenu}\n        >\n          {t('nav-report-issue')}\n        </NavElement>\n      </nav>\n\n      {/* A black, half-transparent overlay over the body */}\n      {isOpened && <div\n        onClick={closeMenu}\n        ref={n => n && (n.style.opacity = 1)}\n        sx={{\n          display: [isOpened ? 'block' : 'none', isOpened ? 'block' : 'none', 'none'],\n          backgroundColor: 'rgba(0, 0, 0, 0.7)',\n          position: 'fixed',\n          zIndex: -10,\n          top: 0,\n          bottom: 0,\n          left: 0,\n          right: 0,\n          opacity: 0,\n          transition: 'opacity 0.25s ease-out 0s',\n        }}\n      ></div>}\n    </Fragment>\n  );\n};\n\nexport default Navigation;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Link } from 'react-router-dom';\n\nimport Navigation from './navigation';\n\nconst BetaBubble = props => (\n  <span\n    sx={{\n      position: 'relative',\n      top: '4px',\n      fontSize: '12pt',\n      verticalAlign: 'top',\n      display: ['none', 'inline'],\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: 'gray.2',\n      borderRadius: 5,\n      padding: '2px',\n      color: 'gray.2'\n    }}\n    {...props}\n  />\n);\n\nfunction Brand() {\n  return (\n    <span>\n      <Link to=\"/\">\n        <picture>\n          <source\n            media=\"(min-width: 920px)\"\n            srcSet={`${process.env.PUBLIC_URL}/opencast-studio.svg`}\n          />\n          <img\n            src={`${process.env.PUBLIC_URL}/opencast-studio-small.svg`}\n            alt=\"Opencast Studio\"\n            sx={{ height: 50 }}\n          />\n        </picture>\n      </Link>\n\n      <BetaBubble>beta</BetaBubble>\n    </span>\n  );\n}\n\nfunction OpencastHeader() {\n  return (\n    <header\n      sx={{\n        height: theme => theme.heights.headerHeight,\n        lineHeight: theme => theme.heights.headerHeight,\n        color: 'background',\n        display: 'flex',\n        justifyContent: 'space-between',\n        position: 'relative',\n        zIndex: 3,\n      }}\n    >\n      {/* This div is used just for the background color. We can't set it for\n          the parent element, as the navigation overlay would otherwise occlude\n          this background color */}\n      <div sx={{\n        backgroundColor: 'gray.0',\n        position: 'absolute',\n        zIndex: -3,\n        height: '100%',\n        width: '100%',\n      }}></div>\n      <Brand />\n\n      <Navigation />\n    </header>\n  );\n}\n\nexport default OpencastHeader;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport React from 'react';\n\nexport default function Steps({ activeStep, updateActiveStep, ...props }) {\n  const childProps = {\n    currentStep: activeStep + 1,\n    totalSteps: props.children?.length || 0,\n    nextStep,\n    previousStep,\n    goToStep,\n    firstStep,\n    lastStep\n  };\n\n  const childrenWithProps = React.Children.map(props.children, (child, i) => {\n    childProps.isActive = i === activeStep;\n\n    return childProps.isActive\n      ? isReactComponent(child)\n        ? React.cloneElement(child, childProps)\n        : child\n      : null;\n  });\n\n  return <React.Fragment>{childrenWithProps}</React.Fragment>;\n\n  function firstStep() {\n    goToStep(1);\n  }\n\n  function lastStep() {\n    goToStep(props.children.length);\n  }\n\n  function nextStep() {\n    setActiveStep(activeStep + 1);\n  }\n\n  function previousStep() {\n    setActiveStep(activeStep - 1);\n  }\n\n  function goToStep(step) {\n    setActiveStep(step - 1);\n  }\n\n  function setActiveStep(next) {\n    if (activeStep === next) {\n      return;\n    }\n    if (isInvalidStep(next, props.children)) {\n      console.error(`${next + 1} is an invalid step`);\n      return;\n    }\n\n    updateActiveStep(next);\n  }\n}\n\nfunction isInvalidStep(next, children) {\n  return next < 0 || next >= children.length;\n}\n\nfunction isReactComponent({ type }) {\n  return typeof type === 'function' || typeof type === 'object';\n}\n","export async function startAudioCapture(dispatch, deviceId = null) {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: deviceId ? { deviceId } : true,\n      video: false\n    });\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'UNSHARE_AUDIO' });\n      };\n    });\n\n    dispatch({ type: 'SHARE_AUDIO', payload: stream });\n    return true;\n  } catch (err) {\n    // TODO: there several types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_AUDIO' });\n    return false;\n  }\n}\n\nexport async function startDisplayCapture(\n  dispatch,\n  displayMediaOptions = { video: true, audio: false }\n) {\n  try {\n    const stream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'UNSHARE_DISPLAY' });\n      };\n    });\n\n    dispatch({ type: 'SHARE_DISPLAY', payload: stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_DISPLAY' });\n  }\n}\n\nconst defaultUserConstraints = {\n  audio: true,\n  video: {\n    width: { ideal: 1280, max: 1920 },\n    height: { ideal: 720, max: 1080 }\n  }\n};\n\nexport async function startUserCapture(dispatch, userMediaOptions = null) {\n  const constraints = userMediaOptions || defaultUserConstraints;\n\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'UNSHARE_USER' });\n      };\n    });\n    dispatch({ type: 'SHARE_USER', payload: stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_USER' });\n  }\n}\n\n// ----------------------------------------------------------------------------\n\nexport function stopCapture({ audioStream, displayStream, userStream }, dispatch) {\n  stopAudioCapture(audioStream, dispatch);\n  stopDisplayCapture(displayStream, dispatch);\n  stopUserCapture(userStream, dispatch);\n}\n\nexport function stopAudioCapture(stream, dispatch) {\n  stream && stream.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_AUDIO' });\n}\n\nexport function stopDisplayCapture(stream, dispatch) {\n  stream && stream.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_DISPLAY' });\n}\n\nexport function stopUserCapture(stream, dispatch) {\n  stream && stream.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_USER' });\n}\n\n// ----------------------------------------------------------------------------\n\nexport function addAudioToStream(videoStream, audioStream, dispatch, actionType) {\n  if (videoStream) {\n    videoStream.getAudioTracks().forEach(track => track.stop());\n\n    const streamWithAudio = new MediaStream([\n      ...videoStream.getVideoTracks(),\n      ...audioStream.getAudioTracks()\n    ]);\n    dispatch({ type: actionType, payload: streamWithAudio });\n  }\n}\n\nexport function removeAudioFromStream(stream, dispatch, actionType) {\n  if (stream) {\n    stream.getAudioTracks().forEach(track => track.stop());\n    const streamWithoutAudio = new MediaStream([...stream.getVideoTracks()]);\n    dispatch({ type: actionType, payload: streamWithoutAudio });\n  }\n}\n\n// ----------------------------------------------------------------------------\n\nexport async function selectCamera(dispatch, deviceId) {\n  const constraints = { ...defaultUserConstraints, video: { deviceId } };\n  startUserCapture(dispatch, constraints);\n}\n\nexport async function selectMicrophone(dispatch, deviceId) {\n  const constraints = { ...defaultUserConstraints, audio: { deviceId } };\n  startUserCapture(dispatch, constraints);\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCaretLeft, faCaretRight } from '@fortawesome/free-solid-svg-icons';\nimport { Box, Button, Flex } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\n\n// A div containing optional \"back\" and \"next\" buttons as well as the centered\n// children. The props `prev` and `next` are objects with the fields `onClick`\n// and `disabled`, both of which are forwarded to the `<Button>`.\nexport function ActionButtons({ prev = null, next = null, children, sx }) {\n  const { t } = useTranslation();\n\n  return (\n    <Flex sx={{ alignItems: 'center', mt: 2 }}>\n      <Box sx={{ flex: '1 1 0', textAlign: 'left' }}>\n        {prev && (\n          <Button sx={{ whiteSpace: 'nowrap' }} onClick={prev.onClick} disabled={prev.disabled}>\n            <FontAwesomeIcon icon={faCaretLeft} />\n            {t('back-button-label')}\n          </Button>\n        )}\n      </Box>\n      <Box>{children}</Box>\n      <Box sx={{ flex: '1 1 0', textAlign: 'right' }}>\n        {next && (\n          <Button\n            sx={{ whiteSpace: 'nowrap', '& svg': { mr: 0, ml: 2 } }}\n            onClick={next.onClick}\n            disabled={next.disabled}\n          >\n            {t('next-button-label')}\n            <FontAwesomeIcon icon={faCaretRight} />\n          </Button>\n        )}\n      </Box>\n    </Flex>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nconst Notification = ({isDanger, ...rest}) => (\n  <div\n    sx={{\n      ':not(:last-child)': { marginBottom: '1.5rem' },\n      backgroundColor: isDanger ? 'error' : 'gray.3',\n      color: isDanger ? 'background' : 'currentColor',\n      borderRadius: 2,\n      padding: 3,\n      position: 'relative'\n    }}\n    {...rest}\n  />\n);\n\nexport default Notification;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, useThemeUI } from 'theme-ui';\n\nimport Oscilloscope from 'oscilloscope';\nimport { useEffect, useRef } from 'react';\n\nexport default function PreviewAudio({ stream, ...props }) {\n  const canvasRef = useRef();\n  const { theme } = useThemeUI();\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const ctx = canvas.getContext('2d');\n      ctx.lineWidth = 2;\n      ctx.strokeStyle = '#f1c40f';\n\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const source = audioContext.createMediaStreamSource(stream);\n      const scope = new Oscilloscope(source, { fftSize: 1024 });\n      scope.animate(ctx);\n\n      return () => scope.stop();\n    }\n    return () => {};\n  }, [theme.colors, stream]);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      sx={{\n        width: '80%',\n        height: '100px',\n        bg: 'rgba(0,0,0,0.8)',\n        m: 3,\n        mb: 0,\n        borderRadius: '7px',\n       }}\n    />\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { Container, Flex, Heading, Text } from '@theme-ui/components';\nimport { useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faMicrophone, faMicrophoneSlash } from '@fortawesome/free-solid-svg-icons';\n\nimport { useDispatch, useRecordingState } from '../../../recording-context';\n\nimport { startAudioCapture, stopAudioCapture } from '../capturer';\nimport { ActionButtons } from '../elements';\nimport Notification from '../../notification';\n\nimport PreviewAudio from './preview-audio';\n\nexport const MICROPHONE = 'microphone';\nexport const NO_AUDIO = 'no-audio';\nexport const NONE = 'none';\n\nexport default function AudioSetup(props) {\n  const { choice, updateChoice } = props;\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const state = useRecordingState();\n  const audioStream = state.audioStream;\n  const audioAllowed = state.audioAllowed;\n\n  const nextIsDisabled = choice === NONE || (choice === MICROPHONE && !audioStream);\n\n  const backToSetupVideo = useCallback(() => {\n    stopAudioCapture(audioStream, dispatch);\n    props.previousStep();\n  }, [dispatch, props, audioStream]);\n\n  const enterStudio = useCallback(() => {\n    // TODO: combine audio, user, display ?\n    props.nextStep();\n  }, [props]);\n\n  const selectMicrophone = () => {\n    updateChoice(MICROPHONE);\n    startAudioCapture(dispatch).then(success => {\n      if (!success) {\n        updateChoice(NONE);\n      }\n    });\n  };\n\n  const selectNoAudio = () => {\n    updateChoice(NO_AUDIO);\n    if (audioStream) {\n      stopAudioCapture(audioStream, dispatch);\n    }\n  };\n\n  return (\n    <Container\n      sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: '1 0 auto',\n      }}\n    >\n      <Styled.h1 sx={{ textAlign: 'center' }}>{t('sources-audio-question')}</Styled.h1>\n      <Flex\n        sx={{\n          flexDirection: ['column', 'row'],\n          maxWidth: 850,\n          width: '100%',\n          mx: 'auto',\n          mb: 3,\n          flex: '1 0 auto',\n          maxHeight: ['none', '350px'],\n          '& > :first-of-type': {\n            mb: [3, 0],\n            mr: [0, 3],\n          },\n        }}\n      >\n        <OptionButton\n          icon={faMicrophone}\n          label={t('sources-audio-microphone')}\n          selected={choice === MICROPHONE}\n          onClick={selectMicrophone}\n        >\n          { audioStream && <PreviewAudio stream={audioStream} /> }\n          { audioAllowed === false && (\n            <Notification isDanger sx={{ mt: 2 }}>\n              <Heading as=\"h3\" mb={2}>\n                {t('source-audio-not-allowed-title')}\n              </Heading>\n              <Text variant='text'>{t('source-audio-not-allowed-text')}</Text>\n            </Notification>\n          )}\n        </OptionButton>\n        <OptionButton\n          icon={faMicrophoneSlash}\n          label={t('sources-audio-without-audio')}\n          selected={choice === NO_AUDIO}\n          onClick={selectNoAudio}\n        >\n        </OptionButton>\n      </Flex>\n\n      <ActionButtons\n        prev={{ onClick: backToSetupVideo }}\n        next={{ onClick: enterStudio, disabled: nextIsDisabled }}\n      />\n    </Container>\n  );\n}\n\nconst OptionButton = ({ children, icon, label, selected, onClick }) => {\n  const selectedStyle = !selected ? {} : {\n    backgroundColor: 'highlight',\n  };\n\n  return (\n    <button\n      onClick={() => selected || onClick() }\n      sx={{\n        fontFamily: 'inherit',\n        color: 'gray.0',\n        border: '2px solid black',\n        borderRadius: '8px',\n        flex: '0 1 50%',\n        p: 2,\n        ...selectedStyle\n      }}\n    >\n      <div sx={{ display: 'block', textAlign: 'center', mb: 3 }}>\n        <FontAwesomeIcon icon={icon} size=\"3x\"/>\n      </div>\n      <div sx={{ fontSize: 4 }}>{label}</div>\n      {children}\n    </button>\n  );\n};\n","import axios from 'axios';\n\nclass OpencastAPI {\n  constructor(settings) {\n    this.server_url = settings.serverUrl.endsWith('/')\n      ? settings.serverUrl.slice(0, -1)\n      : settings.serverUrl;\n    this.workflow_id = settings.workflowId;\n\n    this.username = settings.loginName;\n    this.password = settings.loginPassword;\n  }\n\n  static areSettingsComplete(settings) {\n    return settings &&\n      settings.serverUrl &&\n      settings.workflowId &&\n      settings.loginName &&\n      settings.loginPassword;\n  }\n\n  async checkConnection() {\n    try {\n      await this.login();\n      return !!(await this.validateState());\n    } catch (error) {\n      return false;\n    }\n  }\n\n  async loginAndUpload(\n    recordings,\n    onsuccess,\n    onloginfailed,\n    onserverunreachable,\n    oninetorpermfailed,\n    title,\n    creator\n  ) {\n    // relog needed?\n    let isLoggedIn = true;\n    try {\n      isLoggedIn = await this.validateState();\n    } catch (e) {\n      onserverunreachable(e);\n      return;\n    }\n\n    if (!isLoggedIn) {\n      await this.login();\n    }\n\n    this.uploadFromRecordings(\n      recordings,\n      onsuccess,\n      onloginfailed,\n      onserverunreachable,\n      oninetorpermfailed,\n      title,\n      creator\n    );\n  }\n\n  async uploadFromRecordings(\n    recordings,\n    onsuccess,\n    onnotloggedin,\n    onserverunreachable,\n    oninetorpermfailed,\n    title,\n    creator\n  ) {\n    // check Connection State\n    try {\n      let isLoggedIn = await this.validateState();\n      if (!isLoggedIn) {\n        onnotloggedin();\n        return;\n      }\n    } catch (e) {\n      onserverunreachable(e);\n      return;\n    }\n\n    try {\n      let mp = await this.getMediaPackage().then(mp => {\n        let base_dc = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n          <dublincore xmlns=\"http://www.opencastproject.org/xsd/1.0/dublincore/\"\n                      xmlns:dcterms=\"http://purl.org/dc/terms/\"\n                      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n              <dcterms:created xsi:type=\"dcterms:W3CDTF\">2001-01-01T01:01Z</dcterms:created>\n              <dcterms:creator>Creator not set</dcterms:creator>\n              <dcterms:extent xsi:type=\"dcterms:ISO8601\">PT5.568S</dcterms:extent>\n              <dcterms:title>Title Not Set</dcterms:title>\n              <dcterms:spatial>Opencast Studio</dcterms:spatial>\n          </dublincore>`;\n\n        const dc = new DOMParser().parseFromString(base_dc, 'text/xml');\n        const dc_created = dc.getElementsByTagName('dcterms:created');\n        const dc_creator = dc.getElementsByTagName('dcterms:creator');\n        const dc_title = dc.getElementsByTagName('dcterms:title');\n\n        dc_created[0].textContent = new Date(Date.now()).toISOString();\n        dc_creator[0].textContent = creator;\n        dc_title[0].textContent = title;\n\n        return this.addDCCatalog(\n          mp.data,\n          new XMLSerializer().serializeToString(dc),\n          'dublincore/episode'\n        );\n      });\n\n      for (const { deviceType, media } of recordings) {\n        let trackFlavor = 'presentation/source';\n        if (deviceType === 'desktop') {\n          trackFlavor = 'presentation/source';\n        } else if (deviceType === 'video') {\n          trackFlavor = 'presenter/source';\n        }\n\n        // TODO(mel)\n        const type = 'video';\n\n        const flavor = deviceType === 'desktop' ? 'Presentation' : 'Presenter';\n        const downloadName = `${flavor} ${type} - ${title || 'Recording'}.webm`;\n\n        mp = await this.addTrack(mp.data, media, downloadName, trackFlavor, '');\n      }\n\n      await this.ingest(mp.data, this.workflow_id);\n    } catch (err) {\n      // Inet failed (while transmitting) or not enough permission\n      oninetorpermfailed(err);\n      return;\n    }\n\n    onsuccess();\n  }\n\n  async validateState() {\n    const me_info_json = await this.getMeInfo();\n    const me_info = me_info_json.data;\n\n    return me_info['user']['username'] !== 'anonymous';\n    // OnError: Couldn't connect to server: inet failed / is not a Opencast Api / CORS not allowed\n  }\n\n  login() {\n    const data = `j_username=${this.username}&j_password=${this.password}&_spring_security_remember_me=on`;\n    const url = `${this.server_url}/admin_ng/j_spring_security_check`;\n    return axios({ url, method: 'post', data, withCredentials: true });\n  }\n\n  getMeInfo() {\n    const url = `${this.server_url}/info/me.json`;\n    return axios.get(url, { responseType: 'text', withCredentials: true });\n  }\n\n  getMediaPackage() {\n    const url = `${this.server_url}/ingest/createMediaPackage`;\n    return axios.get(url, { responseType: 'text', withCredentials: true });\n  }\n\n  addDCCatalog(mp, dc, flavor) {\n    const data = new FormData();\n    data.append('mediaPackage', mp);\n    data.append('dublinCore', dc);\n    data.append('flavor', flavor);\n\n    const url = `${this.server_url}/ingest/addDCCatalog`;\n    return axios({ url, method: 'post', data, responseType: 'text', withCredentials: true });\n  }\n\n  addTrack(mp, track, track_filename, flavor, tags) {\n    const data = new FormData();\n    data.append('mediaPackage', mp);\n    data.append('flavor', flavor);\n    data.append('tags', tags);\n    data.append('BODY', track, track_filename);\n    const url = `${this.server_url}/ingest/addTrack`;\n\n    return axios({ url, method: 'post', data, responseType: 'text', withCredentials: true });\n  }\n\n  ingest(mp, workflowId) {\n    const data = new FormData();\n    data.append('mediaPackage', mp);\n    data.append('workflowDefinitionId', workflowId);\n    const url = `${this.server_url}/ingest/ingest`;\n\n    return axios({ url, method: 'post', data, responseType: 'text', withCredentials: true });\n  }\n}\n\nexport default OpencastAPI;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nfunction FormField(props) {\n  return (\n    <div\n      sx={{\n        '&:not(:last-child)': {\n          marginBottom: 3\n        }\n      }}\n    >\n      <label\n        sx={{\n          color: 'gray.0',\n          display: 'block',\n          fontSize: 2,\n          fontWeight: 'bold'\n        }}\n      >\n        {props.label}\n        <div\n          sx={{\n            boxSizing: 'border-box',\n            clear: 'both',\n            fontSize: 2,\n            position: 'relative',\n            textAlign: 'left'\n          }}\n        >\n          {props.children}\n        </div>\n      </label>\n    </div>\n  );\n}\n\nexport default FormField;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faFileDownload } from '@fortawesome/free-solid-svg-icons';\nimport { Box } from '@theme-ui/components';\n\nconst RecordingPreview = ({ deviceType, title, type, url }) => {\n  const flavor = deviceType === 'desktop' ? 'Presentation' : 'Presenter';\n  const downloadName = `${flavor} ${type} - ${title || 'Recording'}.webm`;\n\n  const style = {\n    width: '8rem',\n    height: '4.5rem',\n    position: 'relative',\n    backgroundColor: 'gray.3',\n    textAlign: 'center',\n    padding: '0.5rem',\n    margin: '0 0.5rem 0.5rem 0',\n    color: 'transparent',\n    bg: 'background'\n  };\n\n  if (!url) {\n    return (\n      <a sx={style} target=\"_blank\" href={url} download={downloadName} rel=\"noopener noreferrer\">\n        {deviceType}\n      </a>\n    );\n  }\n\n  return (\n    <a\n      sx={{\n        ...style,\n        ':hover': {\n          video: { opacity: 0.2 },\n          svg: { color: 'text' }\n        }\n      }}\n      target=\"_blank\"\n      download={downloadName}\n      href={url}\n      rel=\"noopener noreferrer\"\n    >\n      <video\n        autoPlay\n        muted\n        sx={{\n          position: 'absolute',\n          maxWidth: '100%',\n          maxHeight: '100%',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%, -50%)'\n        }}\n        src={url}\n      ></video>\n      <Box\n        sx={{\n          position: 'absolute',\n          top: 1,\n          right: 1,\n          fontSize: 4,\n          color: 'white'\n        }}\n      >\n        <FontAwesomeIcon icon={faFileDownload} />\n      </Box>\n    </a>\n  );\n};\n\nexport default RecordingPreview;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTrash, faUpload } from '@fortawesome/free-solid-svg-icons';\nimport { Button, Box, Container, Spinner } from '@theme-ui/components';\nimport { useReducer } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Beforeunload } from 'react-beforeunload';\nimport { Trans, useTranslation } from 'react-i18next';\n\nimport OpencastAPI from '../../../opencast-api';\nimport { useRecordingState } from '../../../recording-context';\n\nimport Notification from '../../notification';\n\nimport FormField from './form-field';\nimport RecordingPreview from './recording-preview';\n\nconst Input = props => <input sx={{ variant: 'styles.input' }} {...props} />;\n\nconst initialState = {\n  error: null,\n  recordingData: { title: '', presenter: '' },\n  uploading: false,\n  uploaded: false\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'ERROR':\n      return { ...state, error: action.payload };\n\n    case 'RECORDING_DATA_UPDATE':\n      const [name, value] = action.payload;\n      return { ...state, recordingData: { ...state.recordingData, [name]: value } };\n\n    case 'UPLOAD_FAILURE':\n      return { ...state, error: action.payload, uploading: false, uploaded: false };\n\n    case 'UPLOAD_REQUEST':\n      return { ...state, error: null, uploading: true, uploaded: false };\n\n    case 'UPLOAD_SUCCESS':\n      return { ...state, error: null, uploading: false, uploaded: true };\n\n    default:\n      throw new Error();\n  }\n};\n\nexport default function SaveCreation(props) {\n  const { t } = useTranslation();\n  const { recordings } = useRecordingState();\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  function handleInputChange(event) {\n    const target = event.target;\n    const value = target.type === 'checkbox' ? target.checked : target.value;\n    dispatch({ type: 'RECORDING_DATA_UPDATE', payload: [target.name, value] });\n  }\n\n  function handleUpload() {\n    const { title, presenter } = state.recordingData;\n\n    if (title === '' || presenter === '') {\n      dispatch({ type: 'ERROR', payload: t('save-creation-form-invalid') });\n      return;\n    }\n\n    dispatch({ type: 'UPLOAD_REQUEST' });\n    new OpencastAPI(props.settings.opencast).loginAndUpload(\n      // recording,\n      recordings.filter(Boolean),\n\n      function onSuccess() {\n        dispatch({ type: 'UPLOAD_SUCCESS' });\n      },\n\n      function onLoginFailed() {\n        dispatch({ type: 'UPLOAD_FAILURE', payload: t('message-login-failed') });\n        // TODO: (mel) We have to find a better way to ensure connection to OC\n        // this.props.handleOpenUploadSettings();\n      },\n\n      function onServerUnreachable(error) {\n        dispatch({ type: 'UPLOAD_FAILURE', payload: t('message-server-unreachable') });\n        // TODO: (mel) We have to find a better way to ensure connection to OC\n        // this.props.handleOpenUploadSettings();\n      },\n\n      function onInetOrPermFailed(err) {\n        dispatch({ type: 'UPLOAD_FAILURE', payload: t('message-conn-failed') });\n        // TODO: (mel) We have to find a better way to ensure connection to OC\n        // this.props.handleOpenUploadSettings();\n      },\n      title,\n      presenter\n    );\n  }\n\n  const handleCancel = () => {\n    props.previousStep();\n  };\n\n  const uploadPossible = OpencastAPI.areSettingsComplete(props.settings.opencast);\n\n  return (\n    <Container>\n      {recordings.length > 0 && <Beforeunload onBeforeunload={event => event.preventDefault()} />}\n\n      <header>\n        <Styled.h2>{t('save-creation-modal-title')}</Styled.h2>\n      </header>\n\n      <Box>\n        {state.error && <Notification isDanger>{state.error}</Notification>}\n        {state.uploading && <Notification>{t('upload-notification')}</Notification>}\n        {state.uploaded && <Notification>{t('message-upload-complete')}</Notification>}\n\n        <FormField label={t('save-creation-label-title')}>\n          <Input\n            name=\"title\"\n            autoComplete=\"off\"\n            value={state.recordingData.title}\n            onChange={handleInputChange}\n          />\n        </FormField>\n\n        <FormField label={t('save-creation-label-presenter')}>\n          <Input\n            name=\"presenter\"\n            autoComplete=\"off\"\n            value={state.recordingData.presenter}\n            onChange={handleInputChange}\n          />\n        </FormField>\n      </Box>\n\n      <header>\n        <Styled.h2>{t('save-creation-label-media')}</Styled.h2>\n      </header>\n\n      <div sx={{ flex: 1 }}>\n        <div\n          sx={{\n            display: 'flex',\n            maxHeight: '6.5rem',\n            overflowY: 'auto',\n            flexWrap: 'wrap'\n          }}\n        >\n          {recordings.length === 0 ? (\n            <Spinner title={t('save-creation-waiting-for-recordings')} />\n          ) : (\n            recordings.map((recording, index) => (\n              <RecordingPreview\n                key={index}\n                deviceType={recording.deviceType}\n                title={state.recordingData.title}\n                type=\"video\"\n                url={recording.url}\n              />\n            ))\n          )}\n        </div>\n      </div>\n\n      <footer\n        sx={{\n          mt: 4,\n          button: {\n            minWidth: 100,\n            width: ['100%', 'auto'],\n            '& + button': {\n              ml: [0, 2],\n              mt: [2, 'auto']\n            }\n          }\n        }}\n      >\n        {!uploadPossible && (\n          <Notification key=\"opencast-connection\" isDanger>\n            <Trans i18nKey=\"warning-missing-connection-settings\">\n              Warning. <Link to=\"/settings\" sx={{ variant: 'styles.a' }}>setting</Link>\n            </Trans>\n          </Notification>\n        )}\n\n        <Button\n          onClick={handleUpload}\n          disabled={recordings.length === 0 || state.uploading || state.uploaded || !uploadPossible}\n        >\n          <FontAwesomeIcon icon={faUpload} />\n          <span>\n            {state.uploading\n              ? t('save-creation-button-uploading')\n              : state.uploaded\n              ? t('save-creation-button-uploaded')\n              : t('save-creation-button-upload')}\n          </span>\n        </Button>\n\n        <Button onClick={handleCancel} variant=\"text\">\n          <FontAwesomeIcon icon={faTrash} />\n          <span>{t('save-creation-button-discard-and-record')}</span>\n        </Button>\n      </footer>\n    </Container>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { Fragment, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Box, Button, Card, Flex, Grid, Text, Spinner } from '@theme-ui/components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faExclamationTriangle, faTimes } from '@fortawesome/free-solid-svg-icons';\n\n\nexport function SourcePreview({ reselectSource, title, warnings, inputs }) {\n  const { t } = useTranslation();\n\n  let hideUnshare = false;\n  for (const input of inputs) {\n    hideUnshare |= !input.stream && input.allowed !== false;\n  }\n\n  let preview;\n  switch (inputs.length) {\n    case 1:\n      preview = (\n        <StreamPreview input={inputs[0]} text={t('sources-select-user')} />\n      );\n      break;\n    case 2:\n      preview = <Grid gap={3} columns={[1, 2]} sx={{ minHeight: 0 }}>\n        <StreamPreview input={inputs[0]} text={t('sources-select-display')} />\n        <StreamPreview input={inputs[1]} text={t('sources-select-user')} />\n      </Grid>\n      break;\n    default:\n      return <p>Something went very wrong</p>;\n  }\n\n  return (\n    <Fragment>\n      <Flex sx={{ alignItems: 'center', justifyContent: 'space-between' }}>\n        <Styled.h2 sx={{ mt: 0 }}>{ title }</Styled.h2>\n        <Box>\n          { hideUnshare ? null : <UnshareButton handleClick={reselectSource} />}\n        </Box>\n      </Flex>\n\n      { warnings }\n      { preview }\n    </Fragment>\n  );\n}\n\nfunction StreamPreview({ input, text }) {\n  const stream = input.stream;\n  const track = stream?.getVideoTracks()?.[0];\n  const { width, height } = track?.getSettings() ?? {};\n\n  return (\n    <Card sx={{ display: 'flex', flexDirection: 'column', flex: '0 1 auto', minHeight: 0 }}>\n      <PreviewVideo allowed={input.allowed} stream={stream} />\n      <Text p={2} color=\"muted\">\n        {text}\n        {track && `: ${width}×${height}`}\n      </Text>\n    </Card>\n  );\n}\n\nexport const PreviewVideo = ({ allowed, stream, ...props }) => {\n  const videoRef = useRef();\n  useEffect(() => {\n    if (videoRef.current) {\n      videoRef.current.srcObject = stream;\n    }\n\n    return () => {};\n  }, [stream]);\n\n  if (!stream) {\n    let inner;\n    if (allowed === false) {\n      inner = <FontAwesomeIcon icon={faExclamationTriangle} size=\"3x\" />;\n    } else {\n      inner = <Spinner size=\"75\"/>;\n    }\n\n    return (\n      <div sx={{\n        width: '100%',\n        height: '100%',\n        minHeight: '120px',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n      }}>\n        { inner }\n      </div>\n    );\n  }\n\n  return (\n    <video\n      ref={videoRef}\n      autoPlay\n      muted\n      sx={{\n        minHeight: 0,\n        display: 'block',\n        width: '100%',\n        height: '100%',\n        // TODO: (mel) research this setting\n        // transform: 'rotateY(180deg)'\n      }}\n    />\n  );\n};\n\nexport const UnshareButton = ({ handleClick }) => {\n  const { t } = useTranslation();\n\n  return (\n    <Button onClick={handleClick} variant=\"text\">\n      <FontAwesomeIcon icon={faTimes} />\n      {t('sources-video-reselect-source')}\n    </Button>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { faChalkboard, faChalkboardTeacher, faUser } from '@fortawesome/free-solid-svg-icons';\nimport { Container, Flex, Heading, Text } from '@theme-ui/components';\nimport { Styled } from 'theme-ui';\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { useDispatch, useRecordingState } from '../../../recording-context';\n\nimport Notification from '../../notification';\n\nimport { stopCapture, startUserCapture, startDisplayCapture } from '../capturer';\nimport { ActionButtons } from '../elements';\nimport { SourcePreview } from './preview';\n\n\nexport default function VideoSetup(props) {\n  const { t } = useTranslation();\n\n  const dispatch = useDispatch();\n  const state = useRecordingState();\n  const { displayStream, userStream, displaySupported, userSupported } = state;\n\n  const hasStreams = displayStream || userStream;\n  const anySupported = displaySupported || userSupported;\n  const bothSupported = displaySupported && userSupported;\n\n  const BOTH = 'both';\n  const DISPLAY = 'display';\n  const USER = 'user';\n  const NONE = 'none';\n\n  const [activeSource, setActiveSource] = useState(\n    (displayStream && userStream && BOTH)\n      || (displayStream && DISPLAY)\n      || (userStream && USER)\n      || NONE\n  );\n\n  const USER_CONSTRAINTS = {\n    video: { height: { ideal: 1080 }, facingMode: 'user' },\n    audio: false\n  };\n\n  const clickUser = async () => {\n    setActiveSource(USER);\n    await startUserCapture(dispatch, USER_CONSTRAINTS);\n  };\n  const clickDisplay = async () => {\n    await startDisplayCapture(dispatch);\n    setActiveSource(DISPLAY);\n  };\n  const clickBoth = async () => {\n    setActiveSource(BOTH);\n    await startUserCapture(dispatch, USER_CONSTRAINTS);\n    await startDisplayCapture(dispatch);\n  };\n\n  const reselectSource = () => {\n    setActiveSource(NONE);\n    stopCapture(state, dispatch);\n  };\n\n  const nextDisabled = activeSource === NONE\n    || activeSource === BOTH ? (!displayStream || !userStream) : !hasStreams;\n\n  // The warnings if we are not allowed to capture a stream.\n  const userWarning = (state.userAllowed === false) && (\n    <Notification isDanger>\n      <Heading as=\"h3\" mb={2}>\n        {t('source-user-not-allowed-title')}\n      </Heading>\n      <Text>{t('source-user-not-allowed-text')}</Text>\n    </Notification>\n  );\n  const displayWarning = (state.displayAllowed === false) && (\n    <Notification isDanger>\n      <Heading as=\"h3\" mb={2}>\n        {t('source-display-not-allowed-title')}\n      </Heading>\n      <Text>{t('source-display-not-allowed-text')}</Text>\n    </Notification>\n  );\n\n  // The body depends on which source is currently selected.\n  let body;\n  switch (activeSource) {\n    case NONE:\n      if (anySupported) {\n        body = (\n          <Flex\n            sx={{\n              flexDirection: ['column', 'row'],\n              maxWidth: [270, 850],\n              width: '100%',\n              mx: ['auto', 'none'],\n              mb: 3,\n              flex: ['0 1 auto', '1 1 auto'],\n              maxHeight: ['none', '270px'],\n              minHeight: [0, ''],\n              justifyContent: ['flex-start', 'center'],\n              '& > :not(:last-of-type)': {\n                mb: [3, 0],\n                mr: [0, 3],\n              },\n            }}\n          >\n            { displaySupported && <OptionButton\n              label={t('sources-scenario-display')}\n              icon={faChalkboard}\n              onClick={clickDisplay}\n            />}\n            { bothSupported && <OptionButton\n              label={t('sources-scenario-display-and-user')}\n              icon={faChalkboardTeacher}\n              onClick={clickBoth}\n            />}\n            { userSupported && <OptionButton\n              label={t('sources-scenario-user')}\n              icon={faUser}\n              onClick={clickUser}\n            />}\n          </Flex>\n        );\n      } else {\n        body = <Notification isDanger>{t('sources-video-none-available')}</Notification>;\n      }\n      break;\n    case USER:\n      body = <SourcePreview\n        title={t('source-user-title')}\n        reselectSource={reselectSource}\n        warnings={userWarning}\n        inputs={[{ stream: state.userStream, allowed: state.userAllowed }]}\n      />;\n      break;\n    case DISPLAY:\n      body = <SourcePreview\n        title={t('source-display-title')}\n        reselectSource={reselectSource}\n        warnings={displayWarning}\n        inputs={[{ stream: state.displayStream, allowed: state.displayAllowed }]}\n      />;\n      break;\n    case BOTH:\n      // body = <DisplayAndUserMedia onReselect={reselectSource} />;\n      body = <SourcePreview\n        title={t('source-display-and-user-title')}\n        reselectSource={reselectSource}\n        warnings={[displayWarning, userWarning]}\n        inputs={[\n          { stream: state.displayStream, allowed: state.displayAllowed },\n          { stream: state.userStream, allowed: state.userAllowed },\n        ]}\n      />;\n      break;\n    default:\n      return <p>Something went very wrong</p>;\n  };\n\n\n  return (\n    <Container\n      sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: '1 1 auto',\n        minHeight: 0,\n      }}\n    >\n      <Styled.h1 sx={{ textAlign: 'center', fontSize: ['26px', '30px', '32px'] }}>\n        {t('sources-video-question')}\n      </Styled.h1>\n\n      { body }\n\n      <ActionButtons next={{ onClick: () => props.nextStep(), disabled: nextDisabled }} />\n    </Container>\n  );\n}\n\nconst OptionButton = ({ icon, label, onClick }) => {\n  return (\n    <button\n      onClick={onClick}\n      sx={{\n        fontFamily: 'inherit',\n        color: 'gray.0',\n        border: '2px solid black',\n        borderRadius: '8px',\n        flex: ['0 1 180px', '0 1 100%'],\n        minWidth: '180px',\n        maxWidth: '300px',\n        minHeight: ['120px', '150px'],\n        p: 2,\n      }}\n    >\n      <div sx={{ display: 'block', textAlign: 'center', mb: 3 }}>\n        <FontAwesomeIcon icon={icon} size=\"3x\"/>\n      </div>\n      <div sx={{ fontSize: 4 }}>{label}</div>\n    </button>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useEffect, useRef } from 'react';\n\nexport default function MediaDevice({ onClick, title, icon, stream }) {\n  const videoRef = useRef();\n\n  useEffect(() => {\n    if (videoRef.current && typeof stream != 'undefined') {\n      videoRef.current.srcObject = stream;\n    }\n  });\n\n  return (\n    <div\n      onClick={stream ? null : onClick}\n      data-title={title}\n      sx={{\n        backgroundColor: 'gray.3',\n        boxShadow: '0 2px 2px rgba(0, 0, 0, 0.35)',\n        overflow: 'hidden',\n        zIndex: '0',\n        cursor: stream ? 'initial' : 'pointer',\n        position: 'relative',\n\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center'\n      }}\n    >\n      <video\n        ref={videoRef}\n        autoPlay\n        muted\n        sx={{\n          outline: 'none',\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          zIndex: 2,\n          background: 'transparent'\n        }}\n      ></video>\n    </div>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { faDesktop, faVideo } from '@fortawesome/free-solid-svg-icons';\nimport { useTranslation } from 'react-i18next';\nimport MediaDevice from './media-device';\n\nimport { useRecordingState } from '../../../recording-context';\n\nexport default function MediaDevices(props) {\n  const { t } = useTranslation();\n  const { displayStream, userStream } = useRecordingState();\n\n  return (\n    <div\n      sx={{\n        flex: 1,\n        display: 'flex',\n        flexDirection: ['column', 'row'],\n        justifyContent: 'center',\n        flexWrap: 'wrap',\n        '& > *': {\n          flex: '1 0 50%'\n        }\n      }}\n    >\n      {displayStream && (\n        <MediaDevice title={t('share-desktop')} icon={faDesktop} stream={displayStream} />\n      )}\n\n      {userStream && <MediaDevice title={t('share-camera')} icon={faVideo} stream={userStream} />}\n    </div>\n  );\n}\n","export default class Recorder {\n  constructor(stream, options = {}) {\n    const mimeType = options.mimeType || undefined;\n\n    const _recData = [];\n    this.recorder = new MediaRecorder(stream, { mimeType });\n    this.recorder.ondataavailable = function(e) {\n      if (e.data.size > 0) {\n        _recData.push(e.data);\n      }\n    };\n\n    this.recorder.onerror = error => {\n      options.onError && options.onError(error);\n    };\n\n    this.recorder.onstop = () => {\n      const media = new Blob(_recData, { type: this.recorder.mimeType });\n      let url = URL.createObjectURL(media);\n      this.recorder = null;\n      options.onStop && options.onStop({ url, media });\n    };\n\n    this.isRecording = false;\n    this.isPaused = false;\n  }\n\n  start() {\n    if (!this.isRecording) {\n      this.recorder.start();\n      this.isRecording = true;\n    }\n  }\n\n  pause() {\n    if (!this.isPaused) {\n      this.recorder.pause();\n      this.isPaused = true;\n    }\n  }\n\n  resume() {\n    if (this.isPaused) {\n      this.recorder.resume();\n      this.isPaused = false;\n    }\n  }\n\n  stop() {\n    this.recorder.stop();\n    this.isRecording = false;\n  }\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCircle,\n  faCircleNotch,\n  faPauseCircle,\n  faPlayCircle,\n  faStopCircle\n} from '@fortawesome/free-solid-svg-icons';\n\nconst Button = ({ large, ...rest }) => (\n  <button\n    sx={{\n      backgroundColor: 'transparent',\n      border: 'none',\n      position: 'relative',\n      overflow: 'hidden',\n      my: 0,\n      padding: large ? '0.5rem' : '0.25rem',\n      fontSize: large ? '5rem' : '2.5rem',\n      lineHeight: large ? '5rem' : '2.5rem',\n      svg: {\n        margin: 0,\n        padding: 0,\n        outline: 'none'\n      }\n    }}\n    {...rest}\n  />\n);\n\nexport const PauseButton = props => (\n  <Button onClick={props.onClick} title={props.title}>\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={faPauseCircle} />\n    </span>\n  </Button>\n);\n\nexport const RecordButton = props => (\n  <Button\n    onClick={props.onClick}\n    title={props.title}\n    large={props.large ? 1 : 0}\n    disabled={props.disabled || props.countdown}\n    sx={{\n      color: '#bd181c',\n      'svg + svg': { color: '#e22319' },\n      ':disabled': { color: '#aaa' },\n      ':disabled svg + svg': { color: '#bbb' }\n    }}\n  >\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={props.countdown ? faCircleNotch : faCircle} spin={props.countdown} />\n      <FontAwesomeIcon icon={faCircle} transform=\"shrink-6\" />\n    </span>\n  </Button>\n);\n\nexport const ResumeButton = props => (\n  <Button onClick={props.onClick} title={props.title}>\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={faPlayCircle} />\n    </span>\n  </Button>\n);\n\nexport const StopButton = props => (\n  <Button\n    onClick={props.onClick}\n    title={props.title}\n    large={!!props.large}\n    sx={{ color: '#bd181c' }}\n  >\n    <FontAwesomeIcon icon={faStopCircle} />\n  </Button>\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { Component } from 'react';\n\nclass Clock extends Component {\n  #last = null;\n  #timerID = null;\n  #isMounted = false;\n\n  constructor(props) {\n    super(props);\n    this.state = { milliseconds: 0 };\n    this.#last = new Date();\n    this.#timerID = setInterval(() => this.tick(), 100);\n  }\n\n  componentDidMount() {\n    this.#isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this.stopTimer();\n    this.#isMounted = false;\n  }\n\n  resumeTimer() {\n    if (!this.timerId) {\n      this.#timerID = setInterval(() => this.tick(), 100);\n      this.#last = new Date();\n    }\n  }\n\n  stopTimer() {\n    clearInterval(this.#timerID);\n    this.#timerID = null;\n  }\n\n  componentDidUpdate(prevProps) {\n    // recording state did not change\n    if (this.props.isPaused === prevProps.isPaused) {\n      return;\n    }\n\n    if (this.props.isPaused) {\n      this.stopTimer();\n    } else {\n      this.resumeTimer();\n    }\n  }\n\n  tick() {\n    if (this.#isMounted) {\n      const now = new Date();\n      const passed = now - this.#last;\n      this.#last = now;\n      this.setState(state => ({\n        milliseconds: state.milliseconds + passed,\n      }));\n    }\n  }\n\n  render() {\n    const duration = this.state.milliseconds;\n    let timeArr = [\n      (duration / 3600000) >> 0,\n      ((duration / 60000) >> 0) % 60,\n      ((duration / 1000) >> 0) % 60\n    ];\n    if (timeArr[0] === 0) {\n      timeArr = timeArr.slice(1);\n    }\n    const content = timeArr.map(unit => (unit < 10 ? '0' : '') + unit).join(':');\n\n    return <span>{content}</span>;\n  }\n}\n\nexport default Clock;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { Beforeunload } from 'react-beforeunload';\nimport { useTranslation } from 'react-i18next';\n\nimport Recorder from '../../../recorder';\nimport { useDispatch, useRecordingState } from '../../../recording-context';\n\nimport { PauseButton, RecordButton, ResumeButton, StopButton } from './recording-buttons';\nimport Clock from './clock';\n\nfunction addRecordOnStop(dispatch, deviceType) {\n  return ({ media, url }) => {\n    dispatch({ type: 'ADD_RECORDING', payload: { deviceType, media, url } });\n  };\n}\n\nfunction mixAudioIntoVideo(audioStream, videoStream) {\n  if (!audioStream || audioStream.getAudioTracks().length === 0) {\n    return videoStream;\n  }\n  return new MediaStream([...videoStream.getVideoTracks(), ...audioStream.getAudioTracks()]);\n}\n\nexport default function RecordingControls({ handleRecorded, handleStart }) {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n\n  const { audioStream, displayStream, userStream } = useRecordingState();\n\n  const [countdown, setCountdown] = useState(false);\n  const [recordingState, setRecordingState] = useState('inactive');\n\n  const desktopRecorder = useRef(null);\n  const videoRecorder = useRef(null);\n\n  const hasStreams = displayStream || userStream;\n\n  // reset after mounting\n  useEffect(() => {\n    dispatch({ type: 'CLEAR_RECORDINGS' });\n    desktopRecorder.current = null;\n    videoRecorder.current = null;\n  }, [dispatch]);\n\n  const record = () => {\n    handleStart();\n\n    if (displayStream) {\n      const onStop = addRecordOnStop(dispatch, 'desktop');\n      const stream = mixAudioIntoVideo(audioStream, displayStream);\n      desktopRecorder.current = new Recorder(stream, { onStop });\n      desktopRecorder.current.start();\n    }\n\n    if (userStream) {\n      const onStop = addRecordOnStop(dispatch, 'video');\n      const stream = mixAudioIntoVideo(audioStream, userStream);\n      videoRecorder.current = new Recorder(stream, { onStop });\n      videoRecorder.current.start();\n    }\n  };\n\n  const resume = () => {\n    desktopRecorder.current && desktopRecorder.current.resume();\n    videoRecorder.current && videoRecorder.current.resume();\n  };\n\n  const pause = () => {\n    desktopRecorder.current && desktopRecorder.current.pause();\n    videoRecorder.current && videoRecorder.current.pause();\n  };\n\n  const stop = () => {\n    desktopRecorder.current && desktopRecorder.current.stop();\n    videoRecorder.current && videoRecorder.current.stop();\n    handleRecorded();\n  };\n\n  const handlePause = () => {\n    setRecordingState('paused');\n    pause();\n  };\n\n  const handleResume = () => {\n    setRecordingState('recording');\n    resume();\n  };\n\n  const handleRecord = () => {\n    if (!hasStreams) {\n      return;\n    }\n    setCountdown(true);\n    setTimeout(() => {\n      setRecordingState('recording');\n      setCountdown(false);\n      record();\n    }, 1000);\n  };\n\n  const handleStop = () => {\n    setRecordingState('inactive');\n    stop();\n  };\n\n  return (\n    <div sx={{ m: 0, width: recordingState !== 'inactive' ? '290px' : 'auto' }}>\n      {recordingState !== 'inactive' && (\n        <Beforeunload onBeforeunload={event => event.preventDefault()} />\n      )}\n\n      <div className=\"buttons\" sx={{ display: 'flex', alignItems: 'center' }}>\n        {recordingState !== 'inactive' && <div sx={{ flex: 1, textAlign: 'right' }}>\n          {recordingState === 'recording' && (\n            <PauseButton\n              title={t('pause-button-title')}\n              recordingState={recordingState}\n              onClick={handlePause}\n            />\n          )}\n\n          {recordingState === 'paused' && (\n            <ResumeButton\n              title={t('resume-button-title')}\n              recordingState={recordingState}\n              onClick={handleResume}\n            />\n          )}\n        </div>}\n\n        <div className=\"center\">\n          {recordingState === 'inactive' ? (\n            <RecordButton\n              large\n              title={t('record-button-title')}\n              recordingState={recordingState}\n              onClick={handleRecord}\n              disabled={!hasStreams}\n              countdown={countdown}\n            />\n          ) : (\n            <StopButton\n              large\n              title={t('stop-button-title')}\n              recordingState={recordingState}\n              onClick={handleStop}\n            />\n          )}\n        </div>\n\n        {recordingState !== 'inactive' && <div sx={{ flex: 1 }}>\n          <Clock isPaused={recordingState === 'paused'} />\n        </div>}\n      </div>\n    </div>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Flex } from '@theme-ui/components';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { useRecordingState } from '../../../recording-context';\n\nimport { ActionButtons } from '../elements';\n\nimport MediaDevices from './media-devices';\nimport RecordingControls from './recording-controls';\n\nexport default function Recording(props) {\n  const state = useRecordingState();\n\n  useEffect(() => {\n    if (!(state.displayStream || state.userStream)) {\n      props.firstStep();\n    }\n  }, [props, state.displayStream, state.userStream]);\n\n\n\n  const [isRecording, setIsRecording] = useState(false);\n  const handleStart = () => {\n    setIsRecording(true);\n  };\n  const handleRecorded = () => {\n    props.nextStep();\n  };\n\n  const backToAudio = useCallback(() => {\n    props.previousStep();\n  }, [props]);\n\n  return (\n    <Flex sx={{\n      flexDirection: 'column',\n      height: '100%',\n      position: 'relative',\n      flexGrow: 1,\n    }}>\n      <MediaDevices />\n\n      <div sx={{ mx: 3 }}>\n        <ActionButtons prev={!isRecording && { onClick: backToAudio }}>\n          <RecordingControls handleRecorded={handleRecorded} handleStart={handleStart} />\n        </ActionButtons>\n      </div>\n    </Flex>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { Fragment, useState } from 'react';\n\nimport Steps from './steps';\n\nimport AudioSetup, { NONE } from './audio-setup';\nimport SaveCreation from './save-creation';\nimport VideoSetup from './video-setup';\nimport Recording from './recording';\n\nexport default function Wizard({ settings, activeStep, updateActiveStep }) {\n  const [audioChoice, updateAudioChoice] = useState(NONE);\n\n  return (\n    <Fragment>\n      <Steps activeStep={activeStep} updateActiveStep={updateActiveStep}>\n        <VideoSetup />\n        <AudioSetup choice={audioChoice} updateChoice={updateAudioChoice} />\n        <Recording settings={settings} />\n        <SaveCreation settings={settings} />\n      </Steps>\n    </Fragment>\n  );\n}\n","const languages = [\n  { short: 'en', long: 'English', rtl: false },\n  { short: 'de', long: 'Deutsch', rtl: false },\n  { short: 'nl', long: 'Dutch', rtl: false },\n  { short: 'el', long: 'Ελληνικά', rtl: false },\n  { short: 'es', long: 'Español', rtl: false },\n  { short: 'fa', long: 'Farsi', rtl: true },\n  { short: 'fr', long: 'Français', rtl: false },\n  { short: 'tr', long: 'Turkish', rtl: false },\n];\n\nexport default languages;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { Box } from '@theme-ui/components';\n\n// A styled `<input>`` element.\nexport const Input = ({ errors, label, name, register, required, type = 'text', ...rest }) => {\n  const { t } = useTranslation();\n\n  return (\n    <div\n      sx={{\n        '&:not(:last-child)': {\n          mb: 3\n        }\n      }}\n    >\n      <label\n        sx={{\n          color: 'text',\n          display: 'block',\n          fontSize: 2,\n          fontWeight: 'bold'\n        }}\n      >\n        {label}\n        <div\n          sx={{\n            display: 'block',\n            boxSizing: 'border-box',\n            clear: 'both',\n            fontSize: 2,\n            position: 'relative',\n            textAlign: 'left'\n          }}\n        >\n          <input\n            aria-invalid={errors[name] ? 'true' : 'false'}\n            aria-describedby={`${name}Error`}\n            autoComplete=\"off\"\n            name={name}\n            ref={register({ required })}\n            sx={{ variant: 'styles.input' }}\n            type={type}\n            {...rest}\n          />\n          {errors[name] && (\n            <p\n              id={`${name}Error`}\n              sx={{\n                color: 'error',\n                fontSize: 1,\n                fontWeight: 'body',\n                mt: 1\n              }}\n            >\n              {t('forms-validation-error-required')}\n            </p>\n          )}\n        </div>\n      </label>\n    </div>\n  );\n};\n\nexport const SettingsSection = ({ title, children }) => (\n  <Box\n    sx={{\n      '&:not(:last-child)': {\n        mb: 5\n      }\n    }}\n  >\n    <Styled.h2\n      sx={{\n        borderBottom: theme => `1px solid ${theme.colors.gray[2]}`,\n        pb: 1,\n        my: 3,\n        mx: 0\n      }}\n    >\n      {title}\n    </Styled.h2>\n    {children}\n  </Box>\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\n\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\nimport languages from '../../languages';\nimport { SettingsSection } from './elements';\n\nconst LanguageSettings = () => {\n  const { i18n } = useTranslation();\n\n  return (\n    <SettingsSection title=\"Language\">\n      <select\n        sx={{ variant: 'styles.select' }}\n        defaultValue={i18n.language}\n        onChange={e => i18n.changeLanguage(e.target.value)}\n      >\n        {languages.map(language => (\n          <option value={language.short} key={language.short}>\n            {language.long}\n          </option>\n        ))}\n      </select>\n    </SettingsSection>\n  );\n};\n\nexport default LanguageSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheckCircle, faCircleNotch, faExclamationCircle } from \"@fortawesome/free-solid-svg-icons\";\nimport useForm from 'react-hook-form';\nimport { Link } from 'react-router-dom';\nimport { Box, Button } from '@theme-ui/components';\n\nimport { useState } from 'react';\n\nimport OpencastAPI from '../../opencast-api';\nimport Notification from '../notification';\nimport { Input, SettingsSection} from './elements';\nimport { useRecordingState } from '../../recording-context';\n\n\n\nfunction OpencastSettings({ settingsManager }) {\n  const { t } = useTranslation();\n  const [error, setError] = useState();\n  const { errors, handleSubmit, register } = useForm({\n    defaultValues: settingsManager.formValues().opencast\n  });\n  const [status, setStatus] = useState('initial');\n\n  const { recordings } = useRecordingState();\n  const hasRecording = recordings.length > 0;\n\n  async function onSubmit(data) {\n    try {\n      setStatus('testing');\n      const ocUploader = new OpencastAPI({\n        ...settingsManager.settings().opencast,\n        ...data,\n      });\n      const connected = await ocUploader.checkConnection();\n      if (!connected) {\n        setStatus('error');\n        setError(t('upload-settings-validation-error'));\n        return;\n      }\n      settingsManager.saveSettings({ opencast: data });\n      setStatus('saved');\n      setError(null)\n    } catch (error) {\n      setStatus('error');\n      setError(t('message-server-unreachable'));\n      console.log(error);\n    }\n  }\n\n  const fixedServerUrl = settingsManager.isFixed('opencast.serverUrl');\n  const fixedWorkflowId = settingsManager.isFixed('opencast.workflowId');\n  const fixedLoginName = settingsManager.isFixed('opencast.loginName');\n  const fixedLoginPassword = settingsManager.isFixed('opencast.loginPassword');\n\n  // If all settings are already specified by the context, we do not show\n  // anything at all.\n  if (fixedServerUrl && fixedWorkflowId && fixedLoginName && fixedLoginPassword) {\n    return null;\n  }\n\n  const icons = {\n    testing: faCircleNotch,\n    error: faExclamationCircle,\n    saved: faCheckCircle,\n  };\n  const icon = icons[status];\n\n  return (\n    <SettingsSection title={t('upload-settings-modal-header')}>\n      <Box>\n        {error && <Notification isDanger>{error}</Notification>}\n\n        <form onSubmit={handleSubmit(onSubmit)}>\n          { !fixedServerUrl && <Input\n            errors={errors}\n            label={t('upload-settings-label-server-url')}\n            name=\"serverUrl\"\n            register={register}\n            required\n          /> }\n\n          { !fixedWorkflowId && <Input\n            errors={errors}\n            label={t('upload-settings-label-workflow-id')}\n            name=\"workflowId\"\n            register={register}\n            required\n          /> }\n\n          { !fixedLoginName && <Input\n            errors={errors}\n            label={t('upload-settings-label-username')}\n            name=\"loginName\"\n            register={register}\n            required\n          /> }\n\n          { !fixedLoginPassword && <Input\n            errors={errors}\n            label={t('upload-settings-label-password')}\n            name=\"loginPassword\"\n            register={register}\n            required\n            type=\"password\"\n          /> }\n\n          <footer sx={{ mt: 4 }}>\n            <Button sx={{ verticalAlign: 'middle' }}>\n              {t('upload-settings-button-store')}\n            </Button>\n            { icon && <FontAwesomeIcon\n              icon={icon}\n              sx={{ ml: '10px', fontSize: '30px', verticalAlign: 'middle' }}\n              spin={status === 'testing'}\n            /> }\n            { hasRecording && status === 'saved' && (\n              <Link to=\"/\" sx={{ ml: 3, variant: 'styles.a' }}>\n                {t('settings-back-to-recording')}\n              </Link>\n            )}\n          </footer>\n        </form>\n      </Box>\n    </SettingsSection>\n  );\n}\n\nexport default OpencastSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { Box } from '@theme-ui/components';\n\nimport LanguageSettings from './language';\nimport OpencastSettings from './opencast';\n\n\nconst SettingsPage = ({ settingsManager }) => {\n  const { t } = useTranslation();\n\n  return (\n    <Box sx={{ width: '100%', maxWidth: 960, mx: 'auto', p: 3 }}>\n      <header>\n        <Styled.h1>{t('settings-header')}</Styled.h1>\n      </header>\n\n      <LanguageSettings />\n\n      <OpencastSettings settingsManager={settingsManager} />\n    </Box>\n  );\n};\n\nexport default SettingsPage;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\nimport Notification from './notification';\nimport {\n  onSafari,\n  isRecordingSupported,\n} from \"../util\";\n\n// Conditionally shows a number of warnings to help the user identify problems.\nconst Warnings = ({ settings }) => {\n  const { t } = useTranslation();\n\n  let warnings = [];\n\n  // We allow HTTP connections to localhost, as most browsers also seem to allow\n  // video capture in those cases.\n  const usingUnsecureConnection = window.location.protocol !== 'https:' &&\n    window.location.hostname !== \"localhost\" &&\n    window.location.hostname !== \"127.0.0.1\";\n  if (usingUnsecureConnection) {\n    warnings.push(\n        <Notification key=\"unsecure-connection\" isDanger>{t('warning-https')}</Notification>\n    );\n  }\n\n  // Warning about missing `MediaRecorder` support\n  if (!isRecordingSupported()) {\n    warnings.push(\n      <Notification key=\"media-recorder\" isDanger>\n        {t('warning-recorder-not-supported')}\n        {onSafari() && ' ' + t('warning-recorder-safari-hint')}\n      </Notification>\n    );\n  }\n\n\n  return warnings.length > 0\n    ? <div sx={{ p: 3 }}>{ warnings }</div>\n    : null;\n};\n\nexport default Warnings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Flex } from '@theme-ui/components';\nimport PropTypes from 'prop-types';\nimport { useState } from 'react';\nimport { BrowserRouter as Router, Switch, Redirect, Route } from 'react-router-dom';\n\nimport { Provider } from './recording-context';\n\nimport About from './ui/about';\nimport OpencastHeader from './ui/opencast-header';\nimport Studio from './ui/studio/page';\nimport SettingsPage from './ui/settings/page';\nimport Warnings from './ui/warnings';\n\n\nfunction App({ settingsManager }) {\n  const [settings, updateSettings] = useState(settingsManager.settings());\n  settingsManager.onChange = newSettings => updateSettings(newSettings);\n\n  const [activeStep, updateActiveStep] = useState(0);\n\n  return (\n    <Provider>\n      <Router basename={process.env.PUBLIC_URL || '/'}>\n        <Flex sx={{ flexDirection: 'column', height: '100%' }}>\n          <OpencastHeader />\n\n          <main sx={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: '285px' }}>\n            <Warnings settings={settings} />\n\n            <Switch>\n              <Route path=\"/settings\" exact>\n                <SettingsPage settingsManager={settingsManager} />\n              </Route>\n\n              <Route path=\"/about\" exact>\n                <About />\n              </Route>\n\n              <Route path=\"/\" exact>\n                <Studio\n                  settings={settings}\n                  activeStep={activeStep}\n                  updateActiveStep={updateActiveStep}\n                />\n              </Route>\n\n              <Route path=\"/*\">\n                <Redirect to=\"/\" />\n              </Route>\n            </Switch>\n          </main>\n        </Flex>\n      </Router>\n    </Provider>\n  );\n}\n\nApp.propTypes = {\n  defaultSettings: PropTypes.object\n};\n\n\nexport default App;\n"],"sourceRoot":""}