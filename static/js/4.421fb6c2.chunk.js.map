{"version":3,"sources":["studio-state.js","ui/about.js","ui/navigation.js","ui/opencast-header.js","ui/studio/steps.js","ui/studio/capturer.js","ui/studio/elements.js","ui/notification.js","ui/studio/audio-setup/preview-audio.js","ui/studio/audio-setup/index.js","ui/studio/save-creation/form-field.js","ui/studio/save-creation/recording-preview.js","ui/studio/save-creation/index.js","ui/studio/video-setup/preview.js","ui/studio/video-setup/index.js","ui/studio/recording/media-devices.js","recorder.js","ui/studio/recording/recording-buttons.js","ui/studio/recording/clock.js","ui/studio/recording/recording-controls.js","ui/studio/recording/index.js","ui/studio/review/index.js","ui/studio/page.js","languages.js","ui/settings/elements.js","ui/settings/language.js","ui/settings/opencast.js","ui/settings/page.js","ui/warnings.js","App.js"],"names":["defaultMetaData","title","presenter","metaData","initialState","audioAllowed","audioStream","audioSupported","isUserCaptureSupported","displayAllowed","displayStream","displaySupported","isDisplayCaptureSupported","userAllowed","userStream","userSupported","audioChoice","recordings","upload","error","state","reducer","action","type","payload","mapped","map","recording","index","downloaded","Error","stateContext","createContext","dispatchContext","Provider","children","useReducer","dispatch","value","useDispatch","useContext","useStudioState","property","LegalNotices","h2","p","h3","icon","faGlobeEurope","a","href","faEnvelope","faPhone","About","props","h1","Fragment","process","aria-label","NavElement","target","rest","location","useLocation","to","pathname","search","exact","activeStyle","backgroundColor","sx","color","pl","pr","textDecoration","fontSize","height","borderLeft","theme","colors","gray","display","width","textAlign","mr","Navigation","useState","isOpened","updateIsOpened","closeMenu","t","useTranslation","onClick","border","borderRadius","my","px","mx","whiteSpace","faTimes","faCaretDown","ml","ref","n","style","scrollHeight","overflow","zIndex","top","heights","headerHeight","position","transition","scrollX","faVideo","faWrench","faInfoCircle","opacity","bottom","left","right","BetaBubble","verticalAlign","borderWidth","borderStyle","borderColor","padding","Brand","media","srcSet","src","alt","OpencastHeader","lineHeight","justifyContent","Steps","activeStep","updateActiveStep","childProps","currentStep","totalSteps","length","nextStep","setActiveStep","previousStep","goToStep","firstStep","lastStep","childrenWithProps","React","Children","child","i","isActive","isReactComponent","cloneElement","step","next","isInvalidStep","console","deviceId","navigator","mediaDevices","getUserMedia","audio","video","stream","getTracks","forEach","track","onended","startDisplayCapture","displayMediaOptions","getDisplayMedia","defaultUserConstraints","ideal","max","startUserCapture","userMediaOptions","constraints","stopAudioCapture","stop","stopDisplayCapture","stopUserCapture","ActionButtons","prev","alignItems","minHeight","flex","danger","variant","disabled","faCaretLeft","label","faCaretRight","VideoBoxResizeContext","useVideoBoxResize","VideoBox","gap","useResizeObserver","setForceCounter","dimensions","c","resizeVideoBox","newDimensions","equal","v","ar","childWidth","childHeight","extraChildHeight","extraHeight","aspectRatio","availableHeight","minWidth","margin","body","widths","flexDirection","aspectRatios","Math","availableWidth","combinedAspectRatio","rowHeights","Array","fill","rowWidths","baseHeight","colHeights","colWidths","Notification","isDanger","marginBottom","PreviewAudio","canvasRef","useRef","useThemeUI","useEffect","canvas","current","ctx","getContext","lineWidth","strokeStyle","source","window","AudioContext","webkitAudioContext","createMediaStreamSource","scope","Oscilloscope","fftSize","animate","bg","m","mb","AudioSetup","nextIsDisabled","maxWidth","maxHeight","faMicrophone","selected","startAudioCapture","then","success","size","mt","as","faMicrophoneSlash","OptionButton","selectedStyle","fontFamily","FormField","fontWeight","boxSizing","clear","RecordingPreview","deviceType","url","mimeType","onDownload","flavor","downloadName","recordingFileName","pb","muted","onLoadedData","e","currentTime","preload","faCheckCircle","download","rel","faDownload","Input","SaveCreation","settings","useSettings","opencast","useOpencast","uploadState","handleInputChange","event","name","workflowId","seriesId","filter","Boolean","creator","getState","STATE_INCORRECT_LOGIN","uploadBox","allDownloaded","every","rec","possiblyDone","isReadyToUpload","autoComplete","defaultValue","onChange","faUpload","prettyServerUrl","i18nKey","server","key","borderBottom","flexWrap","confirm","faRedoAlt","SourcePreview","reselectSource","warnings","inputs","StreamPreview","input","text","kind","dimensionsOf","getVideoTracks","getSettings","allowed","PreviewVideo","inner","videoRef","srcObject","addEventListener","removeEventListener","autoPlay","faExclamationTriangle","VideoSetup","hideActionButtons","hasStreams","anySupported","bothSupported","activeSource","setActiveSource","USER_CONSTRAINTS","facingMode","clickUser","clickDisplay","clickBoth","nextDisabled","userWarning","displayWarning","faChalkboard","faChalkboardTeacher","faUser","Spacer","MediaDevices","recordingState","paused","STATE_PAUSED","push","MediaDevice","pause","play","boxShadow","cursor","faPause","animation","outline","background","Recorder","options","undefined","MediaRecorder","configuredMime","mimes","find","mime","isTypeSupported","debug","videoBitsPerSecond","videoBitrate","_recData","this","recorder","ondataavailable","data","onerror","onError","onstop","Blob","URL","createObjectURL","onStop","isRecording","isPaused","start","resume","Button","large","svg","PauseButton","className","faPauseCircle","RecordButton","countdown","faCircleNotch","faCircle","spin","transform","ResumeButton","faPlayCircle","StopButton","faStopCircle","Clock","milliseconds","Date","setInterval","tick","stopTimer","timerId","clearInterval","prevProps","resumeTimer","now","passed","setState","duration","timeArr","slice","content","unit","join","Component","addRecordOnStop","mixAudioIntoVideo","videoStream","getAudioTracks","MediaStream","RecordingControls","handleRecorded","setRecordingState","desktopRecorder","videoRecorder","STATE_INACTIVE","onBeforeunload","preventDefault","STATE_RECORDING","record","Recording","recordingDispatch","backToAudio","useCallback","flexGrow","refreshConnection","stopCapture","Review","Preview","videoRefs","createRef","desktopIndex","volume","lastOrigin","va","vb","installEventHandlers","eventName","handler","weTriggered","origin","frameCounter","requestAnimationFrame","fixTime","abs","controls","Wizard","isRecordingSupported","languages","short","long","rtl","errors","register","required","validate","aria-invalid","aria-describedby","id","message","SettingsSection","LanguageSettings","i18n","language","changeLanguage","OpencastSettings","settingsManager","setError","useForm","defaultValues","formValues","handleSubmit","status","setStatus","hasRecording","Opencast","init","oc","STATE_LOGGED_IN","STATE_NETWORK_ERROR","STATE_RESPONSE_NOT_OK","STATE_INVALID_RESPONSE","STATE_CONNECTED","STATE_UNCONFIGURED","setGlobalInstance","saveSettings","isLoginProvided","showServerUrl","isConfigurable","showUsername","isUsernameConfigurable","showPassword","isPasswordConfigurable","testing","faExclamationCircle","saved","onSubmit","protocol","err","startsWith","SettingsPage","Warnings","hostname","onSafari","Routes","path","PreventClose","App","basename"],"mappings":"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","file":"static/js/4.421fb6c2.chunk.js","sourcesContent":["//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { createContext, useContext, useReducer } from 'react';\nimport { isDisplayCaptureSupported, isUserCaptureSupported } from './util';\n\n\nexport const MICROPHONE = 'microphone';\nexport const MICROPHONE_REQUEST = 'microphone_request';\nexport const NO_AUDIO = 'no-audio';\nexport const NONE = 'none';\n\nexport const STATE_NOT_UPLOADED = 'not_uploaded';\nexport const STATE_UPLOADING = 'uploading';\nexport const STATE_UPLOADED = 'uploaded';\nexport const STATE_ERROR = 'error';\n\n// We use this global variable (scoped to this module) to save all metadata\n// changes. We don't want to use state as that would lead to many useless\n// rerenders.\nconst defaultMetaData = {\n  title: '',\n  presenter: '',\n};\nexport let metaData = { ...defaultMetaData };\n\n\nconst initialState = () => ({\n  audioAllowed: null,\n  audioStream: null,\n  audioSupported: isUserCaptureSupported(),\n\n  displayAllowed: null,\n  displayStream: null,\n  displaySupported: isDisplayCaptureSupported(),\n\n  userAllowed: null,\n  userStream: null,\n  userSupported: isUserCaptureSupported(),\n\n  audioChoice: NONE,\n\n  recordings: [],\n\n  upload: {\n    error: null,\n    state: STATE_NOT_UPLOADED,\n  },\n});\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'CHOOSE_AUDIO':\n      return { ...state, audioChoice: action.payload };\n\n    case 'SHARE_AUDIO':\n      return { ...state, audioStream: action.payload, audioAllowed: true };\n\n    case 'BLOCK_AUDIO':\n      return { ...state, audioStream: null, audioAllowed: false };\n\n    case 'UNSHARE_AUDIO':\n      return { ...state, audioStream: null };\n\n    case 'SHARE_DISPLAY':\n      return { ...state, displayStream: action.payload, displayAllowed: true };\n\n    case 'BLOCK_DISPLAY':\n      return { ...state, displayStream: null, displayAllowed: false };\n\n    case 'UNSHARE_DISPLAY':\n      return { ...state, displayStream: null };\n\n    case 'SHARE_USER':\n      return { ...state, userStream: action.payload, userAllowed: true };\n\n    case 'BLOCK_USER':\n      return { ...state, userStream: null, userAllowed: false };\n\n    case 'UNSHARE_USER':\n      return { ...state, userStream: null };\n\n    case 'ADD_RECORDING':\n      return { ...state, recordings: [...state.recordings, action.payload] };\n\n    case 'UPLOAD_ERROR':\n      return { ...state, upload: { ...state.upload, error: action.payload, state: STATE_ERROR }};\n\n    case 'UPLOAD_FAILURE':\n      return { ...state, upload: { ...state.upload, error: action.payload, state: STATE_ERROR }};\n\n    case 'UPLOAD_REQUEST':\n      return { ...state, upload: { ...state.upload, error: null, state: STATE_UPLOADING }};\n\n    case 'UPLOAD_SUCCESS':\n      return { ...state, upload: { ...state.upload, error: null, state: STATE_UPLOADED }};\n\n    case 'MARK_DOWNLOADED':\n      const mapped = state.recordings.map((recording, index) => (\n        index === action.payload ? { ...recording, downloaded: true } : recording\n      ));\n      return { ...state, recordings: mapped };\n\n    case 'RESET':\n      metaData = { ...defaultMetaData };\n      return initialState();\n\n    default:\n      throw new Error();\n  }\n};\n\nconst stateContext = createContext(null);\nconst dispatchContext = createContext(null);\n\nexport const Provider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState());\n\n  return (\n    <dispatchContext.Provider value={dispatch}>\n      <stateContext.Provider value={state}>{children}</stateContext.Provider>\n    </dispatchContext.Provider>\n  );\n};\n\nexport const useDispatch = () => useContext(dispatchContext);\n\nexport const useStudioState = (property = null) => {\n  const state = useContext(stateContext);\n  return property !== null ? state[property] : state;\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport React from 'react';\nimport { jsx, Styled } from 'theme-ui';\nimport { Container } from '@theme-ui/components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faGlobeEurope, faEnvelope, faPhone } from '@fortawesome/free-solid-svg-icons';\n\n\nfunction LegalNotices() {\n  return (\n    <article>\n      <Styled.h2>ELAN e.V.</Styled.h2>\n\n      <Styled.p>\n        The e-learning academic network (ELAN e.V.) is a German non-profit organization supporting\n        higher-education organizations in all matters related to e-learning. Our services include\n        practical tips about how to use digital technologies in education, legal advice and\n        development of free, open-source software to support education.\n      </Styled.p>\n\n      <Styled.h3>Contact</Styled.h3>\n\n      <Styled.p>\n        Dr. Norbert Kleinefeld, Geschäftsführer\n        <br />\n        Karlstr. 23\n        <br />\n        D-26123 Oldenburg\n      </Styled.p>\n\n      <Styled.p>\n        <FontAwesomeIcon icon={faGlobeEurope} />{' '}\n        <Styled.a href=\"https://elan-ev.de\">elan-ev.de</Styled.a>\n        <br />\n        <FontAwesomeIcon icon={faEnvelope} />{' '}\n        <Styled.a href=\"mailto:kontakt@elan-ev.de\">kontakt@elan-ev.de</Styled.a>\n        <br />\n        <FontAwesomeIcon icon={faPhone} />{' '}\n        <Styled.a href=\"tel:+4944199866610\">+49&thinsp;441 998&thinsp;666&thinsp;10</Styled.a>\n      </Styled.p>\n\n      <Styled.p>\n        Registergericht: Amtsgericht Oldenburg\n        <br />\n        Registernummer: VR 200644\n        <br />\n        USt.-ID-Nr.: DE 265901392\n      </Styled.p>\n    </article>\n  );\n}\n\nfunction About(props) {\n  return (\n    <Container>\n      <article>\n        <header>\n          <Styled.h1>Opencast Studio</Styled.h1>\n        </header>\n        <Styled.p>\n          A web-based recording studio for <Styled.a href=\"https://opencast.org\">Opencast</Styled.a>.\n        <Styled.p>\n        </Styled.p>\n          Opencast Studio allows you to record your camera, your display and your microphoneʼs audio.\n          You can then either download your recordings or upload them directly to an Opencast\n          instance (usually the one of your university).\n        </Styled.p>\n        <Styled.p>\n          This application is free, open software developed{' '}\n          <Styled.a href=\"https://github.com/elan-ev/opencast-studio\">on GitHub</Styled.a>.\n        </Styled.p>\n\n        <Styled.h2>How it works</Styled.h2>\n        <Styled.p>\n          Opencast Studio uses the recording capabilities built into modern browsers to record\n          audio and video streams. The recording happens in the userʼs browser and no server is\n          involved in the recording.\n        </Styled.p>\n\n        { process.env.REACT_APP_INCLUDE_LEGAL_NOTICES === '1' && (\n          <React.Fragment>\n            <Styled.h2>Support</Styled.h2>\n            <Styled.p>\n              If you are interested in additional development or want to introduce Opencast Studio\n              at your university, please contact{' '}\n              <Styled.a href=\"mailto:opencast-support@elan-ev.de\">\n                opencast-support@elan-ev.de\n              </Styled.a>.\n            </Styled.p>\n          </React.Fragment>\n        )}\n\n        { process.env.REACT_APP_INCLUDE_LEGAL_NOTICES === '1' && <LegalNotices /> }\n\n        <Styled.h2>Version</Styled.h2>\n        <Styled.p>\n          Build date {process.env.REACT_APP_BUILD_DATE || '?'},\n          commit{' '}\n          <Styled.a\n            aria-label=\"Git commit on GitHub\"\n            href={\"https://github.com/elan-ev/opencast-studio/commit/\"\n                  + process.env.REACT_APP_GIT_SHA }\n            >\n            {process.env.REACT_APP_GIT_SHA || '?'}\n          </Styled.a>.\n        </Styled.p>\n      </article>\n    </Container>\n  );\n}\n\nexport default About;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { NavLink, useLocation } from 'react-router-dom';\nimport { Fragment, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCaretDown,\n  faTimes,\n  faWrench,\n  faInfoCircle,\n  faVideo,\n} from \"@fortawesome/free-solid-svg-icons\";\n\n\n// One element (link) in the navigation.\nconst NavElement = ({ target, children, icon, ...rest }) => {\n  const location = useLocation();\n\n  return (\n    <NavLink\n      to={{\n        pathname: target,\n        search: location.search,\n      }}\n      exact\n      activeStyle={{\n        backgroundColor: 'black',\n      }}\n      sx={{\n        color: 'white',\n        pl: [3, 3, '10px'],\n        pr: [3, 3, '14px'],\n        textDecoration: 'none',\n        fontSize: '18px',\n        height: ['auto', 'auto', '100%'],\n        borderLeft: ['none', 'none', theme => `1px solid ${theme.colors.gray[3]}`],\n        display: ['block', 'block', 'inline-block'],\n        width: ['100%', '100%', 'auto'],\n\n        '&:hover': {\n          backgroundColor: 'gray.1',\n        },\n      }}\n      {...rest}\n    >\n      <div sx={{\n        width: '20px',\n        display: 'inline-block',\n        textAlign: 'right',\n        mr: [3, 3, 2],\n      }}>\n        <FontAwesomeIcon icon={icon} />\n      </div>\n      {children}\n    </NavLink>\n  );\n}\n\n// The whole responsive navigation element.\nconst Navigation = props => {\n  const [isOpened, updateIsOpened] = useState(false);\n  const toggleMenu = () => updateIsOpened(!isOpened);\n  const closeMenu = () => updateIsOpened(false);\n  const { t } = useTranslation();\n\n  return (\n    <Fragment>\n      <button\n        onClick={toggleMenu}\n        sx={{\n          display: ['inline-block', 'inline-block', 'none'],\n          border: theme => `2px solid ${theme.colors.gray[3]}`,\n          borderRadius: '10px',\n          color: 'white',\n          my: 1,\n          px: 3,\n          mx: 1,\n          fontSize: '20px',\n          whiteSpace: 'nowrap',\n          backgroundColor: 'transparent',\n          '&:hover': {\n            backgroundColor: 'gray.1',\n          },\n          '&:active': {},\n        }}\n      >\n        {t('nav-open-menu-button')}\n        <span sx={{ width: '23px', display: 'inline-block' }}>\n          <FontAwesomeIcon\n            icon={isOpened ? faTimes : faCaretDown}\n            sx={{ ml: '10px' }}\n          />\n        </span>\n      </button>\n      <nav\n        ref={n => {\n          if (n) {\n            n.style.height = isOpened ? n.scrollHeight + 'px' : \"\";\n          }\n        }}\n        sx={{\n          overflow: 'hidden',\n          zIndex: 10,\n          // This \"!important\" is necessary unfortunately to override the inline\n          // style set in the `ref` attribute above. Otherwise opening the menu\n          // in mobile view and switching to desktop view (e.g. by rotating\n          // phone) would result in a very strange artifact.\n          height: ['0px', '0px', '100% !important'],\n          top: [theme => theme.heights.headerHeight, theme => theme.heights.headerHeight, 0],\n          position: ['absolute', 'absolute', 'static'],\n          width: ['100%', '100%', 'auto'],\n          backgroundColor: ['gray.0', 'gray.0', 'none'],\n          transition: ['height 0.25s ease-out 0s', 'height 0.25s ease-out 0s', 'none'],\n          scrollX: ['none', 'none', 'auto'],\n        }}\n      >\n        <NavElement target=\"/\" icon={faVideo} onClick={closeMenu}>\n          {t('nav-recording')}\n        </NavElement>\n        <NavElement target=\"/settings\" icon={faWrench} onClick={closeMenu}>\n          {t('nav-settings')}\n        </NavElement>\n        <NavElement target=\"/about\" icon={faInfoCircle} onClick={closeMenu}>\n          {t('nav-about')}\n        </NavElement>\n      </nav>\n\n      {/* A black, half-transparent overlay over the body */}\n      {isOpened && <div\n        onClick={closeMenu}\n        ref={n => n && (n.style.opacity = 1)}\n        sx={{\n          display: [isOpened ? 'block' : 'none', isOpened ? 'block' : 'none', 'none'],\n          backgroundColor: 'rgba(0, 0, 0, 0.7)',\n          position: 'fixed',\n          zIndex: -10,\n          top: 0,\n          bottom: 0,\n          left: 0,\n          right: 0,\n          opacity: 0,\n          transition: 'opacity 0.25s ease-out 0s',\n        }}\n      ></div>}\n    </Fragment>\n  );\n};\n\nexport default Navigation;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Link, useLocation } from 'react-router-dom';\n\nimport Navigation from './navigation';\n\nconst BetaBubble = props => (\n  <span\n    sx={{\n      position: 'relative',\n      top: '4px',\n      fontSize: '12pt',\n      verticalAlign: 'top',\n      display: ['none', 'inline'],\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: 'gray.2',\n      borderRadius: 5,\n      padding: '2px',\n      color: 'gray.2'\n    }}\n    {...props}\n  />\n);\n\nfunction Brand() {\n  const location = useLocation();\n\n  return (\n    <span>\n      <Link to={{ pathname: \"/\", search: location.search }}>\n        <picture>\n          <source\n            media=\"(min-width: 920px)\"\n            srcSet={`${process.env.PUBLIC_URL}/opencast-studio.svg`}\n          />\n          <img\n            src={`${process.env.PUBLIC_URL}/opencast-studio-small.svg`}\n            alt=\"Opencast Studio\"\n            sx={{ height: 50 }}\n          />\n        </picture>\n      </Link>\n\n      <BetaBubble>beta</BetaBubble>\n    </span>\n  );\n}\n\nfunction OpencastHeader() {\n  return (\n    <header\n      sx={{\n        height: theme => theme.heights.headerHeight,\n        lineHeight: theme => theme.heights.headerHeight,\n        color: 'background',\n        display: 'flex',\n        justifyContent: 'space-between',\n        position: 'relative',\n        zIndex: 3,\n      }}\n    >\n      {/* This div is used just for the background color. We can't set it for\n          the parent element, as the navigation overlay would otherwise occlude\n          this background color */}\n      <div sx={{\n        backgroundColor: 'gray.0',\n        position: 'absolute',\n        zIndex: -3,\n        height: '100%',\n        width: '100%',\n      }}></div>\n      <Brand />\n\n      <Navigation />\n    </header>\n  );\n}\n\nexport default OpencastHeader;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport React from 'react';\n\nexport default function Steps({ activeStep, updateActiveStep, ...props }) {\n  const childProps = {\n    currentStep: activeStep + 1,\n    totalSteps: props.children?.length || 0,\n    nextStep,\n    previousStep,\n    goToStep,\n    firstStep,\n    lastStep\n  };\n\n  const childrenWithProps = React.Children.map(props.children, (child, i) => {\n    childProps.isActive = i === activeStep;\n\n    return childProps.isActive\n      ? isReactComponent(child)\n        ? React.cloneElement(child, childProps)\n        : child\n      : null;\n  });\n\n  return <React.Fragment>{childrenWithProps}</React.Fragment>;\n\n  function firstStep() {\n    goToStep(1);\n  }\n\n  function lastStep() {\n    goToStep(props.children.length);\n  }\n\n  function nextStep() {\n    setActiveStep(activeStep + 1);\n  }\n\n  function previousStep() {\n    setActiveStep(activeStep - 1);\n  }\n\n  function goToStep(step) {\n    setActiveStep(step - 1);\n  }\n\n  function setActiveStep(next) {\n    if (activeStep === next) {\n      return;\n    }\n    if (isInvalidStep(next, props.children)) {\n      console.error(`${next + 1} is an invalid step`);\n      return;\n    }\n\n    updateActiveStep(next);\n  }\n}\n\nfunction isInvalidStep(next, children) {\n  return next < 0 || next >= children.length;\n}\n\nfunction isReactComponent({ type }) {\n  return typeof type === 'function' || typeof type === 'object';\n}\n","export async function startAudioCapture(dispatch, deviceId = null) {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: deviceId ? { deviceId } : true,\n      video: false\n    });\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'UNSHARE_AUDIO' });\n      };\n    });\n\n    dispatch({ type: 'SHARE_AUDIO', payload: stream });\n    return true;\n  } catch (err) {\n    // TODO: there several types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_AUDIO' });\n    return false;\n  }\n}\n\nexport async function startDisplayCapture(\n  dispatch,\n  displayMediaOptions = { video: true, audio: false }\n) {\n  try {\n    const stream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'UNSHARE_DISPLAY' });\n      };\n    });\n\n    dispatch({ type: 'SHARE_DISPLAY', payload: stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_DISPLAY' });\n  }\n}\n\nconst defaultUserConstraints = {\n  audio: true,\n  video: {\n    width: { ideal: 1280, max: 1920 },\n    height: { ideal: 720, max: 1080 }\n  }\n};\n\nexport async function startUserCapture(dispatch, userMediaOptions = null) {\n  const constraints = userMediaOptions || defaultUserConstraints;\n\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    stream.getTracks().forEach(track => {\n      track.onended = () => {\n        dispatch({ type: 'UNSHARE_USER' });\n      };\n    });\n    dispatch({ type: 'SHARE_USER', payload: stream });\n  } catch (err) {\n    // TODO: there 7 types of exceptions; certainly we should differentiate here one day\n    console.error('Error: ' + err);\n\n    dispatch({ type: 'BLOCK_USER' });\n  }\n}\n\n// ----------------------------------------------------------------------------\n\nexport function stopCapture({ audioStream, displayStream, userStream }, dispatch) {\n  stopAudioCapture(audioStream, dispatch);\n  stopDisplayCapture(displayStream, dispatch);\n  stopUserCapture(userStream, dispatch);\n}\n\nexport function stopAudioCapture(stream, dispatch) {\n  stream && stream.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_AUDIO' });\n}\n\nexport function stopDisplayCapture(stream, dispatch) {\n  stream && stream.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_DISPLAY' });\n}\n\nexport function stopUserCapture(stream, dispatch) {\n  stream && stream.getTracks().forEach(track => track.stop());\n  dispatch({ type: 'UNSHARE_USER' });\n}\n\n// ----------------------------------------------------------------------------\n\nexport function addAudioToStream(videoStream, audioStream, dispatch, actionType) {\n  if (videoStream) {\n    videoStream.getAudioTracks().forEach(track => track.stop());\n\n    const streamWithAudio = new MediaStream([\n      ...videoStream.getVideoTracks(),\n      ...audioStream.getAudioTracks()\n    ]);\n    dispatch({ type: actionType, payload: streamWithAudio });\n  }\n}\n\nexport function removeAudioFromStream(stream, dispatch, actionType) {\n  if (stream) {\n    stream.getAudioTracks().forEach(track => track.stop());\n    const streamWithoutAudio = new MediaStream([...stream.getVideoTracks()]);\n    dispatch({ type: actionType, payload: streamWithoutAudio });\n  }\n}\n\n// ----------------------------------------------------------------------------\n\nexport async function selectCamera(dispatch, deviceId) {\n  const constraints = { ...defaultUserConstraints, video: { deviceId } };\n  startUserCapture(dispatch, constraints);\n}\n\nexport async function selectMicrophone(dispatch, deviceId) {\n  const constraints = { ...defaultUserConstraints, audio: { deviceId } };\n  startUserCapture(dispatch, constraints);\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport useResizeObserver from \"use-resize-observer/polyfilled\";\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCaretLeft, faCaretRight } from '@fortawesome/free-solid-svg-icons';\nimport { Box, Button, Flex } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\nimport React, { useState } from 'react';\nimport equal from 'fast-deep-equal';\n\n// A div containing optional \"back\" and \"next\" buttons as well as the centered\n// children. The props `prev` and `next` are objects with the follwing fields:\n//\n// - `onClick`: forwarded to the `<Button>`\n// - `disabled`: forwarded to the `<Button>`\n// - `label` (optional): the button label translation string. If not specified,\n//   the label is 'back-button-label' or 'next-button-label'.\n// - `danger` (optional): forwarded to the `<Button>`, default: `false`.\nexport function ActionButtons({ prev = null, next = null, children }) {\n  const { t } = useTranslation();\n\n  return (\n    <Flex sx={{ alignItems: 'end', minHeight: '40px' }}>\n      <Box sx={{ flex: '1 1 0', textAlign: 'left' }}>\n        {prev && (\n          <Button\n            sx={{\n              whiteSpace: 'nowrap',\n              ...prev.danger === true ? { variant: 'buttons.danger' } : { variant: 'buttons.text' }\n            }}\n            onClick={prev.onClick}\n            disabled={prev.disabled}\n            danger={prev.danger || false}\n          >\n            <FontAwesomeIcon icon={faCaretLeft} />\n            {t(prev.label || 'back-button-label')}\n          </Button>\n        )}\n      </Box>\n      <Box>{children}</Box>\n      <Box sx={{ flex: '1 1 0', textAlign: 'right' }}>\n        {next && (\n          <Button\n            sx={{\n              whiteSpace: 'nowrap',\n              '& svg': { mr: 0, ml: 2 },\n              ...next.danger === true ? { variant: 'buttons.danger' } : {}\n            }}\n            onClick={next.onClick}\n            disabled={next.disabled}\n          >\n            {t(next.label || 'next-button-label')}\n            <FontAwesomeIcon icon={faCaretRight} />\n          </Button>\n        )}\n      </Box>\n    </Flex>\n  );\n}\n\nconst VideoBoxResizeContext = React.createContext(null);\n\nexport const useVideoBoxResize = () => React.useContext(VideoBoxResizeContext);\n\n// Manages one or two children with given aspect ratio.\n//\n// Each child is given an aspect ratio. The child will be rendered within a\n// `<div>` that maintains this exact aspect ratio. In the one child case, that\n// `<div>` also perfectly fits within the parent container. In the case of two\n// children, those children are laid out in such a way that the utilized screen\n// space is maximized.\n//\n// `children` has to be the length 1 or 2! The parameter `gap` specifies the\n// width of the empty space between the two children in the case that two\n// children are given.\n//\n// Each child in `children` needs to be an object with the following fields:\n//\n// - `body`: the rendered DOM.\n// - `aspectRatio`: the desired aspect ratio for the child.\n// - `extraHeight`: sometimes the rendered child has a fixed extra height (for\n//   example to render a title above or information below the video stream).\n//   This extra height is included in the calculation such that the child minus\n//   this extra height has the perfect `aspectRatio` as given above.\nexport function VideoBox({ gap = 0, children }) {\n  const { ref, width = 1, height = 1 } = useResizeObserver();\n\n  // This is a dummy state to force a rerender.\n  const [, setForceCounter] = useState(0);\n  const forceRender = () => {\n    setForceCounter(v => v + 1);\n  };\n\n  // Setup the handler for when a video stream is resized.\n  let dimensions = children.map(c => c.dimensions());\n  const resizeVideoBox = () => {\n    const newDimensions = children.map(c => c.dimensions());\n    if (!equal(newDimensions, dimensions)) {\n      dimensions = newDimensions;\n      forceRender();\n    }\n  }\n\n  const ar = ([width, height]) => width && height ? width / height : 16 / 9;\n\n  switch (children.length) {\n    case 1: {\n      const child = children[0];\n      const extraChildHeight = child.extraHeight || 0;\n      const aspectRatio = ar(child.dimensions());\n\n\n      // Calculate size of child\n      let childWidth;\n      let childHeight;\n\n      const availableHeight = height - extraChildHeight;\n      if (width > availableHeight * aspectRatio) {\n        // Child height perfectly matches container, extra space left and right\n        childHeight = availableHeight + extraChildHeight;\n        childWidth = availableHeight * aspectRatio;\n      } else {\n        // Child width perfectly matches container, extra space top and bottom\n        childWidth = width;\n        childHeight = (width / aspectRatio) + extraChildHeight;\n      }\n\n      return (\n        <VideoBoxResizeContext.Provider value={resizeVideoBox}>\n          <div ref={ref} sx={{ flex: '1 0 0', minHeight: 0, display: 'flex' }}>\n            <div sx={{ height: childHeight, width: childWidth, minWidth: '180px', margin: 'auto' }}>\n              { child.body }\n            </div>\n          </div>\n        </VideoBoxResizeContext.Provider>\n      );\n    }\n    case 2: {\n      // We need to decide whether the two videos are side by side or if one\n      // should be below the other. We calculate the utilized space for each\n      // option and then take the option that utilizes more space.\n      //\n      // Below we need to figure out the aspect ratios of the combined videos\n      // either in row or column layout. Consider this table:\n      //\n      // |             | a      | b      | row    | column |\n      // | ----------- | ------ | ------ | ------ | ------ |\n      // | aspect      | 16:9   | 4:3    | 28:9   | 16:21  |\n      // | normalized  | 1.77:1 | 1.33:1 | 3.11:1 | 0.76:1 |\n      //\n      // It shows the two aspect ratios a and b combined in both ways. In the\n      // \"row\" case, the combined aspect ratio is simple: just add both children\n      // aspect ratios. The column case is more difficult. First we have to\n      // normalize both with respect to the width. This results in 1:0.56 and\n      // 1:0.75 respectively. We can now add those, resulting in 1:1.31.\n      // Finally, we normalize with respect to height again: 0.76:1\n\n      const aspectRatios = children.map(c => ar(c.dimensions()));\n\n      // Videos side by side (row).\n      const { rowWidths, rowHeights } = (() => {\n        const extraHeight = Math.max(children[0].extraHeight || 0, children[1].extraHeight || 0);\n        const availableHeight = height - extraHeight;\n        const availableWidth = width - gap;\n        const combinedAspectRatio = aspectRatios[0] + aspectRatios[1];\n        if (availableWidth > availableHeight * combinedAspectRatio) {\n          // Children height perfectly matches container, extra space left and\n          // right.\n          return {\n            rowHeights: Array(2).fill(availableHeight + extraHeight),\n            rowWidths: aspectRatios.map(ar => availableHeight * ar),\n          };\n        } else {\n          // Children width perfectly matches container, extra space top and\n          // bottom.\n          const baseHeight = availableWidth / combinedAspectRatio;\n          return {\n            rowHeights: children.map(c => baseHeight + (c.extraHeight || 0)),\n            rowWidths: aspectRatios.map(ar => baseHeight * ar),\n          }\n        }\n      })();\n\n      // One video below the other (col/column).\n      const { colWidths, colHeights } = (() => {\n        const extraHeight = gap + (children[0].extraHeight || 0) + (children[1].extraHeight || 0);\n        const availableHeight = height - extraHeight;\n        const combinedAspectRatio =\n          1 / ((1 / aspectRatios[0]) + (1 / aspectRatios[1]));\n\n        if (width > availableHeight * combinedAspectRatio) {\n          // Children height perfectly matches container, extra space left and\n          // right.\n          const width = availableHeight * combinedAspectRatio;\n          return {\n            colHeights: children.map((c, i) => (width / aspectRatios[i]) + (c.extraHeight || 0)),\n            colWidths: Array(2).fill(width),\n          };\n        } else {\n          // Children width perfectly matches container, extra space top and\n          // bottom.\n          return {\n            colHeights: children.map((c, i) => (width / aspectRatios[i]) + (c.extraHeight || 0)),\n            colWidths: Array(2).fill(width),\n          }\n        }\n      })();\n\n      // Finally, we compare the areas the two layouts would use. The one with\n      // the larger area utilized wins.\n      const rowArea = rowWidths[0] * rowHeights[0] + rowWidths[1] * rowHeights[1];\n      const colArea = colWidths[0] * colHeights[0] + colWidths[1] * colHeights[1];\n      let widths;\n      let heights;\n      let flexDirection;\n      if (rowArea > colArea) {\n        flexDirection = 'row';\n        widths = rowWidths;\n        heights = rowHeights;\n      } else {\n        flexDirection = 'column';\n        widths = colWidths;\n        heights = colHeights;\n      }\n\n      return (\n        <VideoBoxResizeContext.Provider value={resizeVideoBox}>\n          <div\n            ref={ref}\n            sx={{\n              flex: '1 0 0',\n              display: 'flex',\n              flexDirection,\n              justifyContent: 'space-between',\n              minHeight: 0,\n            }}\n          >\n            <div sx={{ height: heights[0], width: widths[0], minWidth: '180px', margin: 'auto' }}>\n              { children[0].body }\n            </div>\n            <div sx={{ height: heights[1], width: widths[1], minWidth: '180px', margin: 'auto' }}>\n              { children[1].body }\n            </div>\n          </div>\n        </VideoBoxResizeContext.Provider>\n      );\n    }\n    default:\n      return <p>Internal error: too few or too many video streams</p>;\n  }\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nconst Notification = ({isDanger, ...rest}) => (\n  <div\n    sx={{\n      ':not(:last-child)': { marginBottom: '1.5rem' },\n      backgroundColor: isDanger ? 'error' : 'gray.3',\n      color: isDanger ? 'background' : 'currentColor',\n      borderRadius: 2,\n      padding: 3,\n      position: 'relative'\n    }}\n    {...rest}\n  />\n);\n\nexport default Notification;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, useThemeUI } from 'theme-ui';\n\nimport Oscilloscope from 'oscilloscope';\nimport { useEffect, useRef } from 'react';\n\nexport default function PreviewAudio({ stream, ...props }) {\n  const canvasRef = useRef();\n  const { theme } = useThemeUI();\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (canvas) {\n      const ctx = canvas.getContext('2d');\n      ctx.lineWidth = 2;\n      ctx.strokeStyle = '#f1c40f';\n\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const source = audioContext.createMediaStreamSource(stream);\n      const scope = new Oscilloscope(source, { fftSize: 1024 });\n      scope.animate(ctx);\n\n      return () => scope.stop();\n    }\n    return () => {};\n  }, [theme.colors, stream]);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      sx={{\n        width: '80%',\n        height: '100px',\n        bg: 'rgba(0,0,0,0.8)',\n        m: 3,\n        mb: 0,\n        borderRadius: '7px',\n       }}\n    />\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { Container, Flex, Heading, Spinner, Text } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faMicrophone, faMicrophoneSlash } from '@fortawesome/free-solid-svg-icons';\n\nimport {\n  useDispatch,\n  useStudioState,\n  MICROPHONE,\n  MICROPHONE_REQUEST,\n  NO_AUDIO,\n  NONE,\n} from '../../../studio-state';\n\nimport { startAudioCapture, stopAudioCapture } from '../capturer';\nimport { ActionButtons } from '../elements';\nimport Notification from '../../notification';\n\nimport PreviewAudio from './preview-audio';\n\nexport default function AudioSetup(props) {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const audioStream = state.audioStream;\n  const audioAllowed = state.audioAllowed;\n\n  const nextIsDisabled = state.audioChoice === NONE\n    || state.audioChoice === MICROPHONE_REQUEST\n    || (state.audioChoice === MICROPHONE && !audioStream);\n\n  const backToSetupVideo = () => props.previousStep();\n  const enterStudio = () => props.nextStep();\n\n  const selectMicrophone = () => {\n    dispatch({ type: 'CHOOSE_AUDIO', payload: MICROPHONE_REQUEST });\n    startAudioCapture(dispatch).then(success => {\n      const payload = success ? MICROPHONE : NONE;\n      dispatch({ type: 'CHOOSE_AUDIO', payload });\n    });\n  };\n\n  const selectNoAudio = () => {\n    dispatch({ type: 'CHOOSE_AUDIO', payload: NO_AUDIO });\n    if (audioStream) {\n      stopAudioCapture(audioStream, dispatch);\n    }\n  };\n\n  return (\n    <Container\n      sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: '1 1 auto',\n        justifyContent: 'space-between',\n      }}\n    >\n      <Styled.h1 sx={{ textAlign: 'center' }}>{t('sources-audio-question')}</Styled.h1>\n      <Flex\n        sx={{\n          flexDirection: ['column', 'row'],\n          maxWidth: 850,\n          width: '100%',\n          mx: 'auto',\n          mb: 3,\n          flex: '1 0 auto',\n          maxHeight: ['none', '350px'],\n          '& > :first-of-type': {\n            mb: [3, 0],\n            mr: [0, 3],\n          },\n        }}\n      >\n        <OptionButton\n          icon={faMicrophone}\n          label={t('sources-audio-microphone')}\n          selected={state.audioChoice === MICROPHONE}\n          onClick={selectMicrophone}\n        >\n          { state.audioChoice === MICROPHONE_REQUEST && <Spinner size=\"75\"/> }\n          { audioStream && <PreviewAudio stream={audioStream} /> }\n          { audioAllowed === false && state.audioChoice !== MICROPHONE_REQUEST && (\n            <Notification isDanger sx={{ mt: 2 }}>\n              <Heading as=\"h3\" mb={2}>\n                {t('source-audio-not-allowed-title')}\n              </Heading>\n              <Text variant='text'>{t('source-audio-not-allowed-text')}</Text>\n            </Notification>\n          )}\n        </OptionButton>\n        <OptionButton\n          icon={faMicrophoneSlash}\n          label={t('sources-audio-without-audio')}\n          selected={state.audioChoice === NO_AUDIO}\n          onClick={selectNoAudio}\n        >\n        </OptionButton>\n      </Flex>\n\n      <ActionButtons\n        prev={{ onClick: backToSetupVideo }}\n        next={{ onClick: enterStudio, disabled: nextIsDisabled }}\n      />\n    </Container>\n  );\n}\n\nconst OptionButton = ({ children, icon, label, selected, onClick }) => {\n  const selectedStyle = !selected ? {} : {\n    backgroundColor: 'highlight',\n  };\n\n  return (\n    <button\n      onClick={() => selected || onClick() }\n      sx={{\n        fontFamily: 'inherit',\n        color: 'gray.0',\n        border: '2px solid black',\n        borderRadius: '8px',\n        flex: '0 1 50%',\n        p: 2,\n        ...selectedStyle\n      }}\n    >\n      <div sx={{ display: 'block', textAlign: 'center', mb: 3 }}>\n        <FontAwesomeIcon icon={icon} size=\"3x\"/>\n      </div>\n      <div sx={{ fontSize: 4 }}>{label}</div>\n      {children}\n    </button>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nfunction FormField(props) {\n  return (\n    <div\n      sx={{\n        '&:not(:last-child)': {\n          marginBottom: 3\n        }\n      }}\n    >\n      <label\n        sx={{\n          color: 'gray.0',\n          display: 'block',\n          fontSize: 2,\n          fontWeight: 'bold'\n        }}\n      >\n        {props.label}\n        <div\n          sx={{\n            boxSizing: 'border-box',\n            clear: 'both',\n            fontSize: 2,\n            position: 'relative',\n            textAlign: 'left'\n          }}\n        >\n          {props.children}\n        </div>\n      </label>\n    </div>\n  );\n}\n\nexport default FormField;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faDownload, faCheckCircle } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\n\nimport { recordingFileName } from '../../../util.js';\n\nconst RecordingPreview = ({ deviceType, url, mimeType, onDownload, downloaded }) => {\n  const { t } = useTranslation();\n  const flavor = deviceType === 'desktop' ? 'presentation' : 'presenter';\n  const downloadName = recordingFileName(mimeType, flavor);\n\n  if (!url) {\n    return null;\n  }\n\n  return (\n    <div sx={{\n      display: 'flex',\n      flexDirection: 'column',\n      flex: '0 0 auto',\n      mx: 2,\n      pb: '12px',\n      alignItems: 'center',\n    }}>\n      <div sx={{\n        position: 'relative',\n        height: '150px',\n        border: theme => `2px solid ${theme.colors.gray[1]}`,\n      }}>\n        <video\n          muted\n          src={url}\n          // Without this, some browsers show a black video element instead of the first frame.\n          onLoadedData={e => e.target.currentTime = 0}\n          preload=\"auto\"\n          sx={{\n            maxWidth: '100%',\n            height: '100%',\n          }}\n        ></video>\n        { downloaded && (\n          <div sx={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            color: 'primary',\n            backgroundColor: 'rgba(0, 0, 0, 0.4)',\n          }}>\n            <FontAwesomeIcon icon={faCheckCircle} size=\"4x\" />\n          </div>\n        )}\n      </div>\n      <Button\n        as=\"a\"\n        sx={{\n          width: '100%',\n          maxWidth: '170px',\n          margin: 'auto',\n          mt: '10px',\n        }}\n        target=\"_blank\"\n        download={downloadName}\n        href={url}\n        rel=\"noopener noreferrer\"\n        onClick={onDownload}\n      >\n        <FontAwesomeIcon icon={faDownload} />\n        {t('save-creation-download-button')}\n      </Button>\n    </div>\n  );\n};\n\nexport default RecordingPreview;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheckCircle, faUpload, faRedoAlt } from '@fortawesome/free-solid-svg-icons';\nimport { Button, Box, Container, Spinner, Text } from '@theme-ui/components';\nimport React from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport { Trans, useTranslation } from 'react-i18next';\n\nimport { useOpencast, STATE_INCORRECT_LOGIN } from '../../../opencast';\nimport { useSettings } from '../../../settings';\nimport {\n  metaData,\n  useDispatch,\n  useStudioState,\n  STATE_ERROR,\n  STATE_UPLOADING,\n  STATE_UPLOADED,\n} from '../../../studio-state';\n\nimport Notification from '../../notification';\nimport {  } from '../page';\nimport { ActionButtons } from '../elements';\n\nimport FormField from './form-field';\nimport RecordingPreview from './recording-preview';\n\n\nconst Input = props => <input sx={{ variant: 'styles.input' }} {...props} />;\n\nexport default function SaveCreation(props) {\n  const location = useLocation();\n  const settings = useSettings();\n  const { t } = useTranslation();\n  const opencast = useOpencast();\n  const { recordings, upload: uploadState } = useStudioState();\n  const dispatch = useDispatch();\n\n  function handleBack() {\n    props.previousStep();\n  }\n\n  function handleInputChange(event) {\n    const target = event.target;\n    metaData[target.name] = target.value;\n  }\n\n  async function handleUpload() {\n    const { title, presenter } = metaData;\n\n    if (title === '' || presenter === '') {\n      dispatch({ type: 'UPLOAD_ERROR', payload: t('save-creation-form-invalid') });\n      return;\n    }\n\n    dispatch({ type: 'UPLOAD_REQUEST' });\n    const workflowId = settings.upload?.workflowId;\n    const seriesId = settings.upload?.seriesId;\n    const success = await opencast.upload({\n      recordings: recordings.filter(Boolean),\n      title,\n      creator: presenter,\n      workflowId,\n      seriesId,\n    });\n\n    if (success) {\n      dispatch({ type: 'UPLOAD_SUCCESS' });\n    } else {\n      switch (opencast.getState()) {\n        case STATE_INCORRECT_LOGIN:\n          dispatch({ type: 'UPLOAD_FAILURE', payload: t('message-login-failed') });\n          break;\n        default:\n          // TODO: this needs a better message and maybe some special cases.\n          dispatch({ type: 'UPLOAD_FAILURE', payload: t('message-server-unreachable') });\n          break;\n      }\n    }\n  }\n\n  const handleNewRecording = () => {\n    const doIt = window.confirm(t('save-creation-new-recording-warning'));\n    if (doIt) {\n      dispatch({ type: 'RESET' });\n      props.firstStep();\n    }\n  };\n\n  const allDownloaded = recordings.every(rec => rec.downloaded);\n  const possiblyDone = uploadState.state === STATE_UPLOADED || allDownloaded;\n\n  const uploadPossible = opencast.isReadyToUpload();\n\n  let uploadBox;\n  if (!uploadPossible) {\n    uploadBox = (\n      <Notification key=\"opencast-connection\" isDanger>\n        <Trans i18nKey=\"warning-missing-connection-settings\">\n          Warning.\n          <Link\n            to={{ pathname: \"/settings\", search: location.search }}\n            sx={{ variant: 'styles.a', color: '#ff2' }}\n          >\n            settings\n          </Link>\n        </Trans>\n      </Notification>\n    );\n  } else if (uploadState.state === STATE_UPLOADED) {\n    uploadBox = (\n      <React.Fragment>\n        <div sx={{\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n          height: '130px',\n          color: 'primary',\n        }}>\n          <FontAwesomeIcon icon={faCheckCircle} size=\"4x\" />\n        </div>\n        <Text sx={{ textAlign: 'center' }}>{t('message-upload-complete')}</Text>\n      </React.Fragment>\n    );\n  } else {\n    uploadBox = (\n      <React.Fragment>\n        <FormField label={t('save-creation-label-title')}>\n          <Input\n            name=\"title\"\n            autoComplete=\"off\"\n            defaultValue={metaData.title}\n            onChange={handleInputChange}\n            disabled={uploadState.state === STATE_UPLOADING}\n          />\n        </FormField>\n\n        <FormField label={t('save-creation-label-presenter')}>\n          <Input\n            name=\"presenter\"\n            autoComplete=\"off\"\n            defaultValue={metaData.presenter}\n            onChange={handleInputChange}\n            disabled={uploadState.state === STATE_UPLOADING}\n          />\n        </FormField>\n\n        <Button\n          onClick={handleUpload}\n          disabled={recordings.length === 0 || uploadState.state === STATE_UPLOADING}\n        >\n          <FontAwesomeIcon icon={faUpload} />\n          {\n            !opencast.prettyServerUrl() ? t('save-creation-button-upload') :\n              <Trans i18nKey=\"save-creation-upload-to\">\n                Upload to <code sx={{\n                  backgroundColor: 'rgba(0, 0, 0, 0.1)',\n                  borderRadius: '5px',\n                  padding: '1px 3px',\n                }}>{{server: opencast.prettyServerUrl()}}</code>\n              </Trans>\n          }\n        </Button>\n        { uploadState.state === STATE_UPLOADING && (\n          <Spinner size=\"40\" sx={{ verticalAlign: 'middle', ml: 3 }}/>\n        )}\n        <Box sx={{ mt: 2 }}>\n        {\n          (() => { switch (uploadState.state) {\n            case STATE_ERROR:\n              return <Notification isDanger>{uploadState.error}</Notification>;\n            case STATE_UPLOADING:\n              return <Notification>{t('upload-notification')}</Notification>;\n            default:\n              return null;\n          }})()\n        }\n        </Box>\n      </React.Fragment>\n    );\n  }\n\n  return (\n    <Container sx={{ display: 'flex', flexDirection: 'column', flex: '1 0 auto' }}>\n      <Styled.h1 sx={{ textAlign: 'center', fontSize: ['26px', '30px', '32px'] }}>\n        { possiblyDone ? t('save-creation-title-done') : t('save-creation-title') }\n      </Styled.h1>\n\n      <div sx={{\n        display: 'flex',\n        flexDirection: ['column', 'column', 'row'],\n        '& > *': {\n          flex: '1 0 50%',\n          p: [2, 2, '0 32px'],\n          '&:last-child': {\n            borderLeft: ['none', 'none', theme => `1px solid ${theme.colors.gray[3]}`],\n          },\n        },\n      }}>\n        <div>\n          <Styled.h2\n            sx={{ pb: 1, borderBottom: theme => `1px solid ${theme.colors.gray[2]}` }}\n          >{t('save-creation-subsection-title-upload')}</Styled.h2>\n\n          <div sx={{ margin: 'auto' }}>\n            { uploadBox }\n          </div>\n        </div>\n\n        <div>\n          <Styled.h2\n            sx={{ pb: 1, borderBottom: theme => `1px solid ${theme.colors.gray[2]}` }}\n          >{t('save-creation-subsection-title-download')}</Styled.h2>\n\n          <div sx={{\n            display: 'flex',\n            flexDirection: 'row',\n            justifyContent: ['center', 'center', 'start'],\n            flexWrap: 'wrap',\n          }}>\n            {recordings.length === 0 ? <Spinner /> : (\n              recordings.map((recording, index) => (\n                <RecordingPreview\n                  key={index}\n                  deviceType={recording.deviceType}\n                  mimeType={recording.mimeType}\n                  url={recording.url}\n                  downloaded={recording.downloaded}\n                  onDownload={() => dispatch({ type: 'MARK_DOWNLOADED', payload: index })}\n                />\n              ))\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div sx={{ flex: '1 0 40px' }}></div>\n\n      <ActionButtons\n        next={null}\n        prev={possiblyDone ? null : {\n          onClick: handleBack,\n          disabled: false,\n        }}\n      >\n        { !possiblyDone ? null : (\n          <Button\n            sx={{ whiteSpace: 'nowrap' }}\n            onClick={handleNewRecording}\n          >\n            <FontAwesomeIcon icon={faRedoAlt} />\n            {t('save-creation-new-recording')}\n          </Button>\n        )}\n      </ActionButtons>\n    </Container>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Fragment, useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Button, Card, Text, Spinner } from '@theme-ui/components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faExclamationTriangle, faTimes } from '@fortawesome/free-solid-svg-icons';\n\nimport { VideoBox, useVideoBoxResize } from '../elements.js';\nimport { dimensionsOf } from '../../../util.js';\n\nconst SUBBOX_HEIGHT = 40;\n\nexport function SourcePreview({ reselectSource, warnings, inputs }) {\n  let children;\n  switch (inputs.length) {\n    case 1:\n      children = [{\n        body: <StreamPreview input={inputs[0]} text={inputs[0].kind} />,\n        dimensions: () => dimensionsOf(inputs[0].stream),\n        extraHeight: SUBBOX_HEIGHT,\n      }];\n      break;\n    case 2:\n      children = [\n        {\n          body: <StreamPreview input={inputs[0]} text={inputs[0].kind} />,\n          dimensions: () => dimensionsOf(inputs[0].stream),\n          extraHeight: SUBBOX_HEIGHT,\n        },\n        {\n          body: <StreamPreview input={inputs[1]} text={inputs[1].kind} />,\n          dimensions: () => dimensionsOf(inputs[1].stream),\n          extraHeight: SUBBOX_HEIGHT,\n        },\n      ];\n      break;\n    default:\n      return <p>Something went very wrong</p>;\n  }\n\n  return (\n    <Fragment>\n      { warnings }\n      <VideoBox gap={20}>{ children }</VideoBox>\n    </Fragment>\n  );\n}\n\nfunction StreamPreview({ input, text }) {\n  const stream = input.stream;\n  const track = stream?.getVideoTracks()?.[0];\n  const { width, height } = track?.getSettings() ?? {};\n\n  return (\n    <Card sx={{ display: 'flex', flexDirection: 'column', height: '100%', minHeight: 0 }}>\n      <PreviewVideo allowed={input.allowed} stream={stream} />\n      <Text p={2} color=\"muted\" sx={{ height: `${SUBBOX_HEIGHT}px` }}>\n        {text}\n        {track && `: ${width}×${height}`}\n      </Text>\n    </Card>\n  );\n}\n\nexport const PreviewVideo = ({ allowed, stream, ...props }) => {\n  const resizeVideoBox = useVideoBoxResize();\n\n  const videoRef = useRef();\n  useEffect(() => {\n    const v = videoRef.current;\n    if (v) {\n      if (!v.srcObject) {\n        v.srcObject = stream;\n      }\n      v.addEventListener('resize', resizeVideoBox);\n    }\n\n    return () => {\n      if (v) {\n        v.removeEventListener('resize', resizeVideoBox);\n      }\n    };\n  }, [stream, resizeVideoBox]);\n\n  if (!stream) {\n    let inner;\n    if (allowed === false) {\n      inner = <FontAwesomeIcon icon={faExclamationTriangle} size=\"3x\" />;\n    } else {\n      inner = <Spinner size=\"75\"/>;\n    }\n\n    return (\n      <div sx={{\n        width: '100%',\n        height: '100%',\n        minHeight: '120px',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n      }}>\n        { inner }\n      </div>\n    );\n  }\n\n  return (\n    <video\n      ref={videoRef}\n      autoPlay\n      muted\n      sx={{\n        minHeight: 0,\n        display: 'block',\n        width: '100%',\n        height: '100%',\n        // TODO: (mel) research this setting\n        // transform: 'rotateY(180deg)'\n      }}\n    />\n  );\n};\n\nexport const UnshareButton = ({ handleClick }) => {\n  const { t } = useTranslation();\n\n  return (\n    <Button onClick={handleClick} variant=\"text\">\n      <FontAwesomeIcon icon={faTimes} />\n      {t('sources-video-reselect-source')}\n    </Button>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { faChalkboard, faChalkboardTeacher, faUser } from '@fortawesome/free-solid-svg-icons';\nimport { Container, Flex, Heading, Text } from '@theme-ui/components';\nimport { Styled } from 'theme-ui';\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport { useDispatch, useStudioState } from '../../../studio-state';\n\nimport Notification from '../../notification';\n\nimport {\n  startDisplayCapture,\n  startUserCapture,\n  stopDisplayCapture,\n  stopUserCapture\n} from '../capturer';\nimport { ActionButtons } from '../elements';\nimport { SourcePreview } from './preview';\n\n\nexport default function VideoSetup(props) {\n  const { t } = useTranslation();\n\n  const dispatch = useDispatch();\n  const state = useStudioState();\n  const { displayStream, userStream, displaySupported, userSupported } = state;\n\n  const hasStreams = displayStream || userStream;\n  const anySupported = displaySupported || userSupported;\n  const bothSupported = displaySupported && userSupported;\n\n  const BOTH = 'both';\n  const DISPLAY = 'display';\n  const USER = 'user';\n  const NONE = 'none';\n\n  const [activeSource, setActiveSource] = useState(\n    (displayStream && userStream && BOTH)\n      || (displayStream && DISPLAY)\n      || (userStream && USER)\n      || NONE\n  );\n\n  const USER_CONSTRAINTS = {\n    video: { height: { ideal: 1080 }, facingMode: 'user' },\n    audio: false\n  };\n\n  const clickUser = async () => {\n    setActiveSource(USER);\n    await startUserCapture(dispatch, USER_CONSTRAINTS);\n  };\n  const clickDisplay = async () => {\n    setActiveSource(DISPLAY);\n    await startDisplayCapture(dispatch);\n  };\n  const clickBoth = async () => {\n    setActiveSource(BOTH);\n    await startUserCapture(dispatch, USER_CONSTRAINTS);\n    await startDisplayCapture(dispatch);\n  };\n\n  const reselectSource = () => {\n    setActiveSource(NONE);\n    stopUserCapture(state.userStream, dispatch);\n    stopDisplayCapture(state.displayStream, dispatch);\n  };\n\n  const nextDisabled = activeSource === NONE\n    || activeSource === BOTH ? (!displayStream || !userStream) : !hasStreams;\n\n  // The warnings if we are not allowed to capture a stream.\n  const userWarning = (state.userAllowed === false) && (\n    <Notification isDanger>\n      <Heading as=\"h3\" mb={2}>\n        {t('source-user-not-allowed-title')}\n      </Heading>\n      <Text>{t('source-user-not-allowed-text')}</Text>\n    </Notification>\n  );\n  const displayWarning = (state.displayAllowed === false) && (\n    <Notification isDanger>\n      <Heading as=\"h3\" mb={2}>\n        {t('source-display-not-allowed-title')}\n      </Heading>\n      <Text>{t('source-display-not-allowed-text')}</Text>\n    </Notification>\n  );\n\n  // The body depends on which source is currently selected.\n  let hideActionButtons;\n  let title;\n  let body;\n  switch (activeSource) {\n    case NONE:\n      title = t('sources-video-question');\n      hideActionButtons = true;\n      if (anySupported) {\n        body = <React.Fragment>\n          <Spacer />\n          <Flex\n            sx={{\n              flexDirection: ['column', 'row'],\n              maxWidth: [270, 850],\n              width: '100%',\n              mx: ['auto', 'none'],\n              mb: 3,\n              flex: '4 1 auto',\n              maxHeight: ['none', '270px'],\n              justifyContent: 'center',\n              '& > :not(:last-of-type)': {\n                mb: [3, 0],\n                mr: [0, 3],\n              },\n            }}\n          >\n            { displaySupported && <OptionButton\n              label={t('sources-scenario-display')}\n              icon={faChalkboard}\n              onClick={clickDisplay}\n            />}\n            { bothSupported && <OptionButton\n              label={t('sources-scenario-display-and-user')}\n              icon={faChalkboardTeacher}\n              onClick={clickBoth}\n            />}\n            { userSupported && <OptionButton\n              label={t('sources-scenario-user')}\n              icon={faUser}\n              onClick={clickUser}\n            />}\n          </Flex>\n          <Spacer />\n        </React.Fragment>;\n      } else {\n        body = <Notification isDanger>{t('sources-video-none-available')}</Notification>;\n      }\n      break;\n\n    case USER:\n      title = t('sources-video-user-selected');\n      hideActionButtons = !state.userStream && state.userAllowed !== false;\n      body = <SourcePreview\n        reselectSource={reselectSource}\n        warnings={userWarning}\n        inputs={[\n          { kind: t('sources-user'), stream: state.userStream, allowed: state.userAllowed }\n        ]}\n      />;\n      break;\n\n    case DISPLAY:\n      title = t('sources-video-display-selected');\n      hideActionButtons = !state.displayStream && state.displayAllowed !== false;\n      body = <SourcePreview\n        reselectSource={reselectSource}\n        warnings={displayWarning}\n        inputs={[{\n          kind: t('sources-display'),\n          stream: state.displayStream,\n          allowed: state.displayAllowed,\n        }]}\n      />;\n      break;\n\n    case BOTH:\n      title = t('sources-video-display-and-user-selected');\n      hideActionButtons = (!state.userStream && state.userAllowed !== false)\n        || (!state.displayStream && state.displayAllowed !== false);\n      body = <SourcePreview\n        reselectSource={reselectSource}\n        warnings={[displayWarning, userWarning]}\n        inputs={[\n          {\n            kind: t('sources-display'),\n            stream: state.displayStream,\n            allowed: state.displayAllowed,\n          },\n          { kind: t('sources-user'), stream: state.userStream, allowed: state.userAllowed },\n        ]}\n      />;\n      break;\n    default:\n      return <p>Something went very wrong</p>;\n  };\n\n\n  return (\n    <Container\n      sx={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: '1 1 auto',\n        minHeight: 0,\n      }}\n    >\n      <Styled.h1 sx={{ textAlign: 'center', fontSize: ['26px', '30px', '32px'] }}>\n        {title}\n      </Styled.h1>\n\n      { body }\n\n      {activeSource !== NONE && <div sx={{ mb: 3 }}></div>}\n\n      {activeSource !== NONE && <ActionButtons\n        next={hideActionButtons ? null : { onClick: () => props.nextStep(), disabled: nextDisabled }}\n        prev={hideActionButtons ? null : {\n          onClick: reselectSource,\n          disabled: false,\n          label: 'sources-video-reselect-source',\n        }}\n      />}\n    </Container>\n  );\n}\n\nconst OptionButton = ({ icon, label, onClick }) => {\n  return (\n    <button\n      onClick={onClick}\n      sx={{\n        fontFamily: 'inherit',\n        color: 'gray.0',\n        border: '2px solid black',\n        borderRadius: '8px',\n        flex: ['1 1 auto', '0 1 100%'],\n        minWidth: '180px',\n        maxWidth: '300px',\n        minHeight: '120px',\n        maxHeight: '250px',\n        p: 2,\n      }}\n    >\n      <div sx={{ display: 'block', textAlign: 'center', mb: 3 }}>\n        <FontAwesomeIcon icon={icon} size=\"3x\"/>\n      </div>\n      <div sx={{ fontSize: 4 }}>{label}</div>\n    </button>\n  );\n};\n\nconst Spacer = (rest) => <div sx={{ flex: '1 0 0' }} {...rest}></div>;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPause } from '@fortawesome/free-solid-svg-icons';\nimport { useEffect, useRef } from 'react';\n\nimport { STATE_PAUSED } from './index.js';\nimport { useStudioState } from '../../../studio-state';\nimport { VideoBox, useVideoBoxResize } from '../elements.js';\nimport { dimensionsOf } from '../../../util.js';\n\nexport default function MediaDevices({ recordingState }) {\n  const { t } = useTranslation();\n  const { displayStream, userStream } = useStudioState();\n\n  const paused = recordingState === STATE_PAUSED;\n\n  let children = [];\n  if (displayStream) {\n    children.push({\n      body: <MediaDevice title={t('share-desktop')} stream={displayStream} paused={paused} />,\n      dimensions: () => dimensionsOf(displayStream),\n    });\n  }\n  if (userStream) {\n    children.push({\n      body: <MediaDevice title={t('share-camera')} stream={userStream} paused={paused} />,\n      dimensions: () => dimensionsOf(userStream),\n    });\n  }\n\n  return <VideoBox gap={20}>{ children }</VideoBox>;\n}\n\nfunction MediaDevice({ title, stream, paused }) {\n  const resizeVideoBox = useVideoBoxResize();\n  const videoRef = useRef();\n\n  useEffect(() => {\n    const v = videoRef.current;\n    if (v && typeof stream != 'undefined') {\n      if (!v.srcObject) {\n        v.srcObject = stream;\n      }\n      v.addEventListener('resize', resizeVideoBox);\n\n      if (paused) {\n        v.pause();\n      } else {\n        v.play();\n      }\n    }\n\n    return () => v.removeEventListener('resize', resizeVideoBox);\n  });\n\n  return (\n    <div\n      sx={{\n        position: 'relative',\n        backgroundColor: 'gray.3',\n        boxShadow: '0 2px 2px rgba(0, 0, 0, 0.35)',\n        overflow: 'hidden',\n        height: '100%',\n        cursor: stream ? 'initial' : 'pointer',\n      }}\n    >\n      {paused && (\n        <div\n          sx={{\n            position: 'absolute',\n            width: '100%',\n            height: '100%',\n            backgroundColor: 'rgba(255, 255, 255, 0.5)',\n          }}\n        >\n          <FontAwesomeIcon\n            icon={faPause}\n            sx={{\n              fontSize: '140px',\n              maxWidth: '40%',\n              maxHeight: '40%',\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              bottom: 0,\n              right: 0,\n              margin: 'auto',\n              animation: '3s ease-in-out infinite none pulse',\n            }}\n          />\n        </div>\n      )}\n\n      <video\n        ref={videoRef}\n        autoPlay\n        muted\n        sx={{\n          outline: 'none',\n          width: '100%',\n          height: '100%',\n          background: 'transparent'\n        }}\n      ></video>\n    </div>\n  );\n}\n","import { dimensionsOf } from './util.js';\n\nexport default class Recorder {\n  constructor(stream, settings, options = {}) {\n    // Figure out MIME type.\n    let mimeType = undefined;\n    if ('isTypeSupported' in MediaRecorder) {\n      const configuredMime = (settings?.mimes || [])\n        .find(mime => MediaRecorder.isTypeSupported(mime));\n      if (configuredMime) {\n        mimeType = configuredMime;\n        console.debug(\"using first supported MIME type from settings: \", configuredMime);\n      } else if (settings?.mimes) {\n        console.debug(\"None of the MIME types specified in settings are supported by \"\n          + \"this `MediaRecorder`\");\n      }\n    } else if (settings?.mimes) {\n      console.debug(\"MIME types were specified, but `MediaRecorder.isTypeSupported` is not \"\n        + \"supported by your browser\");\n    }\n\n\n    const dimensions = dimensionsOf(stream);\n    const videoBitsPerSecond = settings?.videoBitrate || undefined;\n\n    const _recData = [];\n    this.recorder = new MediaRecorder(stream, { mimeType, videoBitsPerSecond });\n    this.recorder.ondataavailable = function(e) {\n      if (e.data.size > 0) {\n        _recData.push(e.data);\n      }\n    };\n\n    this.recorder.onerror = error => {\n      options.onError && options.onError(error);\n    };\n\n    this.recorder.onstop = () => {\n      const mimeType = _recData[0].type || this.recorder.mimeType;\n      const media = new Blob(_recData, { type: mimeType });\n      const url = URL.createObjectURL(media);\n      this.recorder = null;\n      options.onStop && options.onStop({ url, media, mimeType, dimensions });\n    };\n\n    this.isRecording = false;\n    this.isPaused = false;\n  }\n\n  start() {\n    if (!this.isRecording) {\n      this.recorder.start();\n      this.isRecording = true;\n    }\n  }\n\n  pause() {\n    if (!this.isPaused) {\n      this.recorder.pause();\n      this.isPaused = true;\n    }\n  }\n\n  resume() {\n    if (this.isPaused) {\n      this.recorder.resume();\n      this.isPaused = false;\n    }\n  }\n\n  stop() {\n    this.recorder.stop();\n    this.isRecording = false;\n  }\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCircle,\n  faCircleNotch,\n  faPauseCircle,\n  faPlayCircle,\n  faStopCircle\n} from '@fortawesome/free-solid-svg-icons';\n\nconst Button = ({ large, ...rest }) => (\n  <button\n    sx={{\n      backgroundColor: 'transparent',\n      border: 'none',\n      position: 'relative',\n      overflow: 'hidden',\n      my: 0,\n      mx: large ? '15px' : 0,\n      padding: 0,\n      fontSize: large ? '5rem' : '3.5rem',\n      lineHeight: large ? '5rem' : '3.5rem',\n      svg: {\n        margin: 0,\n        padding: 0,\n        outline: 'none'\n      }\n    }}\n    {...rest}\n  />\n);\n\nexport const PauseButton = props => (\n  <Button onClick={props.onClick} title={props.title}>\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={faPauseCircle} />\n    </span>\n  </Button>\n);\n\nexport const RecordButton = props => (\n  <Button\n    onClick={props.onClick}\n    title={props.title}\n    large={props.large ? 1 : 0}\n    disabled={props.disabled || props.countdown}\n    sx={{\n      color: '#bd181c',\n      'svg + svg': { color: '#e22319' },\n      ':disabled': { color: '#aaa' },\n      ':disabled svg + svg': { color: '#bbb' }\n    }}\n  >\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={props.countdown ? faCircleNotch : faCircle} spin={props.countdown} />\n      <FontAwesomeIcon icon={faCircle} transform=\"shrink-6\" />\n    </span>\n  </Button>\n);\n\nexport const ResumeButton = props => (\n  <Button onClick={props.onClick} title={props.title}>\n    <span className=\"fa-layers\">\n      <FontAwesomeIcon icon={faPlayCircle} />\n    </span>\n  </Button>\n);\n\nexport const StopButton = props => (\n  <Button\n    onClick={props.onClick}\n    title={props.title}\n    large={!!props.large}\n    sx={{ color: '#bd181c' }}\n  >\n    <FontAwesomeIcon icon={faStopCircle} />\n  </Button>\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { Component } from 'react';\n\nclass Clock extends Component {\n  #last = null;\n  #timerID = null;\n  #isMounted = false;\n\n  constructor(props) {\n    super(props);\n    this.state = { milliseconds: 0 };\n    this.#last = new Date();\n    this.#timerID = setInterval(() => this.tick(), 100);\n  }\n\n  componentDidMount() {\n    this.#isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this.stopTimer();\n    this.#isMounted = false;\n  }\n\n  resumeTimer() {\n    if (!this.timerId) {\n      this.#timerID = setInterval(() => this.tick(), 100);\n      this.#last = new Date();\n    }\n  }\n\n  stopTimer() {\n    clearInterval(this.#timerID);\n    this.#timerID = null;\n  }\n\n  componentDidUpdate(prevProps) {\n    // recording state did not change\n    if (this.props.isPaused === prevProps.isPaused) {\n      return;\n    }\n\n    if (this.props.isPaused) {\n      this.stopTimer();\n    } else {\n      this.resumeTimer();\n    }\n  }\n\n  tick() {\n    if (this.#isMounted) {\n      const now = new Date();\n      const passed = now - this.#last;\n      this.#last = now;\n      this.setState(state => ({\n        milliseconds: state.milliseconds + passed,\n      }));\n    }\n  }\n\n  render() {\n    const duration = this.state.milliseconds;\n    let timeArr = [\n      (duration / 3600000) >> 0,\n      ((duration / 60000) >> 0) % 60,\n      ((duration / 1000) >> 0) % 60\n    ];\n    if (timeArr[0] === 0) {\n      timeArr = timeArr.slice(1);\n    }\n    const content = timeArr.map(unit => (unit < 10 ? '0' : '') + unit).join(':');\n\n    return <span sx={{ fontSize: 3 }}>{content}</span>;\n  }\n}\n\nexport default Clock;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useEffect, useRef } from 'react';\nimport { Beforeunload } from 'react-beforeunload';\nimport { useTranslation } from 'react-i18next';\n\nimport Recorder from '../../../recorder';\nimport { useSettings } from '../../../settings';\nimport { useDispatch, useStudioState } from '../../../studio-state';\n\nimport { PauseButton, RecordButton, ResumeButton, StopButton } from './recording-buttons';\nimport Clock from './clock';\nimport { STATE_INACTIVE, STATE_PAUSED, STATE_RECORDING } from './index.js';\n\nfunction addRecordOnStop(dispatch, deviceType) {\n  return ({ media, url, mimeType, dimensions }) => {\n    dispatch({ type: 'ADD_RECORDING', payload: { deviceType, media, url, mimeType, dimensions } });\n  };\n}\n\nfunction mixAudioIntoVideo(audioStream, videoStream) {\n  if (!audioStream || audioStream.getAudioTracks().length === 0) {\n    return videoStream;\n  }\n  return new MediaStream([...videoStream.getVideoTracks(), ...audioStream.getAudioTracks()]);\n}\n\nexport default function RecordingControls({\n  handleRecorded,\n  recordingState,\n  setRecordingState,\n}) {\n  const { t } = useTranslation();\n  const dispatch = useDispatch();\n  const settings = useSettings();\n\n  const { audioStream, displayStream, userStream } = useStudioState();\n\n  const desktopRecorder = useRef(null);\n  const videoRecorder = useRef(null);\n\n  const hasStreams = displayStream || userStream;\n\n  // reset after mounting\n  useEffect(() => {\n    desktopRecorder.current = null;\n    videoRecorder.current = null;\n  }, [dispatch]);\n\n  const record = () => {\n    if (displayStream) {\n      const onStop = addRecordOnStop(dispatch, 'desktop');\n      const stream = mixAudioIntoVideo(audioStream, displayStream);\n      desktopRecorder.current = new Recorder(stream, settings.recording, { onStop });\n      desktopRecorder.current.start();\n    }\n\n    if (userStream) {\n      const onStop = addRecordOnStop(dispatch, 'video');\n      const stream = mixAudioIntoVideo(audioStream, userStream);\n      videoRecorder.current = new Recorder(stream, settings.recording, { onStop });\n      videoRecorder.current.start();\n    }\n  };\n\n  const resume = () => {\n    desktopRecorder.current && desktopRecorder.current.resume();\n    videoRecorder.current && videoRecorder.current.resume();\n  };\n\n  const pause = () => {\n    desktopRecorder.current && desktopRecorder.current.pause();\n    videoRecorder.current && videoRecorder.current.pause();\n  };\n\n  const stop = () => {\n    desktopRecorder.current && desktopRecorder.current.stop();\n    videoRecorder.current && videoRecorder.current.stop();\n    handleRecorded();\n  };\n\n  const handlePause = () => {\n    setRecordingState(STATE_PAUSED);\n    pause();\n  };\n\n  const handleResume = () => {\n    setRecordingState(STATE_RECORDING);\n    resume();\n  };\n\n  const handleRecord = () => {\n    if (!hasStreams) {\n      return;\n    }\n    setRecordingState(STATE_RECORDING);\n    record();\n  };\n\n  const handleStop = () => {\n    setRecordingState(STATE_INACTIVE);\n    stop();\n  };\n\n  return (\n    <div sx={{ m: 0, width: recordingState !== STATE_INACTIVE ? '280px' : 'auto' }}>\n      {recordingState !== STATE_INACTIVE && (\n        <Beforeunload onBeforeunload={event => event.preventDefault()} />\n      )}\n\n      <div className=\"buttons\" sx={{ display: 'flex', alignItems: 'center' }}>\n        {recordingState !== STATE_INACTIVE && <div sx={{ flex: 1, textAlign: 'right' }}>\n          {recordingState === STATE_RECORDING && (\n            <PauseButton\n              title={t('pause-button-title')}\n              recordingState={recordingState}\n              onClick={handlePause}\n            />\n          )}\n\n          {recordingState === STATE_PAUSED && (\n            <ResumeButton\n              title={t('resume-button-title')}\n              recordingState={recordingState}\n              onClick={handleResume}\n            />\n          )}\n        </div>}\n\n        <div className=\"center\">\n          {recordingState === STATE_INACTIVE ? (\n            <RecordButton\n              large\n              title={t('record-button-title')}\n              recordingState={recordingState}\n              onClick={handleRecord}\n              disabled={!hasStreams}\n            />\n          ) : (\n            <StopButton\n              large\n              title={t('stop-button-title')}\n              recordingState={recordingState}\n              onClick={handleStop}\n            />\n          )}\n        </div>\n\n        {recordingState !== STATE_INACTIVE && <div sx={{ flex: 1 }}>\n          <Clock isPaused={recordingState === STATE_PAUSED} />\n        </div>}\n      </div>\n    </div>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Flex } from '@theme-ui/components';\nimport { useCallback, useEffect, useState } from 'react';\n\nimport { useStudioState, useDispatch } from '../../../studio-state';\nimport { useOpencast } from '../../../opencast';\n\nimport { ActionButtons } from '../elements';\n\nimport MediaDevices from './media-devices';\nimport RecordingControls from './recording-controls';\nimport { stopCapture } from '../capturer';\n\n\nexport const STATE_INACTIVE = 'inactive';\nexport const STATE_PAUSED = 'paused';\nexport const STATE_RECORDING = 'recording';\n\n\nexport default function Recording(props) {\n  const state = useStudioState();\n  const recordingDispatch = useDispatch();\n  const opencast = useOpencast();\n\n  const [recordingState, setRecordingState] = useState(STATE_INACTIVE);\n  useEffect(() => {\n    if (!(state.displayStream || state.userStream)) {\n      props.firstStep();\n    }\n  }, [props, state.displayStream, state.userStream]);\n\n\n  const handleRecorded = () => {\n    opencast.refreshConnection();\n    stopCapture(state, recordingDispatch);\n    props.nextStep();\n  };\n\n  const backToAudio = useCallback(() => {\n    props.previousStep();\n  }, [props]);\n\n  return (\n    <Flex sx={{\n      flexDirection: 'column',\n      height: '100%',\n      position: 'relative',\n      flexGrow: 1,\n    }}>\n      <MediaDevices recordingState={recordingState} />\n\n      <div sx={{ m: 3 }}>\n        <ActionButtons prev={recordingState === STATE_INACTIVE && { onClick: backToAudio }}>\n          <RecordingControls\n            handleRecorded={handleRecorded}\n            recordingState={recordingState}\n            setRecordingState={setRecordingState}\n          />\n        </ActionButtons>\n      </div>\n    </Flex>\n  );\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport React, { useEffect } from 'react';\nimport { Flex, Spinner } from '@theme-ui/components';\nimport { useTranslation } from 'react-i18next';\n\nimport { ActionButtons, VideoBox } from '../elements';\nimport { useStudioState, useDispatch } from '../../../studio-state';\n\n\nexport default function Review(props) {\n  const { t } = useTranslation();\n  const recordingDispatch = useDispatch();\n\n  const handleBack = () => {\n    const doIt = window.confirm(t('confirm-discard-recordings'));\n    if (doIt) {\n      recordingDispatch({ type: 'RESET' });\n      props.firstStep();\n    }\n  };\n\n  const handleNext = () => {\n    props.nextStep();\n  };\n\n  return (\n    <Flex\n      sx={{\n        flexDirection: 'column',\n        height: '100%',\n        flexGrow: 1,\n        padding: 3,\n      }}\n    >\n      <Styled.h1 sx={{ textAlign: 'center', fontSize: ['26px', '30px', '32px'] }}>\n        {t('review-heading')}\n      </Styled.h1>\n\n      <Preview />\n\n      <div sx={{ mb: 3 }}></div>\n\n      <ActionButtons\n        prev={{\n          onClick: handleBack,\n          danger: true,\n          label: 'review-button-discard-and-record',\n        }}\n        next={{ onClick: handleNext }}\n      />\n    </Flex>\n  );\n};\n\nconst Preview = () => {\n  const { recordings } = useStudioState();\n  const { t } = useTranslation();\n\n  const videoRefs = [React.createRef(), React.createRef()];\n  const desktopIndex = recordings.length === 2\n    ? (recordings[0].deviceType === 'desktop' ? 0 : 1)\n    : null;\n\n  // Setup synchronization between both video elements\n  useEffect(() => {\n    if (recordings.length === 2 && videoRefs[0].current && videoRefs[1].current) {\n      // If we have two recordings, both will have audio. But the user doesn't\n      // want to hear audio twice, so we mute one video element. Particularly,\n      // we mute the desktop video, as there the audio/video synchronization is\n      // not as critical.\n      videoRefs[desktopIndex].current.volume = 0;\n\n      // The index of the last video ref that received an event (0 or 1).\n      let lastOrigin = null;\n\n      const va = videoRefs[0].current;\n      const vb = videoRefs[1].current;\n\n      // Helper function to add event listener to both video streams. Assumes that\n      // the refs are valid, i.e. `current` is pointing to the video element.\n      const installEventHandlers = (eventName, handler) => {\n        // Stores if the event was triggered by us (the code) as opposed to \"by\n        // the user\". This always flips as the user triggers the first event and\n        // we always react with one action that triggers one event.\n        let weTriggered = false;\n\n        // Add event listener for both video elements\n        va.addEventListener(eventName, event => {\n          if (!weTriggered) {\n            lastOrigin = 0;\n            handler(event, va, vb);\n          }\n\n          weTriggered = !weTriggered;\n        });\n        vb.addEventListener(eventName, event => {\n          if (!weTriggered) {\n            lastOrigin = 1;\n            handler(event, vb, va);\n          }\n\n          weTriggered = !weTriggered;\n        });\n      };\n\n      // Actuall install the handlers for different events\n      installEventHandlers('play', (event, origin, target) => {\n        target.currentTime = origin.currentTime;\n        target.play();\n      });\n      installEventHandlers('pause', (event, origin, target) => {\n        target.currentTime = origin.currentTime;\n        target.pause();\n      });\n      installEventHandlers('seeking', (event, origin, target) => {\n        target.currentTime = origin.currentTime;\n      });\n\n      // Install backup synchronization that runs regularly.\n      let frameCounter = 0;\n      const fixTime = () => {\n        // Only run every 60 frames.\n        if (frameCounter % 60 === 0) {\n          // We want the difference to be below 150ms. Usually, even without\n          // this backup solution, it should be below 50ms at all time. That's\n          // what testing showed.\n          const diff = Math.abs(va.currentTime - vb.currentTime);\n          if (diff > 0.15 && lastOrigin) {\n            const origin = videoRefs[lastOrigin].current;\n            const target = videoRefs[lastOrigin === 0 ? 1 : 0].current;\n            target.currentTime = origin.currentTime;\n          }\n        }\n\n        frameCounter++;\n        window.requestAnimationFrame(fixTime);\n      };\n      window.requestAnimationFrame(fixTime);\n    }\n  });\n\n  if (recordings.length === 0) {\n    return <Spinner title={t('save-creation-waiting-for-recordings')} />;\n  }\n\n  const children = recordings.map((recording, index) => ({\n    body: (\n      <video\n        ref={videoRefs[index]}\n        key={index}\n        controls\n        src={recording.url}\n        // Without this, some browsers show a black video element instead of the first frame.\n        onLoadedData={e => e.target.currentTime = 0}\n        preload=\"auto\"\n        sx={{\n          width: '100%',\n          height: '100%',\n          backgroundColor: '#ccc',\n          outline: 'none'\n        }}\n      ></video>\n    ),\n    dimensions: () => recording.dimensions,\n  }));\n\n  return <VideoBox gap={20}>{ children }</VideoBox>;\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport Steps from './steps';\n\nimport AudioSetup from './audio-setup';\nimport SaveCreation from './save-creation';\nimport VideoSetup from './video-setup';\nimport Recording from './recording';\nimport Review from './review';\n\nimport {isRecordingSupported} from '../../util';\n\n\nexport default function Wizard({ activeStep, updateActiveStep }) {\n  // If recording is not supported we don't even let the user start the wizard.\n  // A warning is shown already (in `warnings.js`).\n  if (!isRecordingSupported()) {\n    return null;\n  }\n\n  return (\n    <Steps activeStep={activeStep} updateActiveStep={updateActiveStep}>\n      <VideoSetup />\n      <AudioSetup />\n      <Recording />\n      <Review />\n      <SaveCreation />\n    </Steps>\n  );\n}\n","const languages = [\n  { short: 'en', long: 'English', rtl: false },\n  { short: 'de', long: 'Deutsch', rtl: false },\n  { short: 'nl', long: 'Dutch', rtl: false },\n  { short: 'el', long: 'Ελληνικά', rtl: false },\n  { short: 'es', long: 'Español', rtl: false },\n  { short: 'fa', long: 'Farsi', rtl: true },\n  { short: 'fr', long: 'Français', rtl: false },\n  { short: 'tr', long: 'Turkish', rtl: false },\n];\n\nexport default languages;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { Box } from '@theme-ui/components';\n\n// A styled `<input>`` element.\nexport const Input = ({\n  errors,\n  label,\n  name,\n  register,\n  required,\n  validate = undefined,\n  type = 'text',\n  ...rest\n}) => {\n  const { t } = useTranslation();\n\n  return (\n    <div\n      sx={{\n        '&:not(:last-child)': {\n          mb: 3\n        }\n      }}\n    >\n      <label\n        sx={{\n          color: 'text',\n          display: 'block',\n          fontSize: 2,\n          fontWeight: 'bold'\n        }}\n      >\n        {label}\n        <div\n          sx={{\n            display: 'block',\n            boxSizing: 'border-box',\n            clear: 'both',\n            fontSize: 2,\n            position: 'relative',\n            textAlign: 'left'\n          }}\n        >\n          <input\n            aria-invalid={errors[name] ? 'true' : 'false'}\n            aria-describedby={`${name}Error`}\n            autoComplete=\"off\"\n            name={name}\n            ref={register({\n              validate,\n              ...required ? { required: t('forms-validation-error-required') } : {},\n            })}\n            sx={{ variant: 'styles.input' }}\n            type={type}\n            {...rest}\n          />\n          {errors[name] && (\n            <p\n              id={`${name}Error`}\n              sx={{\n                color: 'error',\n                fontSize: 1,\n                fontWeight: 'body',\n                mt: 1\n              }}\n            >\n              {errors[name].message}\n            </p>\n          )}\n        </div>\n      </label>\n    </div>\n  );\n};\n\nexport const SettingsSection = ({ title, children }) => (\n  <Box\n    sx={{\n      '&:not(:last-child)': {\n        mb: 5\n      }\n    }}\n  >\n    <Styled.h2\n      sx={{\n        borderBottom: theme => `1px solid ${theme.colors.gray[2]}`,\n        pb: 1,\n        my: 3,\n        mx: 0\n      }}\n    >\n      {title}\n    </Styled.h2>\n    {children}\n  </Box>\n);\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\n\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\nimport languages from '../../languages';\nimport { SettingsSection } from './elements';\n\nconst LanguageSettings = () => {\n  const { i18n } = useTranslation();\n\n  return (\n    <SettingsSection title=\"Language\">\n      <select\n        sx={{ variant: 'styles.select' }}\n        defaultValue={i18n.language}\n        onChange={e => i18n.changeLanguage(e.target.value)}\n      >\n        {languages.map(language => (\n          <option value={language.short} key={language.short}>\n            {language.long}\n          </option>\n        ))}\n      </select>\n    </SettingsSection>\n  );\n};\n\nexport default LanguageSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheckCircle, faCircleNotch, faExclamationCircle } from \"@fortawesome/free-solid-svg-icons\";\nimport useForm from 'react-hook-form';\nimport { Link, useLocation } from 'react-router-dom';\nimport { Box, Button } from '@theme-ui/components';\n\nimport { useState } from 'react';\n\nimport {\n  Opencast,\n  useOpencast,\n  STATE_LOGGED_IN,\n  STATE_NETWORK_ERROR,\n  STATE_RESPONSE_NOT_OK,\n  STATE_INVALID_RESPONSE,\n  STATE_INCORRECT_LOGIN,\n  STATE_CONNECTED,\n  STATE_UNCONFIGURED,\n} from '../../opencast';\nimport Notification from '../notification';\nimport { Input, SettingsSection} from './elements';\nimport { useStudioState } from '../../studio-state';\n\n\n\nfunction OpencastSettings({ settingsManager }) {\n  const location = useLocation();\n  const { t } = useTranslation();\n  const opencast = useOpencast();\n  const [error, setError] = useState();\n  const { errors, handleSubmit, register } = useForm({\n    defaultValues: settingsManager.formValues().opencast\n  });\n  const [status, setStatus] = useState('initial');\n\n  const { recordings } = useStudioState();\n  const hasRecording = recordings.length > 0;\n\n  async function onSubmit(data) {\n    setStatus('testing');\n    const oc = await Opencast.init({\n      ...settingsManager.settings().opencast,\n      ...data,\n    });\n\n    switch (oc.getState()) {\n      case STATE_LOGGED_IN:\n        opencast.setGlobalInstance(oc);\n        settingsManager.saveSettings({ opencast: data });\n        setStatus('saved');\n        setError(null);\n        break;\n\n      case STATE_NETWORK_ERROR:\n        setStatus('error');\n        setError(t('upload-settings-error-server-unreachable'));\n        break;\n      case STATE_RESPONSE_NOT_OK:\n        setStatus('error');\n        setError(t('upload-settings-error-response-not-ok'));\n        break;\n      case STATE_INVALID_RESPONSE:\n        setStatus('error');\n        setError(t('upload-settings-error-invalid-response'));\n        break;\n      case STATE_INCORRECT_LOGIN:\n        setStatus('error');\n        if (opencast.isLoginProvided()) {\n          setError(t('upload-settings-invalid-provided-login'));\n        } else {\n          setError(t('upload-settings-invalid-login-data'));\n        }\n        break;\n\n      case STATE_CONNECTED:    // <- login data is provided in some way -> state impossible\n      case STATE_UNCONFIGURED: // <- server URL is required -> state impossible\n      default:\n        console.error(\"bug: invalid state reached...\");\n        setStatus('error');\n        setError('internal error :(');\n    }\n  }\n\n  const showServerUrl = settingsManager.isConfigurable('opencast.serverUrl');\n  const showUsername = settingsManager.isUsernameConfigurable();\n  const showPassword = settingsManager.isPasswordConfigurable();\n\n  // If all settings are already specified by the context, we do not show\n  // anything at all.\n  if (!showServerUrl && !showUsername && !showPassword) {\n    return null;\n  }\n\n  const icons = {\n    testing: faCircleNotch,\n    error: faExclamationCircle,\n    saved: faCheckCircle,\n  };\n  const icon = icons[status];\n\n  return (\n    <SettingsSection title={t('upload-settings-modal-header')}>\n      <Box>\n        {error && <Notification isDanger>{error}</Notification>}\n\n        <form onSubmit={handleSubmit(onSubmit)}>\n          { showServerUrl && <Input\n            errors={errors}\n            label={t('upload-settings-label-server-url')}\n            name=\"serverUrl\"\n            register={register}\n            validate={value => {\n              try {\n                const url = new URL(value);\n                return (url.protocol === 'https:' || url.protocol === 'http:')\n                  || t('upload-settings-invalid-url-http-start');\n              } catch (e) {\n                let err = t('upload-settings-invalid-url');\n                if (!value.startsWith('https://') && !value.startsWith('http://')) {\n                  err += \" \" + t('upload-settings-invalid-url-http-start');\n                }\n                return err;\n              }\n            }}\n            required\n          /> }\n\n          { showUsername && <Input\n            errors={errors}\n            label={t('upload-settings-label-username')}\n            name=\"loginName\"\n            register={register}\n            required\n          /> }\n\n          { showPassword && <Input\n            errors={errors}\n            label={t('upload-settings-label-password')}\n            name=\"loginPassword\"\n            register={register}\n            required\n            type=\"password\"\n          /> }\n\n          <footer sx={{ mt: 4 }}>\n            <Button sx={{ verticalAlign: 'middle' }}>\n              {t('upload-settings-button-store')}\n            </Button>\n            { icon && <FontAwesomeIcon\n              icon={icon}\n              sx={{ ml: '10px', fontSize: '30px', verticalAlign: 'middle' }}\n              spin={status === 'testing'}\n            /> }\n            { hasRecording && status === 'saved' && (\n              <Link\n                to={{ pathname: \"/\", search: location.search }}\n                sx={{ ml: 3, variant: 'styles.a' }}\n              >\n                {t('settings-back-to-recording')}\n              </Link>\n            )}\n          </footer>\n        </form>\n      </Box>\n    </SettingsSection>\n  );\n}\n\nexport default OpencastSettings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, Styled } from 'theme-ui';\n\nimport { useTranslation } from 'react-i18next';\nimport { Box } from '@theme-ui/components';\n\nimport LanguageSettings from './language';\nimport OpencastSettings from './opencast';\n\n\nconst SettingsPage = ({ settingsManager }) => {\n  const { t } = useTranslation();\n\n  return (\n    <Box sx={{ width: '100%', maxWidth: 960, mx: 'auto', p: 3 }}>\n      <header>\n        <Styled.h1>{t('settings-header')}</Styled.h1>\n      </header>\n\n      <LanguageSettings />\n\n      <OpencastSettings settingsManager={settingsManager} />\n    </Box>\n  );\n};\n\nexport default SettingsPage;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport { useTranslation } from 'react-i18next';\n\nimport Notification from './notification';\nimport {\n  onSafari,\n  isRecordingSupported,\n} from \"../util\";\n\n// Conditionally shows a number of warnings to help the user identify problems.\nconst Warnings = () => {\n  const { t } = useTranslation();\n\n  let warnings = [];\n\n  // We allow HTTP connections to localhost, as most browsers also seem to allow\n  // video capture in those cases.\n  const usingUnsecureConnection = window.location.protocol !== 'https:' &&\n    window.location.hostname !== \"localhost\" &&\n    window.location.hostname !== \"127.0.0.1\";\n  if (usingUnsecureConnection) {\n    warnings.push(\n        <Notification key=\"unsecure-connection\" isDanger>{t('warning-https')}</Notification>\n    );\n  }\n\n  // Warning about missing `MediaRecorder` support\n  if (!isRecordingSupported()) {\n    warnings.push(\n      <Notification key=\"media-recorder\" isDanger>\n        {t('warning-recorder-not-supported')}\n        {onSafari() && ' ' + t('warning-recorder-safari-hint')}\n      </Notification>\n    );\n  }\n\n\n  return warnings.length > 0\n    ? <div sx={{ p: 3 }}>{ warnings }</div>\n    : null;\n};\n\nexport default Warnings;\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\n\nimport { Flex } from '@theme-ui/components';\nimport { useState } from 'react';\nimport { BrowserRouter as Router, Switch, Redirect, Route, useLocation } from 'react-router-dom';\nimport { Beforeunload } from 'react-beforeunload';\n\nimport { Provider, useStudioState } from './studio-state';\n\nimport About from './ui/about';\nimport OpencastHeader from './ui/opencast-header';\nimport Studio from './ui/studio/page';\nimport SettingsPage from './ui/settings/page';\nimport Warnings from './ui/warnings';\n\n\nfunction App({ settingsManager }) {\n  return (\n    <Router basename={process.env.PUBLIC_URL || '/'}>\n      <Flex sx={{ flexDirection: 'column', height: '100%' }}>\n        <OpencastHeader />\n\n        <main sx={{ flex: 1, display: 'flex', flexDirection: 'column', minHeight: '285px' }}>\n          <Warnings />\n          <Routes settingsManager={settingsManager} />\n        </main>\n      </Flex>\n    </Router>\n  );\n}\n\nconst Routes = ({ settingsManager }) => {\n  const [activeStep, updateActiveStep] = useState(0);\n  const location = useLocation();\n\n  return (\n    <Provider>\n      <PreventClose />\n      <Switch>\n        <Route path=\"/settings\" exact>\n          <SettingsPage settingsManager={settingsManager} />\n        </Route>\n\n        <Route path=\"/about\" exact>\n          <About />\n        </Route>\n\n        <Route path=\"/\" exact>\n          <Studio\n            activeStep={activeStep}\n            updateActiveStep={updateActiveStep}\n          />\n        </Route>\n\n        <Route path=\"/*\">\n          <Redirect to={{ pathname: \"/\", search: location.search }} />\n        </Route>\n      </Switch>\n    </Provider>\n  );\n};\n\nconst PreventClose = () => {\n  const { recordings } = useStudioState();\n  const handler = event => {\n    if (recordings?.length > 0) {\n      event.preventDefault();\n    }\n  };\n\n  return <Beforeunload onBeforeunload={handler} />;\n};\n\n\nexport default App;\n"],"sourceRoot":""}