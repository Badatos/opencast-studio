(this["webpackJsonpopencast-react-studio"]=this["webpackJsonpopencast-react-studio"]||[]).push([[4],{121:function(e,t,n){"use strict";n.r(t);var r=n(18),c=n(4),a=n(90),i=n(1),o=n.n(i),s=n(95),l=n(96),u=n(100),d=n(99),b=n(11),p=n(26),O=function(){return{audioAllowed:null,audioStream:null,audioUnexpectedEnd:!1,audioSupported:Object(p.e)(),displayAllowed:null,displayStream:null,displayUnexpectedEnd:!1,displaySupported:Object(p.c)(),userAllowed:null,userStream:null,userUnexpectedEnd:!1,userSupported:Object(p.e)(),videoChoice:"none",audioChoice:"none",isRecording:!1,prematureRecordingEnd:!1,recordings:[],title:"",presenter:"",upload:{error:null,state:"not_uploaded",secondsLeft:null,currentProgress:0}}},g=function(e,t){switch(t.type){case"CHOOSE_AUDIO":return Object(b.a)({},e,{audioChoice:t.payload});case"CHOOSE_VIDEO":return Object(b.a)({},e,{videoChoice:t.payload});case"SHARE_AUDIO":return Object(b.a)({},e,{audioStream:t.payload,audioAllowed:!0,audioUnexpectedEnd:!1});case"BLOCK_AUDIO":return Object(b.a)({},e,{audioStream:null,audioAllowed:!1,audioUnexpectedEnd:!1});case"UNSHARE_AUDIO":return Object(b.a)({},e,{audioStream:null,audioUnexpectedEnd:!1});case"AUDIO_UNEXPETED_END":return Object(b.a)({},e,{audioStream:null,audioUnexpectedEnd:!0});case"SHARE_DISPLAY":return Object(b.a)({},e,{displayStream:t.payload,displayAllowed:!0,displayUnexpectedEnd:!1});case"BLOCK_DISPLAY":return Object(b.a)({},e,{displayStream:null,displayAllowed:!1,displayUnexpectedEnd:!1});case"UNSHARE_DISPLAY":return Object(b.a)({},e,{displayStream:null,displayUnexpectedEnd:!1});case"DISPLAY_UNEXPETED_END":return Object(b.a)({},e,{displayStream:null,displayUnexpectedEnd:!0});case"SHARE_USER":return Object(b.a)({},e,{userStream:t.payload,userAllowed:!0,userUnexpectedEnd:!1});case"BLOCK_USER":return Object(b.a)({},e,{userStream:null,userAllowed:!1,userUnexpectedEnd:!1});case"UNSHARE_USER":return Object(b.a)({},e,{userStream:null,userUnexpectedEnd:!1});case"USER_UNEXPETED_END":return Object(b.a)({},e,{userStream:null,userUnexpectedEnd:!0});case"START_RECORDING":return Object(b.a)({},e,{isRecording:!0});case"STOP_RECORDING":return Object(b.a)({},e,{isRecording:!1});case"STOP_RECORDING_PREMATURELY":return Object(b.a)({},e,{isRecording:!1,prematureRecordingEnd:!0});case"CLEAR_RECORDINGS":return Object(b.a)({},e,{recordings:[],prematureRecordingEnd:!1});case"ADD_RECORDING":var n=[].concat(Object(d.a)(e.recordings.filter((function(e){return e.deviceType!==t.payload.deviceType}))),[t.payload]);return Object(b.a)({},e,{recordings:n});case"UPLOAD_ERROR":case"UPLOAD_FAILURE":return Object(b.a)({},e,{upload:Object(b.a)({},e.upload,{error:t.payload,state:"error"})});case"UPLOAD_REQUEST":return Object(b.a)({},e,{upload:Object(b.a)({},e.upload,{error:null,state:"uploading"})});case"UPLOAD_SUCCESS":return Object(b.a)({},e,{upload:Object(b.a)({},e.upload,{error:null,state:"uploaded"})});case"UPLOAD_PROGRESS_UPDATE":return Object(b.a)({},e,{upload:Object(b.a)({},e.upload,{secondsLeft:t.payload.secondsLeft,currentProgress:t.payload.currentProgress})});case"MARK_DOWNLOADED":var r=e.recordings.map((function(e,n){return n===t.payload?Object(b.a)({},e,{downloaded:!0}):e}));return Object(b.a)({},e,{recordings:r});case"UPDATE_TITLE":return Object(b.a)({},e,{title:t.payload});case"UPDATE_PRESENTER":return Object(b.a)({},e,{presenter:t.payload});case"RESET":return O();default:throw new Error}},f=Object(i.createContext)(null),h=Object(i.createContext)(null),j=function(e){var t=e.children,n=Object(i.useReducer)(g,O()),a=Object(r.a)(n,2),o=a[0],s=a[1];return Object(c.c)(h.Provider,{value:s},Object(c.c)(f.Provider,{value:o},t))},m=function(){return Object(i.useContext)(h)},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Object(i.useContext)(f);return null!==e?t[e]:t},x=n(44),y=n(91),w=n(92);function S(){return Object(c.c)("article",null,Object(c.c)(x.b.h2,null,"ELAN e.V."),Object(c.c)(x.b.p,null,"The e-learning academic network (ELAN e.V.) is a German non-profit organization supporting higher-education organizations in all matters related to e-learning. Our services include practical tips about how to use digital technologies in education, legal advice and development of free, open-source software to support education."),Object(c.c)(x.b.h3,null,"Contact"),Object(c.c)(x.b.p,null,"Dr. Norbert Kleinefeld, Gesch\xe4ftsf\xfchrer",Object(c.c)("br",null),"Karlstr. 23",Object(c.c)("br",null),"D-26123 Oldenburg"),Object(c.c)(x.b.p,null,Object(c.c)(y.a,{icon:w.m})," ",Object(c.c)(x.b.a,{href:"https://elan-ev.de"},"elan-ev.de"),Object(c.c)("br",null),Object(c.c)(y.a,{icon:w.j})," ",Object(c.c)(x.b.a,{href:"mailto:kontakt@elan-ev.de"},"kontakt@elan-ev.de"),Object(c.c)("br",null),Object(c.c)(y.a,{icon:w.s})," ",Object(c.c)(x.b.a,{href:"tel:+4944199866610"},"+49\u2009441 998\u2009666\u200910")),Object(c.c)(x.b.p,null,"Registergericht: Amtsgericht Oldenburg",Object(c.c)("br",null),"Registernummer: VR 200644",Object(c.c)("br",null),"USt.-ID-Nr.: DE 265901392"))}var E=function(e){return Object(c.c)(a.d,null,Object(c.c)("article",{sx:{maxWidth:"900px",margin:"0 auto"}},Object(c.c)("header",null,Object(c.c)(x.b.h1,null,"Opencast Studio")),Object(c.c)(x.b.p,null,"A web-based recording studio for ",Object(c.c)(x.b.a,{href:"https://opencast.org"},"Opencast"),"."),Object(c.c)(x.b.p,null,"Opencast Studio allows you to record your camera, your display and your microphone\u02bcs audio. You can then either download your recordings or upload them directly to an Opencast instance (usually the one of your university)."),Object(c.c)(x.b.p,null,"This application is free, open software developed"," ",Object(c.c)(x.b.a,{href:"https://github.com/elan-ev/opencast-studio"},"on GitHub"),"."),Object(c.c)(x.b.h2,null,"How it works"),Object(c.c)(x.b.p,null,"Opencast Studio uses the recording capabilities built into modern browsers to record audio and video streams. The recording happens in the user\u02bcs browser and no server is involved in the recording."),Object(c.c)(o.a.Fragment,null,Object(c.c)(x.b.h2,null,"Support"),Object(c.c)(x.b.p,null,"If you are experiencing any difficulties or found any bugs, please take a look at the"," ",Object(c.c)(x.b.a,{href:"https://github.com/elan-ev/opencast-studio/issues"},"issue tracker on GitHub"),". Before filing a new issue, please check if one about your topic already exists. We regularly check incoming issues and do our best to address bugs in a timely manner."),Object(c.c)(x.b.p,null,"If you are interested in additional development or want to support the development of Opencast Studio, please contact"," ",Object(c.c)(x.b.a,{href:"mailto:opencast-support@elan-ev.de"},"opencast-support@elan-ev.de"),".")),Object(c.c)(S,null),Object(c.c)(x.b.h2,null,"Version"),Object(c.c)(x.b.p,null,"Build date ","2020-04-27",", commit"," ",Object(c.c)(x.b.a,{"aria-label":"Git commit on GitHub",href:"https://github.com/elan-ev/opencast-studio/commit/4a2abb1"},"4a2abb1"),".")))},k=n(93),C=n(46);function D(){var e=v().isRecording;return Object(c.c)("header",{sx:{height:function(e){return e.heights.headerHeight},lineHeight:function(e){return e.heights.headerHeight},color:"background",display:"flex",justifyContent:"space-between",position:"relative",zIndex:3}},Object(c.c)("div",{sx:{backgroundColor:"gray.0",position:"absolute",zIndex:-3,height:"100%",width:"100%"}}),e&&Object(c.c)("div",{sx:{backgroundColor:"gray.0",position:"absolute",zIndex:20,height:"100%",width:"100%",opacity:.75}}),Object(c.c)(A,null),Object(c.c)(U,null))}var A=function(){var e=Object(l.h)();return Object(c.c)(s.b,{to:{pathname:"/",search:e.search}},Object(c.c)("picture",null,Object(c.c)("source",{media:"(min-width: 920px)",srcSet:"".concat("","/opencast-studio.svg")}),Object(c.c)("img",{src:"".concat("","/opencast-studio-small.svg"),alt:"Opencast Studio",sx:{height:50}})))},R=function(e){var t=e.target,n=e.children,r=e.icon,a=Object(k.a)(e,["target","children","icon"]),i=Object(l.h)();return Object(c.c)(s.c,Object.assign({to:{pathname:t,search:i.search},exact:!0,activeStyle:{backgroundColor:"black"},sx:{color:"white",pl:[3,"10px"],pr:[3,"14px"],textDecoration:"none",fontSize:"18px",height:["auto","100%"],borderLeft:["none",function(e){return"1px solid ".concat(e.colors.gray[3])}],display:["block","inline-block"],width:["100%","auto"],"&:hover":{backgroundColor:"gray.1"}}},a),Object(c.c)("div",{sx:{width:"20px",display:"inline-block",textAlign:"right",mr:[3,3,2]}},Object(c.c)(y.a,{icon:r})),n)},U=function(e){var t=Object(i.useState)(!1),n=Object(r.a)(t,2),a=n[0],o=n[1],s=function(){return o(!1)},l=Object(C.c)().t;return Object(c.c)(i.Fragment,null,Object(c.c)("button",{onClick:function(){return o(!a)},title:l("nav-open-menu-button"),sx:{display:["inline-block","none"],border:function(e){return"2px solid ".concat(e.colors.gray[3])},borderRadius:"10px",color:"white",my:1,px:3,mx:1,fontSize:"20px",whiteSpace:"nowrap",backgroundColor:"transparent","&:hover":{backgroundColor:"gray.1"},"&:active":{}}},l("nav-open-menu-button"),Object(c.c)("span",{sx:{width:"23px",display:"inline-block"}},Object(c.c)(y.a,{icon:a?w.w:w.a,sx:{ml:"10px"}}))),Object(c.c)("nav",{ref:function(e){e&&(e.style.height=a?e.scrollHeight+"px":"")},sx:{overflow:"hidden",zIndex:10,height:["0px","100% !important"],top:[function(e){return e.heights.headerHeight},function(e){return e.heights.headerHeight},0],position:["absolute","static"],width:["100%","auto"],backgroundColor:["gray.0","none"],transition:["height 0.25s ease-out 0s","none"],scrollX:["none","auto"]}},Object(c.c)(R,{title:l("nav-recording"),target:"/",icon:w.z,onClick:s},l("nav-recording")),Object(c.c)(R,{title:l("nav-settings"),target:"/settings",icon:w.A,onClick:s},l("nav-settings")),Object(c.c)(R,{title:l("nav-about"),target:"/about",icon:w.n,onClick:s},l("nav-about"))),a&&Object(c.c)("div",{onClick:s,ref:function(e){return e&&(e.style.opacity=1)},sx:{display:[a?"block":"none","none"],backgroundColor:"rgba(0, 0, 0, 0.7)",position:"fixed",zIndex:-10,top:0,bottom:0,left:0,right:0,opacity:0,transition:"opacity 0.25s ease-out 0s"}}))};function T(e){var t,n=e.activeStep,r=e.updateActiveStep,a=Object(k.a)(e,["activeStep","updateActiveStep"]),i={currentStep:n+1,totalSteps:(null===(t=a.children)||void 0===t?void 0:t.length)||0,nextStep:function(){u(n+1)},previousStep:function(){u(n-1)},goToStep:l,firstStep:function(){l(1)},lastStep:function(){l(a.children.length)}},s=o.a.Children.map(a.children,(function(e,t){return i.isActive=t===n,i.isActive?function(e){var t=e.type;return"function"===typeof t||"object"===typeof t}(e)?o.a.cloneElement(e,i):e:null}));return Object(c.c)(o.a.Fragment,null,s);function l(e){u(e-1)}function u(e){n!==e&&(!function(e,t){return e<0||e>=t.length}(e,a.children)?r(e):console.error("".concat(e+1," is an invalid step")))}}var P=n(3),_=n.n(P),I=n(5);function H(){return(H=Object(I.a)(_.a.mark((function e(t){var n,r,c=arguments;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:null,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!n||{deviceId:n},video:!1});case 4:return(r=e.sent).getTracks().forEach((function(e){e.onended=function(){t({type:"AUDIO_UNEXPETED_END"})}})),t({type:"SHARE_AUDIO",payload:r}),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(1),console.error("Error: "+e.t0),t({type:"BLOCK_AUDIO"}),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function L(e,t){return N.apply(this,arguments)}function N(){return(N=Object(I.a)(_.a.mark((function e(t,n){var r,c,a,i,o,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(null===(r=n.display)||void 0===r?void 0:r.maxFps)?{frameRate:{max:n.display.maxFps}}:{},i=(null===(c=n.display)||void 0===c?void 0:c.maxHeight)?{height:{max:n.display.maxHeight}}:{},o={video:Object(b.a)({cursor:"always"},a,{},i),audio:!1},e.prev=3,e.next=6,navigator.mediaDevices.getDisplayMedia(o);case 6:(s=e.sent).getTracks().forEach((function(e){e.onended=function(){t({type:"DISPLAY_UNEXPETED_END"})}})),t({type:"SHARE_DISPLAY",payload:s}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error("Error: "+e.t0),t({type:"BLOCK_DISPLAY"});case 15:case"end":return e.stop()}}),e,null,[[3,11]])})))).apply(this,arguments)}function z(e,t){return M.apply(this,arguments)}function M(){return(M=Object(I.a)(_.a.mark((function e(t,n){var r,c,a,i,o,s;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(null===(r=n.camera)||void 0===r?void 0:r.maxFps)?{frameRate:{max:n.camera.maxFps}}:{},i=(null===(c=n.camera)||void 0===c?void 0:c.maxHeight)?{height:{ideal:Math.min(1080,n.camera.maxHeight),max:n.camera.maxHeight}}:{height:{ideal:1080}},o={video:Object(b.a)({facingMode:"user"},a,{},i),audio:!1},e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia(o);case 6:(s=e.sent).getTracks().forEach((function(e){e.onended=function(){t({type:"USER_UNEXPETED_END"})}})),t({type:"SHARE_USER",payload:s}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error("Error: "+e.t0),t({type:"BLOCK_USER"});case 15:case"end":return e.stop()}}),e,null,[[3,11]])})))).apply(this,arguments)}function W(e,t){e&&e.getTracks().forEach((function(e){return e.stop()})),t({type:"UNSHARE_AUDIO"})}function F(e,t){e&&e.getTracks().forEach((function(e){return e.stop()})),t({type:"UNSHARE_DISPLAY"})}function B(e,t){e&&e.getTracks().forEach((function(e){return e.stop()})),t({type:"UNSHARE_USER"})}var G=n(115),q=n.n(G),K=n(37),V=n.n(K);function Y(e){var t=e.prev,n=void 0===t?null:t,r=e.next,i=void 0===r?null:r,o=e.children,s=Object(C.c)().t;return Object(c.c)(a.e,{sx:{alignItems:"end",minHeight:"40px"}},Object(c.c)(a.a,{sx:{flex:"1 1 0",textAlign:"left"}},n&&Object(c.c)(a.b,{sx:Object(b.a)({whiteSpace:"nowrap"},!0===n.danger?{variant:"buttons.danger"}:{variant:"buttons.text"}),onClick:n.onClick,disabled:n.disabled,danger:n.danger||!1,title:s(n.label||"back-button-label")},Object(c.c)(y.a,{icon:w.b}),s(n.label||"back-button-label"))),Object(c.c)(a.a,null,o),Object(c.c)(a.a,{sx:{flex:"1 1 0",textAlign:"right"}},i&&Object(c.c)(a.b,{sx:Object(b.a)({whiteSpace:"nowrap","& svg":{mr:0,ml:2}},!0===i.danger?{variant:"buttons.danger"}:{}),onClick:i.onClick,disabled:i.disabled,title:s(i.label||"next-button-label")},s(i.label||"next-button-label"),Object(c.c)(y.a,{icon:w.c}))))}var X=o.a.createContext(null),J=function(){return o.a.useContext(X)};function Q(e){var t=e.gap,n=void 0===t?0:t,a=e.children,o=q()(),s=o.ref,l=o.width,u=void 0===l?1:l,d=o.height,b=void 0===d?1:d,p=Object(i.useState)(0),O=Object(r.a)(p,2)[1],g=a.map((function(e){return e.dimensions()})),f=function(){var e=a.map((function(e){return e.dimensions()}));V()(e,g)||(g=e,O((function(e){return e+1})))},h=function(e){var t=Object(r.a)(e,2),n=t[0],c=t[1];return n&&c?n/c:16/9};switch(a.length){case 1:var j,m,v=a[0],x=v.extraHeight||0,y=h(v.dimensions()),w=b-x;return u>w*y?(m=w+x,j=w*y):(j=u,m=u/y+x),Object(c.c)(X.Provider,{value:f},Object(c.c)("div",{ref:s,sx:{flex:"1 0 0",minHeight:0,display:"flex"}},Object(c.c)("div",{sx:{height:m,width:j,minWidth:"180px",margin:"auto"}},v.body)));case 2:var S,E,k,C=a.map((function(e){return h(e.dimensions())})),D=function(){var e=Math.max(a[0].extraHeight||0,a[1].extraHeight||0),t=b-e,r=u-n,c=C[0]+C[1];if(r>t*c)return{rowHeights:Array(2).fill(t+e),rowWidths:C.map((function(e){return t*e}))};var i=r/c;return{rowHeights:a.map((function(e){return i+(e.extraHeight||0)})),rowWidths:C.map((function(e){return i*e}))}}(),A=D.rowWidths,R=D.rowHeights,U=function(){var e=n+(a[0].extraHeight||0)+(a[1].extraHeight||0),t=b-e,r=1/(1/C[0]+1/C[1]);if(u>t*r){var c=t*r;return{colHeights:a.map((function(e,t){return c/C[t]+(e.extraHeight||0)})),colWidths:Array(2).fill(c)}}return{colHeights:a.map((function(e,t){return u/C[t]+(e.extraHeight||0)})),colWidths:Array(2).fill(u)}}(),T=U.colWidths,P=U.colHeights;return A[0]*R[0]+A[1]*R[1]>T[0]*P[0]+T[1]*P[1]?(k="row",S=A,E=R):(k="column",S=T,E=P),Object(c.c)(X.Provider,{value:f},Object(c.c)("div",{ref:s,sx:{flex:"1 0 0",display:"flex",flexDirection:k,justifyContent:"space-between",minHeight:0}},Object(c.c)("div",{sx:{height:E[0],width:S[0],minWidth:"180px",margin:"auto"}},a[0].body),Object(c.c)("div",{sx:{height:E[1],width:S[1],minWidth:"180px",margin:"auto"}},a[1].body)));default:return Object(c.c)("p",null,"Internal error: too few or too many video streams")}}var Z=function(e){var t=e.isDanger,n=Object(k.a)(e,["isDanger"]);return Object(c.c)("div",Object.assign({sx:{":not(:last-child)":{marginBottom:"1.5rem"},backgroundColor:t?"error":"gray.3",color:t?"background":"currentColor",borderRadius:2,padding:3,position:"relative"}},n))},$=n(117);function ee(e){var t=e.stream,n=(Object(k.a)(e,["stream"]),Object(i.useRef)()),r=Object(c.e)().theme;return Object(i.useEffect)((function(){var e=n.current;if(e){var r=e.getContext("2d");r.lineWidth=2,r.strokeStyle="#f1c40f";var c=(new(window.AudioContext||window.webkitAudioContext)).createMediaStreamSource(t),a=new $.a(c,{fftSize:1024});return a.animate(r),function(){return a.stop()}}return function(){}}),[r.colors,t]),Object(c.c)("canvas",{ref:n,sx:{width:"80%",height:"100px",bg:"rgba(0,0,0,0.8)",m:3,mb:0,borderRadius:"7px"}})}function te(e){var t=Object(C.c)().t,n=m(),r=v(),i=r.audioStream,o=r.audioAllowed,s=r.audioUnexpectedEnd,l="none"===r.audioChoice||"microphone_request"===r.audioChoice||"microphone"===r.audioChoice&&!i;return Object(c.c)(a.d,{sx:{display:"flex",flexDirection:"column",flex:"1 1 auto",justifyContent:"space-between"}},Object(c.c)(x.b.h1,{sx:{textAlign:"center"}},t("sources-audio-question")),Object(c.c)(a.e,{sx:{flexDirection:["column","row"],maxWidth:850,width:"100%",mx:"auto",mb:3,flex:"1 0 auto",maxHeight:["none","350px"],"& > :first-of-type":{mb:[3,0],mr:[0,3]}}},Object(c.c)(ne,{icon:w.o,label:t("sources-audio-microphone"),selected:"microphone"===r.audioChoice&&!s,onClick:function(){n({type:"CHOOSE_AUDIO",payload:"microphone_request"}),function(e){return H.apply(this,arguments)}(n).then((function(e){n({type:"CHOOSE_AUDIO",payload:e?"microphone":"none"})}))}},"microphone_request"===r.audioChoice&&Object(c.c)(a.h,{size:"75"}),i&&Object(c.c)(ee,{stream:i}),!1===o&&"microphone_request"!==r.audioChoice&&Object(c.c)(Z,{isDanger:!0,sx:{mt:2}},Object(c.c)(a.f,{as:"h3",mb:2},t("source-audio-not-allowed-title")),Object(c.c)(a.i,{variant:"text"},t("source-audio-not-allowed-text"))),s&&Object(c.c)(Z,{isDanger:!0,sx:{mt:2}},Object(c.c)(a.i,{variant:"text"},t("error-lost-audio-stream")))),Object(c.c)(ne,{icon:w.p,label:t("sources-audio-without-audio"),selected:"no-audio"===r.audioChoice,onClick:function(){n({type:"CHOOSE_AUDIO",payload:"no-audio"}),i&&W(i,n)}})),Object(c.c)(Y,{prev:{onClick:function(){return e.previousStep()}},next:{onClick:function(){return e.nextStep()},disabled:l}}))}var ne=function(e){var t=e.children,n=e.icon,r=e.label,a=e.selected,i=e.onClick,o=a?{backgroundColor:"highlight"}:{};return Object(c.c)("button",{onClick:function(){return a||i()},title:r,sx:Object(b.a)({fontFamily:"inherit",color:"gray.0",backgroundColor:"gray.4",border:"2px solid black",borderRadius:"8px",flex:"0 1 50%",p:2,"&:hover":a?{}:{boxShadow:function(e){return"0 0 10px ".concat(e.colors.gray[2])},backgroundColor:"white"}},o)},Object(c.c)("div",{sx:{display:"block",textAlign:"center",mb:3}},Object(c.c)(y.a,{icon:n,size:"3x"})),Object(c.c)("div",{sx:{fontSize:4}},r),t)},re=n(40),ce=n(39);var ae=function(e){return Object(c.c)("div",{sx:{"&:not(:last-child)":{marginBottom:3}}},Object(c.c)("label",{sx:{color:"gray.0",display:"block",fontSize:2,fontWeight:"bold"}},e.label,Object(c.c)("div",{sx:{boxSizing:"border-box",clear:"both",fontSize:2,position:"relative",textAlign:"left"}},e.children)))},ie=function(e){var t=e.onDownload,n=e.recording,r=e.title,i=e.presenter,o=Object(C.c)(),s=o.t,l=o.i18n,u=n.deviceType,d=n.mimeType,b=n.url,O=n.downloaded,g=n.media,f=s("desktop"===u?"sources-display":"sources-user"),h=Object(p.g)({mimeType:d,flavor:f,title:r,presenter:i});if(!b)return null;var j=g.size,m=function(e){var t=e<10?1:0;return e.toLocaleString(l.language,{minimumFractionDigits:t,maximumFractionDigits:t})},v=j<1e3?"".concat(j," B"):j<999500?"".concat(m(j/1e3)," KB"):j<9995e5?"".concat(m(j/1e6)," MB"):"".concat(m(j/1e9)," GB");return Object(c.c)("div",{sx:{display:"flex",flexDirection:"column",flex:"0 0 auto",mx:2,pb:"12px",alignItems:"center"}},Object(c.c)("div",{sx:{position:"relative",height:"150px",border:function(e){return"2px solid ".concat(e.colors.gray[1])}}},Object(c.c)("video",{muted:!0,src:b,onLoadedData:function(e){return e.target.currentTime=0},preload:"auto",sx:{maxWidth:"100%",height:"100%"}}),O&&Object(c.c)("div",{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",color:"primary",backgroundColor:"rgba(0, 0, 0, 0.4)"}},Object(c.c)(y.a,{icon:w.f,size:"4x"}))),Object(c.c)(a.b,{as:"a",title:s("save-creation-download-button"),sx:{width:"100%",maxWidth:"215px",margin:"auto",mt:"10px"},target:"_blank",download:h,href:b,rel:"noopener noreferrer",onClick:t},Object(c.c)(y.a,{icon:w.i}),s("save-creation-download-button")," ","(",v,")"))},oe=function(e){return Object(c.c)("input",Object.assign({sx:{variant:"styles.input"}},e))},se=[];function le(e){var t=Object(ce.c)(),n=Object(C.c)().t,r=Object(re.j)(),o=v(),s=o.recordings,l=o.upload,u=o.title,d=o.presenter,b=m();function p(e){var t=Date.now();se.push({timestamp:t,progress:e});var n=Math.min(se.findIndex((function(e){return t-e.timestamp<5e3})),Math.max(0,se.length-6));se.splice(0,n);var r=null;if(se.length>=4){var c=t-se[0].timestamp,a=(e-se[0].progress)/c*1e3,i=1-e;r=Math.max(0,Math.round(i/a))}l.secondsLeft===r&&l.currentProgress===e||b({type:"UPLOAD_PROGRESS_UPDATE",payload:{secondsLeft:r,currentProgress:e}})}function O(){return g.apply(this,arguments)}function g(){return(g=Object(I.a)(_.a.mark((function e(){var c;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==u&&""!==d){e.next=3;break}return b({type:"UPLOAD_ERROR",payload:n("save-creation-form-invalid")}),e.abrupt("return");case 3:return b({type:"UPLOAD_REQUEST"}),se.push({timestamp:Date.now(),progress:0}),e.next=7,r.upload({recordings:s.filter(Boolean),title:u,creator:d,uploadSettings:t.upload,onProgress:p});case 7:if(c=e.sent,se=[],!c){e.next=13;break}b({type:"UPLOAD_SUCCESS"}),e.next=20;break;case 13:e.t0=r.getState(),e.next=e.t0===re.d?16:18;break;case 16:return b({type:"UPLOAD_FAILURE",payload:n("message-login-failed")}),e.abrupt("break",20);case 18:return b({type:"UPLOAD_FAILURE",payload:n("message-server-unreachable")}),e.abrupt("break",20);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(i.useEffect)((function(){var e=setInterval((function(){if("uploading"===l.state){var e=se[se.length-1];Date.now()-((null===e||void 0===e?void 0:e.timestamp)||0)>3e3&&p(e.progress)}}),1e3);return function(){return clearInterval(e)}}));var f=s.every((function(e){return e.downloaded})),h="uploaded"===l.state||f,j=function(){if(!r.isReadyToUpload()&&"not_uploaded"===l.state)return Object(c.c)(de,null);switch(l.state){case"uploading":return Object(c.c)(pe,{currentProgress:l.currentProgress,secondsLeft:l.secondsLeft});case"uploaded":return Object(c.c)(Oe,null);default:return Object(c.c)(be,{uploadState:l,handleUpload:O})}}();return Object(c.c)(a.d,{sx:{display:"flex",flexDirection:"column",flex:"1 0 auto"}},Object(c.c)(x.b.h1,{sx:{textAlign:"center",fontSize:["26px","30px","32px"]}},n(h?"save-creation-title-done":"save-creation-title")),Object(c.c)("div",{sx:{display:"flex",flexDirection:["column","column","row"],"& > *":{flex:["0","0","1 0 50%"],p:[2,2,"0 32px"],"&:last-child":{borderLeft:["none","none",function(e){return"1px solid ".concat(e.colors.gray[3])}]}}}},Object(c.c)("div",null,Object(c.c)(x.b.h2,{sx:{pb:1,borderBottom:function(e){return"1px solid ".concat(e.colors.gray[2])}}},n("save-creation-subsection-title-upload")),Object(c.c)("div",{sx:{margin:"auto"}},j)),Object(c.c)("div",null,Object(c.c)(x.b.h2,{sx:{pb:1,borderBottom:function(e){return"1px solid ".concat(e.colors.gray[2])}}},n("save-creation-subsection-title-download")),Object(c.c)(ue,Object.assign({recordings:s,dispatch:b},{title:u,presenter:d})))),Object(c.c)("div",{sx:{flex:"1 0 40px"}}),Object(c.c)(Y,{next:null,prev:h?null:{onClick:function(){e.previousStep()},disabled:!1}},h?Object(c.c)(a.b,{sx:{whiteSpace:"nowrap"},title:n("save-creation-new-recording"),onClick:function(){window.confirm(n("save-creation-new-recording-warning"))&&(b({type:"RESET"}),e.firstStep())}},Object(c.c)(y.a,{icon:w.u}),n("save-creation-new-recording")):null))}var ue=function(e){var t=e.recordings,n=e.dispatch,r=e.presenter,i=e.title;return Object(c.c)("div",{sx:{display:"flex",flexDirection:"row",justifyContent:["center","center","start"],flexWrap:"wrap"}},0===t.length?Object(c.c)(a.h,null):t.map((function(e,t){return Object(c.c)(ie,{key:t,recording:e,presenter:r,title:i,onDownload:function(){return n({type:"MARK_DOWNLOADED",payload:t})}})})))},de=function(){var e=Object(l.h)();return Object(c.c)(Z,{key:"opencast-connection",isDanger:!0},Object(c.c)(C.a,{i18nKey:"warning-missing-connection-settings"},"Warning.",Object(c.c)(s.b,{to:{pathname:"/settings",search:e.search},sx:{variant:"styles.a",color:"#ff2"}},"settings")))},be=function(e){var t=e.uploadState,n=e.handleUpload,r=Object(C.c)().t,s=Object(re.j)(),l=m(),u=v(),d=u.recordings,b=u.title,p=u.presenter;function O(e){var t=e.target;l({type:{title:"UPDATE_TITLE",presenter:"UPDATE_PRESENTER"}[t.name],payload:t.value}),"presenter"===t.name&&window.localStorage.setItem("lastPresenter",t.value)}var g=p||window.localStorage.getItem("lastPresenter")||"";Object(i.useEffect)((function(){g!==p&&l({type:"UPDATE_PRESENTER",payload:g})}));var f=s.prettyServerUrl()?Object(c.c)(C.a,{i18nKey:"save-creation-upload-to"},"Upload to ",Object(c.c)("code",{sx:{backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:"1px 3px"}},{server:s.prettyServerUrl()})):r("save-creation-button-upload");return Object(c.c)(o.a.Fragment,null,Object(c.c)(ae,{label:r("save-creation-label-title")},Object(c.c)(oe,{name:"title",autoComplete:"off",defaultValue:b,onChange:O})),Object(c.c)(ae,{label:r("save-creation-label-presenter")},Object(c.c)(oe,{name:"presenter",autoComplete:"off",defaultValue:g,onChange:O})),Object(c.c)(a.b,{title:r("save-creation-button-upload"),onClick:n,disabled:0===d.length},Object(c.c)(y.a,{icon:w.x}),f),Object(c.c)(a.a,{sx:{mt:2}},"error"===t.state&&Object(c.c)(Z,{isDanger:!0},t.error)))},pe=function(e){var t,n=e.currentProgress,r=e.secondsLeft,i=Object(C.c)(),s=i.t,l=i.i18n,u=Math.min(100,100*n).toLocaleString(l.language,{minimumFractionDigits:1,maximumFractionDigits:1});return t=null===r?null:r<4?s("upload-time-a-few-seconds"):r<45?"".concat(r," ").concat(s("upload-time-seconds")):r<90?s("upload-time-a-minute"):r<2700?"".concat(Math.round(r/60)," ").concat(s("upload-time-minutes")):r<5400?s("upload-time-an-hour"):r<86400?"".concat(Math.round(r/3600)," ").concat(s("upload-time-hours")):null,Object(c.c)(o.a.Fragment,null,Object(c.c)("div",{sx:{display:"flex",mb:2}},Object(c.c)(a.i,{variant:"text"},u,"%"),Object(c.c)("div",{sx:{flex:1}}),Object(c.c)(a.i,{variant:"text"},t&&Object(c.c)(C.a,{i18nKey:"upload-time-left"},{time:t}," left"))),Object(c.c)(a.g,{max:1,value:n,variant:"styles.progress"},u),Object(c.c)(a.i,{variant:"text",sx:{textAlign:"center",mt:2}},s("upload-notification")))},Oe=function(){var e=Object(C.c)().t;return Object(c.c)(o.a.Fragment,null,Object(c.c)("div",{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"130px",color:"primary"}},Object(c.c)(y.a,{icon:w.f,size:"4x"})),Object(c.c)(a.i,{variant:"text",sx:{textAlign:"center"}},e("message-upload-complete")),Object(c.c)(a.i,{sx:{textAlign:"center",mt:2}},e("message-upload-complete-explanation")))};function ge(e){e.reselectSource;var t,n=e.warnings,r=e.inputs;switch(r.length){case 1:t=[{body:Object(c.c)(fe,{input:r[0],text:r[0].kind}),dimensions:function(){return Object(p.b)(r[0].stream)},extraHeight:40}];break;case 2:t=[{body:Object(c.c)(fe,{input:r[0],text:r[0].kind}),dimensions:function(){return Object(p.b)(r[0].stream)},extraHeight:40},{body:Object(c.c)(fe,{input:r[1],text:r[1].kind}),dimensions:function(){return Object(p.b)(r[1].stream)},extraHeight:40}];break;default:return Object(c.c)("p",null,"Something went very wrong")}return Object(c.c)(i.Fragment,null,n,Object(c.c)(Q,{gap:20},t))}function fe(e){var t,n,r=e.input,i=e.text,o=r.stream,s=null===o||void 0===o||null===(t=o.getVideoTracks())||void 0===t?void 0:t[0],l=null!==(n=null===s||void 0===s?void 0:s.getSettings())&&void 0!==n?n:{},u=l.width,d=l.height;return Object(c.c)(a.c,{sx:{display:"flex",flexDirection:"column",height:"100%",minHeight:0}},Object(c.c)(he,{allowed:r.allowed,unexpectedEnd:r.unexpectedEnd,stream:o}),Object(c.c)(a.i,{p:2,color:"muted",sx:{height:"".concat(40,"px")}},i,s&&": ".concat(u,"\xd7").concat(d)))}var he=function(e){var t,n=e.allowed,r=e.stream,o=e.unexpectedEnd,s=(Object(k.a)(e,["allowed","stream","unexpectedEnd"]),J()),l=Object(i.useRef)();return Object(i.useEffect)((function(){var e=l.current;return e&&(e.srcObject||(e.srcObject=r),e.addEventListener("resize",s)),function(){e&&e.removeEventListener("resize",s)}}),[r,s]),r?Object(c.c)("video",{ref:l,autoPlay:!0,muted:!0,sx:{minHeight:0,display:"block",width:"100%",height:"100%"}}):(t=!1===n||o?Object(c.c)(y.a,{icon:w.l,size:"3x"}):Object(c.c)(a.h,{size:"75"}),Object(c.c)("div",{sx:{width:"100%",height:"100%",minHeight:"120px",display:"flex",justifyContent:"center",alignItems:"center"}},t))};function je(e){var t,n,r,i=Object(C.c)().t,s=Object(ce.c)(),l=m(),u=v(),d=u.displayStream,b=u.userStream,p=u.displaySupported,O=u.userSupported,g=u.videoChoice,f=d||b,h=p||O,j=p&&O,y=function(e){return l({type:"CHOOSE_VIDEO",payload:e})},S=function(){var e=Object(I.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("user"),e.next=3,z(l,s);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(I.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("display"),e.next=3,L(l,s);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(I.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("both"),e.next=3,z(l,s);case 3:return e.next=5,L(l,s);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){y("none"),B(u.userStream,l),F(u.displayStream,l)},A=e.userHasWebcam,R="none"===g||"both"===g?!d||!b:!f,U=!1===u.userAllowed&&Object(c.c)(Z,{key:"user-stream-warning",isDanger:!0},Object(c.c)(a.f,{as:"h3",mb:2},i("source-user-not-allowed-title")),Object(c.c)(a.i,null,i("source-user-not-allowed-text"))),T=!1===u.displayAllowed&&Object(c.c)(Z,{key:"display-stream-warning",isDanger:!0},Object(c.c)(a.f,{as:"h3",mb:2},i("source-display-not-allowed-title")),Object(c.c)(a.i,null,i("source-display-not-allowed-text"))),P=(u.userUnexpectedEnd||u.displayUnexpectedEnd)&&Object(c.c)(Z,{key:"unexpexted-stream-end-warning",isDanger:!0},Object(c.c)(a.i,null,i("error-lost-video-stream")));switch(g){case"none":n=i("sources-video-question"),t=!0,r=h?Object(c.c)(o.a.Fragment,null,Object(c.c)(ve,null),Object(c.c)(a.e,{sx:{flexDirection:["column","row"],maxWidth:[270,850],width:"100%",mx:["auto","none"],mb:3,flex:"4 1 auto",maxHeight:["none","270px"],justifyContent:"center","& > :not(:last-of-type)":{mb:[3,0],mr:[0,3]}}},p&&Object(c.c)(me,{label:i("sources-scenario-display"),icon:w.d,onClick:E}),j&&Object(c.c)(me,{label:i("sources-scenario-display-and-user"),icon:w.e,onClick:k,disabledText:!A&&i("sources-video-no-cam-detected")}),O&&Object(c.c)(me,{label:i("sources-scenario-user"),icon:w.y,onClick:S,disabledText:!A&&i("sources-video-no-cam-detected")})),Object(c.c)(ve,null)):Object(c.c)(Z,{isDanger:!0},i("sources-video-none-available"));break;case"user":n=i("sources-video-user-selected"),t=!u.userStream&&!1!==u.userAllowed,r=Object(c.c)(ge,{reselectSource:D,warnings:[U,P],inputs:[{kind:i("sources-user"),stream:u.userStream,allowed:u.userAllowed,unexpectedEnd:u.userUnexpectedEnd}]});break;case"display":n=i("sources-video-display-selected"),t=!u.displayStream&&!1!==u.displayAllowed,r=Object(c.c)(ge,{reselectSource:D,warnings:[T,P],inputs:[{kind:i("sources-display"),stream:u.displayStream,allowed:u.displayAllowed,unexpectedEnd:u.displayUnexpectedEnd}]});break;case"both":n=i("sources-video-display-and-user-selected"),t=!u.userStream&&!1!==u.userAllowed||!u.displayStream&&!1!==u.displayAllowed,r=Object(c.c)(ge,{reselectSource:D,warnings:[T,U,P],inputs:[{kind:i("sources-display"),stream:u.displayStream,allowed:u.displayAllowed,unexpectedEnd:u.displayUnexpectedEnd},{kind:i("sources-user"),stream:u.userStream,allowed:u.userAllowed,unexpectedEnd:u.userUnexpectedEnd}]});break;default:return Object(c.c)("p",null,"Something went very wrong")}var H=t&&!u.userUnexpectedEnd&&!u.displayUnexpectedEnd;return Object(c.c)(a.d,{sx:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0}},Object(c.c)(x.b.h1,{sx:{textAlign:"center",fontSize:["26px","30px","32px"]}},n),r,"none"!==g&&Object(c.c)("div",{sx:{mb:3}}),"none"!==g&&Object(c.c)(Y,{next:t?null:{onClick:function(){return e.nextStep()},disabled:R},prev:H?null:{onClick:D,disabled:!1,label:"sources-video-reselect-source"}}))}var me=function(e){var t=e.icon,n=e.label,r=e.onClick,a=e.disabledText,i=void 0!==a&&a,o=!1!==i;return Object(c.c)("button",{onClick:r,disabled:o,title:n,sx:{fontFamily:"inherit",color:o?"gray.2":"gray.0",border:function(e){return"2px solid ".concat(o?e.colors.gray[2]:"black")},backgroundColor:"gray.4",borderRadius:"8px",flex:["1 1 auto","0 1 100%"],minWidth:"180px",maxWidth:"300px",minHeight:"120px",maxHeight:"250px",p:2,"&:hover":o?{}:{boxShadow:function(e){return"0 0 10px ".concat(e.colors.gray[2])},backgroundColor:"white"}}},Object(c.c)("div",{sx:{display:"block",textAlign:"center",mb:3}},Object(c.c)(y.a,{icon:t,size:"3x"})),Object(c.c)("div",{sx:{fontSize:4}},n),Object(c.c)("div",{sx:{fontSize:2,mt:1}},i))},ve=function(e){return Object(c.c)("div",Object.assign({sx:{flex:"1 0 0"}},e))};function xe(e){var t=e.recordingState,n=Object(C.c)().t,r=v(),a=r.displayStream,i=r.userStream,o=r.displayUnexpectedEnd,s=r.userUnexpectedEnd,l=t===Ke,u=[];return(a||o)&&u.push({body:Object(c.c)(ye,{title:n("share-desktop"),stream:a,paused:l}),dimensions:function(){return Object(p.b)(a)}}),(i||s)&&u.push({body:Object(c.c)(ye,{title:n("share-camera"),stream:i,paused:l}),dimensions:function(){return Object(p.b)(i)}}),Object(c.c)(Q,{gap:20},u)}function ye(e){e.title;var t=e.stream,n=e.paused,r=J(),a=Object(i.useRef)();return Object(i.useEffect)((function(){var e=a.current;if(e&&t)return e.srcObject||(e.srcObject=t),e.addEventListener("resize",r),n?e.pause():e.play(),function(){return e.removeEventListener("resize",r)}})),t?Object(c.c)("div",{sx:{position:"relative",backgroundColor:"gray.3",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.35)",overflow:"hidden",height:"100%",cursor:t?"initial":"pointer"}},n&&Object(c.c)("div",{sx:{position:"absolute",width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.5)"}},Object(c.c)(y.a,{icon:w.q,sx:{fontSize:"140px",maxWidth:"40%",maxHeight:"40%",position:"absolute",top:0,left:0,bottom:0,right:0,margin:"auto",animation:"3s ease-in-out infinite none pulse"}})),Object(c.c)("video",{ref:a,autoPlay:!0,muted:!0,sx:{outline:"none",width:"100%",height:"100%",background:"transparent"}})):Object(c.c)("div",{sx:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},Object(c.c)(y.a,{icon:w.l,size:"3x"}))}var we=n(34),Se=n(35),Ee=function(){function e(t,n){var r=this,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(we.a)(this,e);var a=void 0;if("isTypeSupported"in MediaRecorder){var i=((null===n||void 0===n?void 0:n.mimes)||[]).find((function(e){return MediaRecorder.isTypeSupported(e)}));i?(a=i,console.debug("using first supported MIME type from settings: ",i)):(null===n||void 0===n?void 0:n.mimes)&&console.debug("None of the MIME types specified in settings are supported by this `MediaRecorder`")}else(null===n||void 0===n?void 0:n.mimes)&&console.debug("MIME types were specified, but `MediaRecorder.isTypeSupported` is not supported by your browser");var o=Object(p.b)(t),s=(null===n||void 0===n?void 0:n.videoBitrate)||void 0,l=[];this.recorder=new MediaRecorder(t,{mimeType:a,videoBitsPerSecond:s}),this.recorder.ondataavailable=function(e){e.data.size>0?l.push(e.data):console.log("Recording data has size 0! ",e)},this.recorder.onerror=function(e){c.onError&&c.onError(e)},this.recorder.onstop=function(){var e,t=(null===(e=l[0])||void 0===e?void 0:e.type)||r.recorder.mimeType,n=new Blob(l,{type:t}),a=URL.createObjectURL(n);r.recorder=null,r.isRecording=!1,c.onStop&&c.onStop({url:a,media:n,mimeType:t,dimensions:o})},this.isRecording=!1,this.isPaused=!1}return Object(Se.a)(e,[{key:"start",value:function(){this.isRecording||(this.recorder.start(),this.isRecording=!0)}},{key:"pause",value:function(){this.isPaused||(this.recorder.pause(),this.isPaused=!0)}},{key:"resume",value:function(){this.isPaused&&(this.recorder.resume(),this.isPaused=!1)}},{key:"stop",value:function(){this.isRecording&&this.recorder.stop()}}]),e}(),ke=function(e){var t=e.large,n=Object(k.a)(e,["large"]);return Object(c.c)("button",Object.assign({sx:{backgroundColor:"transparent",border:"none",position:"relative",overflow:"hidden",my:0,mx:t?"15px":0,padding:0,fontSize:t?"5rem":"3.5rem",lineHeight:t?"5rem":"3.5rem",svg:{margin:0,padding:0,outline:"none"}}},n))},Ce=function(e){return Object(c.c)(ke,{onClick:e.onClick,title:e.title},Object(c.c)("span",{className:"fa-layers"},Object(c.c)(y.a,{icon:w.r})))},De=function(e){return Object(c.c)(ke,{onClick:e.onClick,title:e.title,large:e.large?1:0,disabled:e.disabled||e.countdown,sx:{color:"#bd181c","svg + svg":{color:"#e22319"},":disabled":{color:"#aaa"},":disabled svg + svg":{color:"#bbb"}}},Object(c.c)("span",{className:"fa-layers"},Object(c.c)(y.a,{icon:e.countdown?w.h:w.g,spin:e.countdown}),Object(c.c)(y.a,{icon:w.g,transform:"shrink-6"})))},Ae=function(e){return Object(c.c)(ke,{onClick:e.onClick,title:e.title},Object(c.c)("span",{className:"fa-layers"},Object(c.c)(y.a,{icon:w.t})))},Re=function(e){return Object(c.c)(ke,{onClick:e.onClick,title:e.title,large:!!e.large,sx:{color:"#bd181c"}},Object(c.c)(y.a,{icon:w.v}))},Ue=n(103),Te=n(119),Pe=n(120),_e=n(2),Ie=n(22),He=function(e){Object(Pe.a)(n,e);var t=Object(Te.a)(n);function n(e){var r;return Object(we.a)(this,n),r=t.call(this,e),Object.defineProperty(Object(Ue.a)(r),Le,{writable:!0,value:null}),Object.defineProperty(Object(Ue.a)(r),Ne,{writable:!0,value:null}),Object.defineProperty(Object(Ue.a)(r),ze,{writable:!0,value:!1}),r.state={milliseconds:0},Object(_e.a)(Object(Ue.a)(r),Le)[Le]=new Date,Object(_e.a)(Object(Ue.a)(r),Ne)[Ne]=setInterval((function(){return r.tick()}),100),r}return Object(Se.a)(n,[{key:"componentDidMount",value:function(){Object(_e.a)(this,ze)[ze]=!0}},{key:"componentWillUnmount",value:function(){this.stopTimer(),Object(_e.a)(this,ze)[ze]=!1}},{key:"resumeTimer",value:function(){var e=this;this.timerId||(Object(_e.a)(this,Ne)[Ne]=setInterval((function(){return e.tick()}),100),Object(_e.a)(this,Le)[Le]=new Date)}},{key:"stopTimer",value:function(){clearInterval(Object(_e.a)(this,Ne)[Ne]),Object(_e.a)(this,Ne)[Ne]=null}},{key:"componentDidUpdate",value:function(e){this.props.isPaused!==e.isPaused&&(this.props.isPaused?this.stopTimer():this.resumeTimer())}},{key:"tick",value:function(){if(Object(_e.a)(this,ze)[ze]){var e=new Date,t=e-Object(_e.a)(this,Le)[Le];Object(_e.a)(this,Le)[Le]=e,this.setState((function(e){return{milliseconds:e.milliseconds+t}}))}}},{key:"render",value:function(){var e=this.state.milliseconds,t=[e/36e5>>0,(e/6e4>>0)%60,(e/1e3>>0)%60];0===t[0]&&(t=t.slice(1));var n=t.map((function(e){return(e<10?"0":"")+e})).join(":");return Object(c.c)("span",{sx:{fontSize:3}},n)}}]),n}(i.Component),Le=Object(Ie.a)("last"),Ne=Object(Ie.a)("timerID"),ze=Object(Ie.a)("isMounted"),Me=He;function We(e,t){return function(n){var r=n.media,c=n.url,a=n.mimeType,i=n.dimensions;e({type:"ADD_RECORDING",payload:{deviceType:t,media:r,url:c,mimeType:a,dimensions:i}})}}function Fe(e,t){return e&&0!==e.getAudioTracks().length?new MediaStream([].concat(Object(d.a)(t.getVideoTracks()),Object(d.a)(e.getAudioTracks()))):t}var Be=[];function Ge(e){var t=e.handleRecorded,n=e.recordingState,r=e.setRecordingState,a=Object(C.c)().t,o=m(),s=Object(ce.c)(),d=v(),b=d.audioStream,p=d.displayStream,O=d.userStream,g=d.userUnexpectedEnd,f=d.displayUnexpectedEnd,h=d.audioUnexpectedEnd,j=Object(i.useRef)(null),x=Object(i.useRef)(null),y=(p||O)&&!g&&!f&&!h,w=Object(l.g)(),S=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];j.current&&j.current.stop(),x.current&&x.current.stop(),t(),o({type:e?"STOP_RECORDING_PREMATURELY":"STOP_RECORDING"}),Be.forEach((function(e){return e()})),Be=[]};Object(i.useEffect)((function(){(g||f||h)&&n===Ve&&S(!0),w.listen((function(){"STATE_INACTIVE"!==n&&o({type:"STOP_RECORDING"}),Be.forEach((function(e){return e()})),Be=[]}))}));return Object(c.c)("div",{sx:{m:0,width:n!==qe?"280px":"auto"}},n!==qe&&Object(c.c)(u.a,{onBeforeunload:function(e){return e.preventDefault()}}),Object(c.c)("div",{className:"buttons",sx:{display:"flex",alignItems:"center"}},n!==qe&&Object(c.c)("div",{sx:{flex:1,textAlign:"right"}},n===Ve&&Object(c.c)(Ce,{title:a("pause-button-title"),recordingState:n,onClick:function(){r(Ke),j.current&&j.current.pause(),x.current&&x.current.pause()}}),n===Ke&&Object(c.c)(Ae,{title:a("resume-button-title"),recordingState:n,onClick:function(){r(Ve),j.current&&j.current.resume(),x.current&&x.current.resume()}})),Object(c.c)("div",{className:"center"},n===qe?Object(c.c)(De,{large:!0,title:a("record-button-title"),recordingState:n,onClick:function(){y&&(r(Ve),function(){if(o({type:"CLEAR_RECORDINGS"}),p){var e=We(o,"desktop"),t=Fe(b,p);j.current=new Ee(t,s.recording,{onStop:e}),j.current.start()}if(O){var n=We(o,"video"),r=Fe(b,O);x.current=new Ee(r,s.recording,{onStop:n}),x.current.start()}o({type:"START_RECORDING"}),Be.push(w.block(a("confirm-cancel-recording")))}())},disabled:!y}):Object(c.c)(Re,{large:!0,title:a("stop-button-title"),recordingState:n,onClick:function(){r(qe),S()}})),n!==qe&&Object(c.c)("div",{sx:{flex:1}},Object(c.c)(Me,{isPaused:n===Ke}))))}var qe="inactive",Ke="paused",Ve="recording";function Ye(e){var t=Object(C.c)().t,n=v(),o=m(),s=Object(re.j)(),l=Object(i.useState)(qe),u=Object(r.a)(l,2),d=u[0],b=u[1],p=Object(i.useCallback)((function(){e.previousStep()}),[e]);return Object(c.c)(a.e,{sx:{flexDirection:"column",height:"100%",position:"relative",flexGrow:1}},(n.displayUnexpectedEnd||n.userUnexpectedEnd)&&Object(c.c)(Z,{isDanger:!0},Object(c.c)(a.i,null,t("error-lost-video-stream"))),n.audioUnexpectedEnd&&Object(c.c)(Z,{isDanger:!0},Object(c.c)(a.i,null,t("error-lost-audio-stream"))),Object(c.c)(xe,{recordingState:d}),Object(c.c)("div",{sx:{m:3}},Object(c.c)(Y,{prev:d===qe&&{onClick:p}},Object(c.c)(Ge,{handleRecorded:function(){s.refreshConnection(),function(e,t){var n=e.audioStream,r=e.displayStream,c=e.userStream;W(n,t),F(r,t),B(c,t)}(n,o),e.nextStep()},recordingState:d,setRecordingState:b}))))}function Xe(e){var t=Object(C.c)().t,n=m(),r=v(),i=r.recordings,o=r.prematureRecordingEnd,s=i.some((function(e){return 0===e.media.size}));return Object(c.c)(a.e,{sx:{flexDirection:"column",height:"100%",flexGrow:1,padding:3}},Object(c.c)(x.b.h1,{sx:{textAlign:"center",fontSize:["26px","30px","32px"]}},t("review-heading")),o&&Object(c.c)(Z,{isDanger:!0},Object(c.c)(a.i,null,t("error-lost-stream-end-recording"))),s&&Object(c.c)(Z,{isDanger:!0},t("review-error-empty-recording")),Object(c.c)(Je,null),Object(c.c)("div",{sx:{mb:3}}),Object(c.c)(Y,{prev:{onClick:function(){window.confirm(t("confirm-discard-recordings"))&&(n({type:"RESET"}),e.firstStep())},danger:!0,label:"review-button-discard-and-record"},next:{onClick:function(){e.nextStep()}}}))}var Je=function(){var e=v().recordings,t=Object(C.c)().t,n=[o.a.createRef(),o.a.createRef()],r=2===e.length?"desktop"===e[0].deviceType?0:1:null;if(Object(i.useEffect)((function(){if(2===e.length&&n[0].current&&n[1].current){n[r].current.volume=0;var t=null,c=n[0].current,a=n[1].current,i=function(e,n){var r=!1;c.addEventListener(e,(function(e){r||(t=0,n(e,c,a)),r=!r})),a.addEventListener(e,(function(e){r||(t=1,n(e,a,c)),r=!r}))};i("play",(function(e,t,n){n.currentTime=t.currentTime,n.play()})),i("pause",(function(e,t,n){n.currentTime=t.currentTime,n.pause()})),i("seeking",(function(e,t,n){n.currentTime=t.currentTime}));var o=0;window.requestAnimationFrame((function e(){if(o%60===0&&(Math.abs(c.currentTime-a.currentTime)>.15&&t)){var r=n[t].current;n[0===t?1:0].current.currentTime=r.currentTime}o++,window.requestAnimationFrame(e)}))}})),0===e.length)return Object(c.c)("div",{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"}},Object(c.c)(a.h,{title:t("save-creation-waiting-for-recordings")}));var s=e.map((function(e,t){return{body:Object(c.c)("video",{ref:n[t],key:t,controls:!0,src:e.url,onLoadedData:function(e){return e.target.currentTime=0},preload:"auto",sx:{width:"100%",height:"100%",backgroundColor:"#ccc",outline:"none"}}),dimensions:function(){return e.dimensions}}}));return Object(c.c)(Q,{gap:20},s)};function Qe(e){var t=e.activeStep,n=e.updateActiveStep,r=e.userHasWebcam;return Object(p.d)()?Object(c.c)(T,{activeStep:t,updateActiveStep:n},Object(c.c)(je,{userHasWebcam:r}),Object(c.c)(te,null),Object(c.c)(Ye,null),Object(c.c)(Xe,null),Object(c.c)(le,null)):null}var Ze=[{short:"en",long:"English",rtl:!1},{short:"de",long:"Deutsch",rtl:!1},{short:"nl",long:"Dutch",rtl:!1},{short:"el",long:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",rtl:!1},{short:"es",long:"Espa\xf1ol",rtl:!1},{short:"fa",long:"Farsi",rtl:!0},{short:"fr",long:"Fran\xe7ais",rtl:!1},{short:"tr",long:"Turkish",rtl:!1}],$e=function(e){var t=e.errors,n=e.label,r=e.name,a=e.register,i=e.required,o=e.validate,s=void 0===o?void 0:o,l=e.type,u=void 0===l?"text":l,d=Object(k.a)(e,["errors","label","name","register","required","validate","type"]),p=Object(C.c)().t;return Object(c.c)("div",{sx:{"&:not(:last-child)":{mb:3}}},Object(c.c)("label",{sx:{color:"text",display:"block",fontSize:2,fontWeight:"bold"}},n,Object(c.c)("div",{sx:{display:"block",boxSizing:"border-box",clear:"both",fontSize:2,position:"relative",textAlign:"left"}},Object(c.c)("input",Object.assign({"aria-invalid":t[r]?"true":"false","aria-describedby":"".concat(r,"Error"),autoComplete:"off",name:r,ref:a(Object(b.a)({validate:s},i?{required:p("forms-validation-error-required")}:{})),sx:{variant:"styles.input"},type:u},d)),t[r]&&Object(c.c)("p",{id:"".concat(r,"Error"),sx:{color:"error",fontSize:1,fontWeight:"body",mt:1}},t[r].message))))},et=function(e){var t=e.title,n=e.children;return Object(c.c)(a.a,{sx:{"&:not(:last-child)":{mb:5}}},Object(c.c)(x.b.h2,{sx:{borderBottom:function(e){return"1px solid ".concat(e.colors.gray[2])},pb:1,my:3,mx:0}},t),n)},tt=function(){var e=Object(C.c)().i18n;return Object(c.c)(et,{title:"Language"},Object(c.c)("select",{sx:{variant:"styles.select"},defaultValue:e.language,onChange:function(t){return e.changeLanguage(t.target.value)}},Ze.map((function(e){return Object(c.c)("option",{value:e.short,key:e.short},e.long)}))))},nt=n(118);var rt=function(e){var t=e.settingsManager,n=Object(l.h)(),o=Object(C.c)().t,u=Object(re.j)(),d=Object(i.useState)(),p=Object(r.a)(d,2),O=p[0],g=p[1],f=Object(nt.a)({defaultValues:t.formValues().opencast}),h=f.errors,j=f.handleSubmit,m=f.register,x=Object(i.useState)("initial"),S=Object(r.a)(x,2),E=S[0],k=S[1],D=v().recordings.length>0;function A(){return(A=Object(I.a)(_.a.mark((function e(n){var r;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k("testing"),e.next=3,re.a.init(Object(b.a)({},t.settings().opencast,{},n));case 3:r=e.sent,e.t0=r.getState(),e.next=e.t0===re.f?7:e.t0===re.g?12:e.t0===re.h?15:e.t0===re.e?18:e.t0===re.d?21:(e.t0===re.c||(e.t0,re.i),24);break;case 7:return u.setGlobalInstance(r),t.saveSettings({opencast:n}),k("saved"),g(null),e.abrupt("break",27);case 12:return k("error"),g(o("upload-settings-error-server-unreachable")),e.abrupt("break",27);case 15:return k("error"),g(o("upload-settings-error-response-not-ok")),e.abrupt("break",27);case 18:return k("error"),g(o("upload-settings-error-invalid-response")),e.abrupt("break",27);case 21:return k("error"),u.isLoginProvided()?g(o("upload-settings-invalid-provided-login")):g(o("upload-settings-invalid-login-data")),e.abrupt("break",27);case 24:console.error("bug: invalid state reached..."),k("error"),g("internal error :(");case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=t.isConfigurable("opencast.serverUrl"),U=t.isUsernameConfigurable(),T=t.isPasswordConfigurable();if(!R&&!U&&!T)return null;var P={testing:w.h,error:w.k,saved:w.f}[E];return Object(c.c)(et,{title:o("upload-settings-modal-header")},Object(c.c)(a.a,null,O&&Object(c.c)(Z,{isDanger:!0},O),Object(c.c)("form",{onSubmit:j((function(e){return A.apply(this,arguments)}))},R&&Object(c.c)($e,{errors:h,label:o("upload-settings-label-server-url"),name:"serverUrl",register:m,validate:function(e){try{var t=new URL(e);return"https:"===t.protocol||"http:"===t.protocol||o("upload-settings-invalid-url-http-start")}catch(r){var n=o("upload-settings-invalid-url");return e.startsWith("https://")||e.startsWith("http://")||(n+=" "+o("upload-settings-invalid-url-http-start")),n}},required:!0}),U&&Object(c.c)($e,{errors:h,label:o("upload-settings-label-username"),name:"loginName",register:m,required:!0}),T&&Object(c.c)($e,{errors:h,label:o("upload-settings-label-password"),name:"loginPassword",register:m,required:!0,type:"password"}),Object(c.c)("footer",{sx:{mt:4}},Object(c.c)(a.b,{title:o("upload-settings-button-store"),sx:{verticalAlign:"middle"}},o("upload-settings-button-store")),P&&Object(c.c)(y.a,{icon:P,sx:{ml:"10px",fontSize:"30px",verticalAlign:"middle"},spin:"testing"===E}),D&&"saved"===E&&Object(c.c)(s.b,{to:{pathname:"/",search:n.search},sx:{ml:3,variant:"styles.a"}},o("settings-back-to-recording"))))))},ct=function(e){var t=e.settingsManager,n=Object(C.c)().t;return Object(c.c)(a.a,{sx:{width:"100%",maxWidth:960,mx:"auto",p:3}},Object(c.c)("header",null,Object(c.c)(x.b.h1,null,n("settings-header"))),Object(c.c)(tt,null),Object(c.c)(rt,{settingsManager:t}))},at=function(){var e=Object(C.c)().t,t=[];return"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&t.push(Object(c.c)(Z,{key:"unsecure-connection",isDanger:!0},e("warning-https"))),Object(p.d)()||t.push(Object(c.c)(Z,{key:"media-recorder",isDanger:!0},e("warning-recorder-not-supported"),Object(p.f)()&&" "+e("warning-recorder-safari-hint"))),t.length>0?Object(c.c)("div",{sx:{p:3}},t):null};var it=function(e){var t=e.settingsManager,n=e.userHasWebcam,a=Object(i.useState)(0),o=Object(r.a)(a,2),s=o[0],u=o[1],d=Object(l.h)();return Object(c.c)(i.Fragment,null,Object(c.c)(ot,null),Object(c.c)(l.d,null,Object(c.c)(l.b,{path:"/settings",exact:!0},Object(c.c)(ct,{settingsManager:t})),Object(c.c)(l.b,{path:"/about",exact:!0},Object(c.c)(E,null)),Object(c.c)(l.b,{path:"/",exact:!0},Object(c.c)(Qe,{activeStep:s,updateActiveStep:u,userHasWebcam:n})),Object(c.c)(l.b,{path:"/*"},Object(c.c)(l.a,{to:{pathname:"/",search:d.search}}))))},ot=function(){var e=v(),t=e.recordings,n=e.upload,r=t.every((function(e){return e.downloaded})),a="uploaded"===n.state;return Object(c.c)(u.a,{onBeforeunload:function(e){(null===t||void 0===t?void 0:t.length)>0&&!a&&!r&&e.preventDefault()}})};t.default=function(e){var t=e.settingsManager,n=e.userHasWebcam;return Object(c.c)(s.a,{basename:"/"},Object(c.c)(j,null,Object(c.c)(a.e,{sx:{flexDirection:"column",height:"100%"}},Object(c.c)(D,null),Object(c.c)("main",{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:"285px"}},Object(c.c)(at,null),Object(c.c)(it,{settingsManager:t,userHasWebcam:n})))))}}}]);
//# sourceMappingURL=4.b2b54618.chunk.js.map