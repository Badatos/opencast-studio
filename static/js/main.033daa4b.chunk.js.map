{"version":3,"sources":["util.js","settings.js","opencast.js","style/global-style.js","theme.js","i18n/index.js","serviceWorker.js","index.js"],"names":["isDisplayCaptureSupported","navigator","mediaDevices","test","platform","userAgent","isUserCaptureSupported","isRecordingSupported","MediaRecorder","onSafari","dimensionsOf","stream","getVideoTracks","getSettings","width","height","recordingFileName","mime","flavor","title","presenter","titlePart","presenterPart","nowAsString","lowerMime","toLowerCase","startsWith","mimeToExt","pad2","n","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","userHasWebcam","a","enumerateDevices","devices","some","d","kind","decodeHexString","hex","length","SyntaxError","digitToNum","digit","charCodeAt","RangeError","bytes","Uint8Array","i","substring","TextDecoder","decode","SettingsManager","values","contextSettings","urlSettings","onChange","this","userSettings","newSettings","merge","window","localStorage","setItem","JSON","stringify","settings","all","defaultSettings","path","obj","fixedSettings","segments","split","segment","isConfigurable","opencast","loginProvided","allowParse","source","validate","schema","_type","validateValue","validateObj","value","actualType","expectedType","Array","isArray","Number","isInteger","out","s","console","warn","parseBoolean","parseInteger","parsed","parse","parseArray","expectedElementType","_elements","elem","validateResult","_validate","Object","keys","key","newPath","SCHEMA","self","stored","getItem","rawUserSettings","loadContextSettings","rawContextSettings","urlParams","URLSearchParams","location","search","rawUrlSettings","get","encoded","decoded","e","slice","forEach","upload","acl","fetchAcl","basepath","endsWith","settingsPath","process","REACT_APP_SETTINGS_PATH","base","url","origin","fetch","response","status","debug","ok","error","statusText","headers","json","uploadSettings","contentType","text","serverUrl","loginName","loginPassword","positiveInteger","name","URL","protocol","seriesId","workflowId","v","recording","videoBitrate","mimes","maxFps","maxHeight","b","deepmerge","arrayMerge","array","destinationArray","sourceArray","options","Context","React","createContext","useSettings","useContext","Provider","settingsManager","children","useState","updateSettings","useEffect","STATE_UNCONFIGURED","STATE_CONNECTED","STATE_LOGGED_IN","STATE_NETWORK_ERROR","STATE_RESPONSE_NOT_OK","STATE_INVALID_RESPONSE","STATE_INCORRECT_LOGIN","Opencast","updateGlobalOc","newInstance","equal","catchRequestError","updateUser","getInfoMe","newUser","user","username","jsonRequest","request","RequestError","password","btoa","unescape","encodeURIComponent","credentials","redirect","type","recordings","creator","onProgress","refreshConnection","isReadyToUpload","then","mediaPackage","addDcCatalog","attachAcl","uploadTracks","finishIngest","dcc","dcCatalog","body","FormData","append","method","template","DEFAULT_ACL_TEMPLATE","constructAcl","Blob","totalBytes","map","r","media","size","reduce","finishedTracksBytes","deviceType","mimeType","finishedBytes","trackFlavor","downloadName","Promise","resolve","reject","xhr","XMLHttpRequest","open","setRequestHeader","onload","target","responseText","onerror","onprogress","totalLoaded","loaded","send","hostname","Error","ltiCourseId","roles","find","replace","undefined","roleOAuthUser","defaultReadRoles","userRole","defaultWriteRoles","push","view","userName","escapeString","Mustache","render","msg","fn","useOpencast","initial","updateDummy","updateOpencast","old","XMLSerializer","serializeToString","Text","seriesLine","toISOString","GlobalStyle","heading","color","fontFamily","lineHeight","fontWeight","baseButton","fontSize","mr","bg","borderColor","borderWidth","borderStyle","cursor","opacity","breakpoints","space","fonts","monospace","fontSizes","fontWeights","bold","lineHeights","heights","headerHeight","colors","background","primary","secondary","muted","highlight","gray","videoOverlay","buttons","darken","danger","border","theme","cards","boxShadow","maxWidth","position","styles","root","h1","mt","mb","h2","h3","h4","h5","h6","p","pre","overflowX","code","table","borderCollapse","borderSpacing","th","textAlign","borderBottomStyle","td","img","input","borderRadius","px","py","outline","transition","select","progress","container","mx","resources","en","translation","de","el","es","fa","fr","nl","tr","i18n","use","initReactI18next","LanguageDetector","init","fallbackLng","keySeparator","interpolation","escapeValue","detection","order","Boolean","match","Sentry","dsn","initialize","mod","default","oc","ReactDOM","document","getElementById","App","StrictMode","message","serviceWorker","ready","registration","unregister","catch"],"mappings":"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","file":"static/js/main.033daa4b.chunk.js","sourcesContent":["// Checks if we app is running on a mobile device.\n//\n// This check could be more exhaustive, but this includes all browser we\n// officially support.\nexport const onMobileDevice = () =>\n  /Android|iPhone|iPad|iPod/i.test(navigator.platform) ||\n  /Android/i.test(navigator.userAgent);\n\n// Checks if the client supports capturing the device's display (or individual\n// windows).\n//\n// Detecting whether display capture is supported is hard. There is currently\n// no proper solution. See these two links for more information:\n// - https://stackoverflow.com/q/58842831/2408867\n// - https://github.com/w3c/mediacapture-screen-share/issues/127\n//\n// To work around this problem, we simply check if the browser runs on a\n// mobile device. Currently, no mobile device/browser supports display\n// capture. However, this will probably change in the future, so we have to\n// revisit this issue again. This is tracked in this issue:\n// https://github.com/elan-ev/opencast-studio/issues/204\nexport const isDisplayCaptureSupported = () =>\n  \"mediaDevices\" in navigator &&\n  \"getDisplayMedia\" in navigator.mediaDevices &&\n  !onMobileDevice();\n\n// Checks if the client supports capturing \"user devices\" (usually webcams or\n// phone cameras).\nexport const isUserCaptureSupported = () =>\n  'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;\n\n// Checks if the browsers supports the `MediaRecorder` API required to actually\n// record the media streams.\nexport const isRecordingSupported = () => typeof MediaRecorder !== 'undefined';\n\n// Checks if this runs in Safari. Check from https://stackoverflow.com/a/23522755/\nexport const onSafari = () => /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n// Returns the dimensions as [w, h] array or `null` if there is no video track.\nexport const dimensionsOf = stream => {\n  const { width, height } = stream?.getVideoTracks()?.[0]?.getSettings() ?? {};\n  return [width, height];\n};\n\n// Converts the MIME type into a file extension.\nexport const mimeToExt = mime => {\n  if (mime) {\n    const lowerMime = mime.toLowerCase();\n    if (lowerMime.startsWith(\"video/webm\")) {\n      return \"webm\";\n    }\n    if (lowerMime.startsWith(\"video/mp4\")) {\n      return \"mp4\";\n    }\n    if (lowerMime.startsWith(\"video/x-matroska\")) {\n      return \"mkv\";\n    }\n    if (lowerMime.startsWith(\"video/avi\")) {\n      return \"avi\";\n    }\n    if (lowerMime.startsWith(\"video/quicktime\")) {\n      return \"mov\";\n    }\n  }\n\n  // If we know nothing, our best guess is webm; except for Safari which does\n  // not understand webm: there it's mp4.\n  return onSafari() ? \"mp4\" : \"webm\";\n}\n\n// Returns a suitable filename for a recording with the MIME type `mime` and the\n// given `flavor`. The latter should be either `presenter` or `presentation`.\n// `mime` can be null or a string and is converted to a file extension on a best\n// effort basis.\nexport const recordingFileName = ({ mime, flavor, title, presenter }) => {\n  const titlePart = title ? ` - ${title}` : '';\n  const presenterPart = presenter ? ` - ${presenter}` : '';\n  return `${nowAsString()}${titlePart}${presenterPart} (${flavor}, OC Studio).${mimeToExt(mime)}`;\n};\n\nconst nowAsString = () => {\n  const pad2 = n => n >= 10 ? '' + n : '0' + n;\n\n  const now = new Date();\n  return ''\n    + now.getFullYear() + '-'\n    + pad2(now.getMonth() + 1) + '-'\n    + pad2(now.getDate()) + ' '\n    + pad2(now.getHours()) + '-'\n    + pad2(now.getMinutes());\n};\n\nexport const userHasWebcam = async () => {\n  if (!('mediaDevices' in navigator)) {\n    return false;\n  }\n\n  const devices = await navigator.mediaDevices.enumerateDevices()\n  return devices.some(d => d.kind === 'videoinput');\n}\n\n// Decodes the given hex string into a new string. If the given string contains\n// characters that are not hexadecimal digits or if the string's length is odd,\n// this function will throw an exception.\nexport const decodeHexString = hex => {\n  if (hex.length % 2 !== 0) {\n    throw new SyntaxError('hex string does not have an even length');\n  }\n\n  const digitToNum = digit => {\n    if (digit >= '0' && digit <= '9') {\n      return digit.charCodeAt(0) - '0'.charCodeAt(0);\n    } else if (digit >= 'a' && digit <= 'f') {\n      return digit.charCodeAt(0) - 'a'.charCodeAt(0) + 10;\n    } else if (digit >= 'A' && digit <= 'F') {\n      return digit.charCodeAt(0) - 'A'.charCodeAt(0) + 10;\n    } else {\n      throw new RangeError(`invalid hex digit '${digit}'`);\n    }\n  };\n\n  let bytes = new Uint8Array(hex.length / 2);\n  for (let i = 0; i < hex.length; i += 2) {\n    bytes[i / 2] = 16 * digitToNum(hex.substring(i, i + 1))\n      + digitToNum(hex.substring(i + 1, i + 2));\n  }\n\n  return new TextDecoder().decode(bytes);\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport React, { useEffect, useState } from 'react';\nimport deepmerge from 'deepmerge';\nimport { decodeHexString } from './util';\n\n\nconst LOCAL_STORAGE_KEY = 'ocStudioSettings';\nconst CONTEXT_SETTINGS_FILE = 'settings.json';\n\n// Responsible for obtaining settings from different places (context settings,\n// local storage, query parameter) and merging them appropriately.\nexport class SettingsManager {\n  // The settings set by the server. These cannot be edited by the user. If the\n  // server did not specify any settings, this is `{}`.\n  contextSettings = {};\n\n  // These settings are given in the query part of the URL (e.g.\n  // `?opencast.loginName=peter`). If there are no settings in the URL, this\n  // is `{}`.\n  urlSettings = {};\n\n  // The settings set by the user and stored in local storage. This is `{}` if\n  // there were no settings in local storage.\n  #userSettings = {};\n\n  // This function is called whenever the user saved their settings. The new\n  // settings object is passed as parameter.\n  onChange = null;\n\n  // This constructor is mainly used for tests. Use `init()` to get an instance\n  // for the real application.\n  constructor(values) {\n    if (values) {\n      if (values.contextSettings) {\n        this.contextSettings = values.contextSettings;\n      }\n      if (values.urlSettings) {\n        this.urlSettings = values.urlSettings;\n      }\n      if (values.userSettings) {\n        this.#userSettings = values.userSettings;\n      }\n    }\n  }\n\n  // Creates a new `Settings` instance by loading user settings from local\n  // storage and attempting to load context settings from `/settings.json`.\n  static async init() {\n    let self = new SettingsManager();\n\n    // Load the user settings from local storage\n    const stored = window.localStorage.getItem(LOCAL_STORAGE_KEY);\n    if (stored !== null) {\n      let rawUserSettings;\n      try {\n        rawUserSettings = JSON.parse(stored);\n      } catch {\n        console.warn(\"Could not parse settings stored in local storage. Ignoring.\");\n      }\n      self.#userSettings = self.validate(\n        rawUserSettings,\n        false,\n        'from local storage user settings',\n      );\n    }\n\n    const rawContextSettings = await SettingsManager.loadContextSettings() || {};;\n    self.contextSettings = self.validate(rawContextSettings, false, 'specified in \\'settings.json\\'');\n\n    // Get settings from URL query.\n    const urlParams = new URLSearchParams(window.location.search);\n\n    let rawUrlSettings = {};\n    if (urlParams.get('config')) {\n      // In this case, the GET parameter `config` is specified. We now expect a\n      // hex encoded stringified JSON object describing the configuration. This\n      // is possible in cases where special characters in GET parameters might\n      // get modified somehow (e.g. by an LMS). A config=hexstring only uses\n      // the most basic characters, so it should always work.\n\n      const encoded = urlParams.get('config');\n      try {\n        const decoded = decodeHexString(encoded);\n        rawUrlSettings = JSON.parse(decoded);\n      } catch (e) {\n        console.warn(\n          `Could not decode and parse hex-encoded JSON string given to GET parameter `\n          + `'config'. Ignoring. Error:`,\n          e,\n        );\n      }\n\n      for (const key of urlParams.keys()) {\n        if (key !== 'config') {\n          console.warn(\n            `URL GET parameter '${key}' is ignored as 'config' is specified. Either specify `\n            + ` all configuration via the 'config' GET parameter hex string or via direct GET `\n            + `parameters. Mixing is not allowed.`\n          );\n        }\n      }\n    } else {\n      // Interpret each get parameter as single configuration value.\n      for (let [key, value] of urlParams) {\n        // Create empty objects for full path (if the key contains '.') and set\n        // the value at the end.\n        let obj = rawUrlSettings;\n        const segments = key.split('.');\n        segments.slice(0, -1).forEach((segment) => {\n          if (!(segment in obj)) {\n            obj[segment] = {};\n          }\n          obj = obj[segment];\n        });\n        obj[segments[segments.length - 1]] = value;\n      }\n    }\n\n    self.urlSettings = self.validate(rawUrlSettings, true, 'given as URL GET parameter');\n\n    // We have to do some special treatment of the `upload.acl` property. Users\n    // cannot set this setting, so we only have to check urlSettings and\n    // contextSettings.\n    if (typeof self.urlSettings.upload?.acl !== 'undefined') {\n      await SettingsManager.fetchAcl(self.urlSettings.upload);\n    } else if (typeof self.contextSettings.upload?.acl !== 'undefined') {\n      await SettingsManager.fetchAcl(self.contextSettings.upload);\n    }\n\n    return self;\n  }\n\n  // Attempts to loads `settings.json`. If it fails for some reason, returns\n  // `null` and prints an appropriate message on console.\n  static async loadContextSettings() {\n    // Try to retrieve the context settings.\n    let basepath = process.env.PUBLIC_URL || '/';\n    if (!basepath.endsWith('/')) {\n      basepath += '/';\n    }\n\n    // Construct path to settings JSON file. If the `REACT_APP_SETTINGS_PATH` is\n    // given and starts with '/', it is interpreted as absolute path from the\n    // server root.\n    const settingsPath = process.env.REACT_APP_SETTINGS_PATH || CONTEXT_SETTINGS_FILE;\n    const base = settingsPath.startsWith('/') ? '' : basepath;\n    const url = `${window.location.origin}${base}${settingsPath}`;\n    let response;\n    try {\n      response = await fetch(url);\n    } catch (e) {\n      console.warn('Could not access `settings.json` due to network error!', e || \"\");\n      return null;\n    }\n\n    if (response.status === 404) {\n      // If `settings.json` was not found, we silently ignore the error. We\n      // expecet many installation to now provide this file.\n      console.debug(\"`settings.json` returned 404: ignoring\");\n      return null;\n    } else if (!response.ok) {\n      console.error(\n        `Fetching 'settings.json' failed: ${response.status} ${response.statusText}`\n      );\n      return null;\n    }\n\n    if (!response.headers.get('Content-Type').startsWith('application/json')) {\n      console.warn(\n        \"'settings.json' request does not have 'Content-Type: application/json' -> ignoring...\"\n      );\n      return null;\n    }\n\n    try {\n      return await response.json();\n    } catch(e) {\n      console.error(\"Could not parse 'settings.json': \", e);\n      throw new SyntaxError(`Could not parse 'settings.json': ${e}`);\n    }\n  }\n\n  static async fetchAcl(uploadSettings) {\n    if (uploadSettings.acl === 'false' || uploadSettings.acl === false) {\n      uploadSettings.acl = false;\n      return;\n    } else if (typeof uploadSettings.acl === 'string') {\n      // Try to retrieve the context settings.\n      let basepath = process.env.PUBLIC_URL || '/';\n      if (!basepath.endsWith('/')) {\n        basepath += '/';\n      }\n\n      // Construct path to settings XML file. If the `uploadSettings.acl`\n      // starts with '/', it is interpreted as absolute path from the server\n      // root.\n      const base = uploadSettings.acl.startsWith('/') ? '' : basepath;\n      const url = `${window.location.origin}${base}${uploadSettings.acl}`;\n\n      // Try to download ACL template file\n      let response;\n      try {\n        response = await fetch(url);\n      } catch (e) {\n        console.error(\n          `Could not access ACL template '${url}' due to network error! Using default ACLs.`,\n          e || \"\",\n        );\n        uploadSettings.acl = true;\n        return;\n      }\n\n      // Check for 404 error\n      if (response.status === 404) {\n        console.error(`ACL template '${url}' returned 404! Using default ACLs`);\n        uploadSettings.acl = true;\n        return;\n      } else if (!response.ok) {\n        console.error(\n          `Fetching ACL template '${url}' failed: ${response.status} ${response.statusText}`\n        );\n        uploadSettings.acl = true;\n        return;\n      }\n\n      // Warn if the content type of the request is unexpected. We still use the\n      // response as, opposed to `settings.xml`, the path is explicitly set.\n      const contentType = response.headers.get('Content-Type');\n      if (!contentType.startsWith('application/xml') && !contentType.startsWith('text/xml')) {\n        console.warn(\n          `ACL template request '${url}' does not have 'Content-Type: application/xml' or 'Content-Type: text/xml'. `\n          + `This could be a bug. Using the response as ACL template anyway.`\n        );\n      }\n\n      // Finally, set the setting to the template string.\n      uploadSettings.acl = await response.text();\n    } else {\n      uploadSettings.acl = true;\n      console.warn(\n        `'upload.acl' has invalid value (has to be 'false' or a path to an XML `\n        + `template file. Using default ACLs.`\n      );\n      return;\n    }\n  }\n\n  // Stores the given `newSettings` as user settings. The given object might be\n  // partial, i.e. only the new values can be specified. Values in `newSettings`\n  // override values in the old user settings.\n  saveSettings(newSettings) {\n    this.#userSettings = merge(this.#userSettings, newSettings);\n    window.localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(this.#userSettings));\n    if (this.onChange) {\n      this.onChange(this.settings());\n    }\n  }\n\n  // The merged settings that the whole application should use.\n  settings() {\n    return merge.all([this.#userSettings, this.contextSettings, this.urlSettings]);\n  }\n\n  // The values for the settings forms. These are simply the user settings with\n  // missing settings filled by `defaultSettings`.\n  formValues() {\n    return merge(defaultSettings, this.#userSettings);\n  }\n\n  fixedSettings() {\n    return merge(this.contextSettings, this.urlSettings);\n  }\n\n  // Returns whether a specific setting is configurable by the user. It is not\n  // if the setting is fixed by the context setting or an URL setting. The path\n  // is given as string. Example: `manager.isConfigurable('opencast.loginName')`\n  isConfigurable(path) {\n    let obj = this.fixedSettings();\n    const segments = path.split('.');\n    for (const segment of segments) {\n      if (!(segment in obj)) {\n        return true;\n      }\n      obj = obj[segment];\n    }\n\n    return false;\n  }\n\n  isUsernameConfigurable() {\n    return this.isConfigurable('opencast.loginName')\n      && this.fixedSettings().opencast?.loginProvided !== true;\n  }\n  isPasswordConfigurable() {\n    return this.isConfigurable('opencast.loginPassword')\n      && this.fixedSettings().opencast?.loginProvided !== true;\n  }\n\n  // Validate the given `obj` with the global settings `SCHEMA`. If `allowParse`\n  // is true, string values are attempted to parse into the expected type.\n  // `source` is just a string for error messages specifying where `obj` comes\n  // from.\n  validate(obj, allowParse, source) {\n    const parseBoolean = (s, path) => {\n      switch (s) {\n        case 'true':\n          return true;\n\n        case 'false':\n          return false;\n\n        default:\n          console.warn(\n            `Settings value '${path}' (${source}) can't be parsed as 'boolean' `\n            + ` (value: '${s}'). Ignoring.`\n          );\n          return null;\n      }\n    };\n\n    const parseInteger = (s, path) => {\n      if (/^[-+]?(\\d+)$/.test(s)) {\n        return Number(s);\n      } else {\n        console.warn(\n          `Settings value '${path}' (${source}) can't be parsed as integer `\n          + `(value: '${s}'). Ignoring.`\n        );\n        return null;\n      }\n    };\n\n    const parseArray = (s, path) => {\n      try {\n        const parsed = JSON.parse(s);\n        if (!Array.isArray(parsed)) {\n          console.warn(\n            `Settings value '${path}' (${source}) is not an 'array' (value: '${s}'). Ignoring.`\n          );\n          return null;\n        }\n\n        return parsed;\n      } catch {\n        console.warn(\n          `Settings value '${path}' (${source}) can't be parsed as its `\n          + `expected type 'array' (value: '${s}'). Ignoring.`\n        );\n        return null;\n      }\n    };\n\n    // Validates `obj` with `schema`. `path` is the current path used for error\n    // messages.\n    const validate = (schema, obj, path) => {\n      if (typeof schema === 'string' || typeof schema._type === 'string') {\n        return validateValue(schema, obj, path);\n      } else {\n        return validateObj(schema, obj, path);\n      }\n    };\n\n    // Validate a settings value. `schema` should either be a string specifying\n    // the expected type or an object with these fields:\n    //\n    // - `_type`: a string specifying the expected type\n    // - `_validate` (optional): a function returning either `true` (validation\n    //   successful) or a string (validation error).\n    // - `_elements`: Only if `_type` is 'array'! Specifies type and validation\n    //   function for array elements. Object with fields `_type` and optionally\n    //   `_validate`.\n    const validateValue = (schema, value, path) => {\n      // Check the type of this value.\n      const expectedType = typeof schema === 'string' ? schema : schema._type;\n      let actualType;\n      if (Array.isArray(value)) {\n        actualType = 'array';\n      } else if (Number.isInteger(value)) {\n        actualType = 'int';\n      } else {\n        actualType = typeof value;\n      }\n\n      let out = null;\n      if (expectedType === 'any' || actualType === expectedType) {\n        out = value;\n      } else {\n        if (actualType === 'string' && allowParse) {\n          switch (expectedType) {\n            case 'boolean': out = parseBoolean(value, path); break;\n            case 'int': out = parseInteger(value, path); break;\n            case 'array': out = parseArray(value, path); break;\n            default:\n              console.warn(`internal bug: unknown type ${expectedType}. Ignoring ${path}.`);\n          }\n        } else {\n          console.warn(\n            `Settings value '${path}' (${source}) should be of type '${expectedType}', but is `\n            + `'${actualType}' (${value}). Ignoring.`\n          );\n        }\n      }\n\n      // Check type of array elements and validate those.\n      if (Array.isArray(out) && typeof schema === 'object' && '_elements' in schema) {\n        const expectedElementType = typeof schema._elements === 'string'\n          ? schema._elements\n          : schema._elements._type;\n\n        for (const elem of out) {\n          if (typeof elem !== expectedElementType) {\n            console.warn(\n              `Some elements of array value '${path}' (${source}) are not of type `\n              + `'${expectedElementType}'. Ignoring complete array.`\n            );\n            return null;\n          }\n\n          if (typeof schema._elements === 'object' && '_validate' in schema._elements) {\n            const validateResult = schema._elements._validate(elem);\n            if (validateResult !== true) {\n              console.warn(\n                `Validation of one element in array setting value '${path}' (${source}) `\n                + `failed: ${validateResult}. Ignoring complete array.`\n              );\n              return null;\n            }\n          }\n        }\n      }\n\n      // Run validation function if the type was correct and a validation is\n      // specified.\n      if (out !== null && typeof schema === 'object' && '_validate' in schema) {\n        const validateResult = schema._validate(out);\n        if (validateResult !== true) {\n          console.warn(\n            `Validation of setting value '${path}' (${source}) failed: ${validateResult}. `\n            + `Ignoring.`\n          );\n          return null;\n        }\n      }\n\n      return out;\n    };\n\n    // Validate a settings object/namespace. `schema` and `obj` need to be\n    // objects.\n    const validateObj = (schema, obj, path) => {\n      // We iterate through all keys of the given settings object, checking if\n      // each key is valid and recursively validating the value of that key.\n      let out = {};\n      for (const key of Object.keys(obj)) {\n        const newPath = path ? `${path}.${key}` : key;\n        if (key in schema) {\n          const value = validate(schema[key], obj[key], newPath);\n\n          // If `null` is returned, the validation failed and we ignore this\n          // value.\n          if (value !== null) {\n            out[key] = value;\n          }\n        } else {\n          console.warn(\n            `'${newPath}' (${source}) is not a valid settings key. Ignoring.`\n          );\n        }\n      }\n\n      return out;\n    };\n\n    return validate(SCHEMA, obj, \"\");\n  }\n}\n\n\nexport const validateServerUrl = value => {\n  if (value === '/' || value === '') {\n    return true;\n  }\n\n  try {\n    const url = new URL(value);\n    return (url.protocol === 'https:' || url.protocol === 'http:')\n      || 'the URL does not start with \"http:\" or \"https:\"';\n  } catch (e) {\n    return 'not a valid URL';\n  }\n};\n\n\nconst defaultSettings = {\n  opencast: {\n    serverUrl: 'https://develop.opencast.org/',\n    loginName: 'admin',\n    loginPassword: 'opencast',\n  }\n};\n\nconst positiveInteger = name => ({\n  _type: 'int',\n  _validate: i => i > 0 || `'${name}' has to be positive, but is '${i}'`,\n});\n\n// Defines all potential settings and their types\nconst SCHEMA = {\n  opencast: {\n    serverUrl: {\n      _type: 'string',\n      _validate: validateServerUrl,\n    },\n    loginName: 'string',\n    loginPassword: 'string',\n    loginProvided: 'boolean',\n  },\n  upload: {\n    seriesId: 'string',\n    workflowId: 'string',\n    // This gets some special treatment in `fetchAcl`. After `fetchAcl` is\n    // done, this one of:\n    // - undefined: setting was not set.\n    // - `false`: do not send any ACLs when uploading\n    // - `true`: explictely send default ACLs when uploading (this is the default behavior)\n    // - ACL template string: already fetched ACL template string.\n    acl: {\n      _type: 'any',\n      _validate: v => (\n        v === false || typeof v === 'string' || `'upload.acl' needs to be 'false' or a string`\n      ),\n    },\n  },\n  recording: {\n    videoBitrate: positiveInteger('bitrate'),\n    mimes: {\n      _type: 'array',\n      _elements: {\n        _type: 'string',\n      }\n    },\n  },\n  'display': {\n    maxFps: positiveInteger('display.maxFps'),\n    maxHeight: positiveInteger('display.maxHeight'),\n  },\n  'camera': {\n    maxFps: positiveInteger('camera.maxFps'),\n    maxHeight: positiveInteger('camera.maxHeight'),\n  },\n};\n\n\n// Custumize array merge behavior\nlet merge = (a, b) => {\n  return deepmerge(a, b, { arrayMerge });\n};\nmerge.all = array => deepmerge.all(array, { arrayMerge })\nconst arrayMerge = (destinationArray, sourceArray, options) => sourceArray;\n\n\nconst Context = React.createContext(null);\n\n// Returns the current provided Opencast instance.\nexport const useSettings = () => React.useContext(Context);\n\nexport const Provider = ({ settingsManager, children }) => {\n  const [settings, updateSettings] = useState(settingsManager.settings());\n  settingsManager.onChange = newSettings => updateSettings(newSettings);\n\n  // This debug output will be useful for future debugging sessions.\n  useEffect(() => {\n    console.debug(\"Current settings: \", settings);\n  });\n\n  return (\n    <Context.Provider value={settings}>\n      {children}\n    </Context.Provider>\n  );\n};\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx } from 'theme-ui';\nimport React, { useEffect, useState } from 'react';\nimport equal from 'fast-deep-equal';\nimport Mustache from 'mustache';\n\nimport { recordingFileName } from './util.js';\n\n\n// The server URL was not specified.\nexport const STATE_UNCONFIGURED = 'unconfigured';\n\n// The OC server is reachable but a login was not attempted and the current user\n// is anonymous.\nexport const STATE_CONNECTED = 'connected';\n\n// The OC server is reachable and the user is authenticated.\nexport const STATE_LOGGED_IN = 'logged_in';\n\n// Some network error occured when accessing the server.\nexport const STATE_NETWORK_ERROR = 'network_error';\n\n// When accessing the OC API, the request returned as non-2xx code unexpectedly.\n// This likely indicates that the server is not actually a valid OC server.\nexport const STATE_RESPONSE_NOT_OK = 'response_not_ok';\n\n// The API requested returned invalid JSON or unexpected data.\nexport const STATE_INVALID_RESPONSE = 'invalid_response';\n\n// The server is reachable and a login was provided, but the login did not\n// succeed.\nexport const STATE_INCORRECT_LOGIN = 'incorrect_login';\n\n\nexport class Opencast {\n  #state = STATE_UNCONFIGURED;\n  #serverUrl = null;\n\n  // This can one of either:\n  // - `null`: no login is provided and login data is not specified\n  // - `true`: a login is already automatically provided from the OC context\n  // - `{ username, password }`: username and password are given\n  #login = null;\n\n  // The response of `info/me.json` or `null` if requesting that API did not\n  // succeed.\n  #currentUser = null;\n\n  updateGlobalOc = null;\n\n\n  // Creates a new instance. Static method instead of constructor because it\n  // needs to be async.\n  static async init(settings) {\n    let self = new Opencast();\n\n    if (!settings?.serverUrl) {\n      self.#state = STATE_UNCONFIGURED;\n      self.#serverUrl = null;\n      self.#login = null;\n\n      return self;\n    }\n\n    self.#serverUrl = settings.serverUrl.endsWith('/')\n      ? settings.serverUrl.slice(0, -1)\n      : settings.serverUrl;\n\n    if (settings.loginProvided === true) {\n      // Here we can assume Studio is running within an Opencast instance and\n      // the route to Studio is protected via login. This means that login\n      // cookies are already present and we don't need to worry about that.\n      self.#login = true;\n    } else if (settings.loginName && settings.loginPassword) {\n      // Studio is not running in OC context, but username and password are\n      // provided.\n      self.#login = {\n        username: settings.loginName,\n        password: settings.loginPassword,\n      };\n    } else {\n      // Login is not yet provided.\n      self.#login = null;\n    }\n\n    await catchRequestError(async () => await self.updateUser());\n\n    return self;\n  }\n\n  // Updates the global OC instance from `this` to `newInstance`, IF the new\n  // instance is different. This should only be called when the settings are\n  // saved.\n  setGlobalInstance(newInstance) {\n    if (!this.updateGlobalOc) {\n      console.error(\"bug: 'updateGlobalOc' not set\");\n    }\n\n    // We only update if the two instances are different (ignoring the\n    // `updateGlobalOc` key though).\n    newInstance.updateGlobalOc = this.updateGlobalOc;\n    const changed = this.#state !== newInstance.#state\n      || this.#serverUrl !== newInstance.#serverUrl\n      || !equal(this.#login, newInstance.#login)\n      || !equal(this.#currentUser, newInstance.#currentUser);\n\n    if (changed) {\n      this.updateGlobalOc(newInstance);\n    }\n  }\n\n  // Refreshes the connection by requesting `info/me` unless the state is\n  // 'unconfigured'.\n  //\n  // If the request errors or returns a different user, the globale Opencast\n  // instance is updated.\n  async refreshConnection() {\n    if (this.#state === STATE_UNCONFIGURED) {\n      return;\n    }\n\n    await catchRequestError(async () => {\n      // Request to `info/me`. If the user or the current state has changed\n      const changed = await this.updateUser();\n      if (changed) {\n        this.updateGlobalOc(this);\n      }\n    });\n  }\n\n  // Updates `#currentUser` by checking 'info/me.json'.\n  //\n  // The `#state` is also updated accordingly to `STATE_LOGGED_IN`,\n  // `STATE_INCORRECT_LOGIN` or `STATE_CONNECTED`. This method returns whether\n  // the state or user object has changed in any way.\n  async updateUser() {\n    const newUser = await this.getInfoMe();\n\n    if (!equal(newUser, this.#currentUser)) {\n      this.#currentUser = newUser;\n      if (newUser.user.username === 'anonymous') {\n        if (this.#login) {\n          this.#state = STATE_INCORRECT_LOGIN;\n        } else {\n          this.#state = STATE_CONNECTED;\n        }\n      } else {\n        this.#state = STATE_LOGGED_IN;\n      }\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  // Returns the response from the `info/me.json` endpoint.\n  async getInfoMe() {\n    return await this.jsonRequest(\"info/me.json\");\n  }\n\n  // Sends a request to the Opencast API expecting a JSON response.\n  //\n  // On success, the parsed JSON is returned as object. If anything goes wrong,\n  // a `RequestError` is thrown and the corresponding `this.#state` is set.\n  async jsonRequest(path, options = {}) {\n    const url = `${this.#serverUrl}/${path}`;\n    const response = await this.request(path, options);\n\n    try {\n      return await response.json();\n    } catch(e) {\n      this.#state = STATE_INVALID_RESPONSE;\n      throw new RequestError(`invalid response (invalid JSON) when accessing ${url}: `, e);\n    }\n  }\n\n  // Sends a request to the Opencast API, returning the response object.\n  //\n  // If anything goes wrong, a `RequestError` is thrown and the corresponding\n  // `this.#state` is set.\n  async request(path, options = {}) {\n    const url = `${this.#serverUrl}/${path}`;\n\n    // Add HTTP Basic Auth headers if username and password are provided.\n    let headers = {};\n    if (this.#login?.username && this.#login?.password) {\n      const encoded = btoa(unescape(encodeURIComponent(\n        this.#login.username + ':' + this.#login.password\n      )));\n      headers = { 'Authorization': `Basic ${encoded}` };\n    }\n\n    let response;\n    try {\n      response = await fetch(url, {\n        ...options,\n        credentials: 'same-origin',\n        redirect: 'manual',\n        headers,\n      });\n    } catch (e) {\n      this.#state = STATE_NETWORK_ERROR;\n      throw new RequestError(`network error when accessing '${url}': `, e);\n    }\n\n    // Handle 401 Bad credentials for HTTP Basic Auth\n    if (response.status === 401) {\n      this.#state = STATE_INCORRECT_LOGIN;\n      throw new RequestError(\"incorrect login data (request returned 401)\");\n    }\n\n    if (!response.ok && response.type !== 'opaqueredirect') {\n      this.#state = STATE_RESPONSE_NOT_OK;\n      throw new RequestError(\n        `unexpected ${response.status} ${response.statusText} response when accessing ${url}`\n      );\n    }\n\n    return response;\n  }\n\n  // Uploads the given recordings with the given title and creator metadata. If\n  // the upload fails, `false` is returned and `getState` changes to an error\n  // state.\n  async upload({ recordings, title, creator, uploadSettings, onProgress }) {\n    // Refresh connection and check if we are ready to upload.\n    await this.refreshConnection();\n    if (!this.isReadyToUpload()) {\n      return false;\n    }\n\n    // Actually upload\n    try {\n      // Create new media package\n      let mediaPackage = await this.request(\"ingest/createMediaPackage\")\n        .then(response => response.text());\n\n      // Add metadata to media package\n      mediaPackage = await this.addDcCatalog({ mediaPackage, uploadSettings, title, creator });\n\n      // Set appropriate ACL unless the configuration says no.\n      if (uploadSettings?.acl !== false) {\n        mediaPackage = await this.attachAcl({ mediaPackage, uploadSettings });\n      }\n\n      // Add all recordings (this is the actual upload).\n      mediaPackage = await this.uploadTracks(\n        { mediaPackage, recordings, onProgress, title, creator }\n      );\n\n      // Finalize/ingest media package\n      await this.finishIngest({ mediaPackage, uploadSettings });\n\n      return true;\n    } catch(e) {\n      console.error(\"Error occured during upload: \", e);\n      return false;\n    }\n  }\n\n  // Adds the DC Catalog with the given metadata to the current ingest process\n  // via `ingest/addDCCatalog`. Do not call this method outside of `upload`!\n  async addDcCatalog({ mediaPackage, title, creator, uploadSettings }) {\n    const seriesId = uploadSettings?.seriesId;\n\n    const dcc = dcCatalog({ creator, title, seriesId });\n    const body = new FormData();\n    body.append('mediaPackage', mediaPackage);\n    body.append('dublinCore', dcc);\n    body.append('flavor', 'dublincore/episode');\n\n    return await this.request(\"ingest/addDCCatalog\", { method: 'post', body })\n      .then(response => response.text());\n  }\n\n  // Adds the ACL to the current ingest process via `ingest/addAttachment`. Do\n  // not call this method outside of `upload`!\n  async attachAcl({ mediaPackage, uploadSettings }) {\n    const template = uploadSettings?.acl === true || (!uploadSettings?.acl)\n      ? DEFAULT_ACL_TEMPLATE\n      : uploadSettings?.acl;\n    const acl = this.constructAcl(template);\n\n    const body = new FormData();\n    body.append('flavor', 'security/xacml+episode');\n    body.append('mediaPackage', mediaPackage);\n    body.append('BODY', new Blob([acl]), 'acl.xml');\n\n    return await this.request(\"ingest/addAttachment\", { method: 'post', body: body })\n      .then(response => response.text());\n  }\n\n  // Uploads the given recordings to the current ingest process via\n  // `ingest/addTrack`. Do not call this method outside of `upload`!\n  async uploadTracks({ mediaPackage, recordings, onProgress, title, creator }) {\n    const totalBytes = recordings.map(r => r.media.size).reduce((a, b) => a + b, 0);\n    let finishedTracksBytes = 0;\n\n    for (const { deviceType, media, mimeType } of recordings) {\n      const finishedBytes = finishedTracksBytes;\n      let trackFlavor = 'presentation/source';\n      if (deviceType === 'desktop') {\n        trackFlavor = 'presentation/source';\n      } else if (deviceType === 'video') {\n        trackFlavor = 'presenter/source';\n      }\n\n      const flavor = deviceType === 'desktop' ? 'presentation' : 'presenter';\n      const downloadName = recordingFileName({ mimeType, flavor, title, presenter: creator });\n\n      const body = new FormData();\n      body.append('mediaPackage', mediaPackage);\n      body.append('flavor', trackFlavor);\n      body.append('tags', '');\n      body.append('BODY', media, downloadName);\n\n      const url = `${this.#serverUrl}/ingest/addTrack`;\n      mediaPackage = await new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', url);\n\n        // Add HTTP Basic Auth headers if username and password are provided.\n        if (this.#login?.username && this.#login?.password) {\n          const encoded = btoa(unescape(encodeURIComponent(\n            this.#login.username + ':' + this.#login.password\n          )));\n          xhr.setRequestHeader('Authorization', `Basic ${encoded}`);\n        }\n\n        xhr.onload = e => resolve(e.target.responseText);\n        xhr.onerror = () => {\n          // Handle 401 Bad credentials for HTTP Basic Auth\n          if (xhr.status === 401) {\n            this.#state = STATE_INCORRECT_LOGIN;\n            reject(new RequestError(\"incorrect login data (request returned 401)\"));\n          } else {\n            this.#state = STATE_RESPONSE_NOT_OK;\n            reject(new RequestError(\n              `unexpected ${xhr.status} ${xhr.statusText} response when accessing ${url}`\n            ));\n          }\n        };\n        xhr.upload.onprogress = e => {\n          if (onProgress) {\n            const totalLoaded = e.loaded + finishedBytes;\n            onProgress(totalLoaded / totalBytes);\n          }\n        };\n\n        try {\n          xhr.send(body);\n        } catch (e) {\n          this.#state = STATE_NETWORK_ERROR;\n          reject(new RequestError(`network error when accessing '${url}': `, e));\n        }\n      });\n\n      finishedTracksBytes += media.size;\n    }\n\n    return mediaPackage;\n  }\n\n  // Finishes the current ingest process via `ingest/ingest`. Do not call this\n  // method outside of `upload`!\n  async finishIngest({ mediaPackage, uploadSettings }) {\n    const workflowId = uploadSettings?.workflowId;\n\n    const body = new FormData();\n    body.append('mediaPackage', mediaPackage);\n    if (workflowId) {\n      body.append('workflowDefinitionId', workflowId);\n    }\n    await this.request(\"ingest/ingest\", { method: 'post', body: body });\n  }\n\n  // Returns the current state of the connection to the OC server.\n  getState() {\n    return this.#state;\n  }\n\n  // Returns whether or not a login is already provided (i.e. we don't need to\n  // login manually).\n  isLoginProvided() {\n    return this.#login === true;\n  }\n\n  // Returns whether or not the connection is ready to upload a video.\n  isReadyToUpload() {\n    return this.#state === STATE_LOGGED_IN;\n  }\n\n  // Returns the server URL in a form suitable to present to the user. Returns\n  // `null` if the server URL is not configured yet or if it is the same\n  // hostname as the one studio is running on.\n  prettyServerUrl() {\n    const url = this.#serverUrl;\n\n    return url && url.startsWith(\"https\")\n      ? new URL(url).hostname\n      : null;\n  }\n\n  // Constructs the ACL XML structure from the given template string.\n  constructAcl(template) {\n    if (!this.#currentUser) {\n      throw new Error(`'currentUser' is '${this.#currentUser}' in 'constructAcl'`);\n    }\n\n    // Prepare template \"view\": the values that can be used within the template.\n    let ltiCourseId = this.#currentUser.roles\n      .find(r => r.endsWith('_Learner') || r.endsWith('_Instructor'))\n      ?.replace('_Learner', '')\n      .replace('_Instructor', '');\n    if (ltiCourseId === 'LTI') {\n      ltiCourseId = undefined;\n    }\n\n    const roleOAuthUser = this.#currentUser.roles.find(r => r === 'ROLE_OAUTH_USER');\n\n    let defaultReadRoles = [this.#currentUser.userRole];\n    let defaultWriteRoles = [this.#currentUser.userRole];\n    if (ltiCourseId) {\n      defaultReadRoles.push(`${ltiCourseId}_Learner`, `${ltiCourseId}_Instructor`);\n      defaultWriteRoles.push(`${ltiCourseId}_Instructor`);\n    }\n\n    const view = {\n      userName: escapeString(this.#currentUser.user.username),\n      userRole: escapeString(this.#currentUser.userRole),\n      roleOAuthUser: escapeString(roleOAuthUser),\n      ltiCourseId: escapeString(ltiCourseId),\n      defaultReadRoles: defaultReadRoles.map(r => escapeString(r)),\n      defaultWriteRoles: defaultWriteRoles.map(r => escapeString(r)),\n    };\n    return Mustache.render(template, view);\n  }\n}\n\n\n// Internal error type, simply containing a string.\nfunction RequestError(msg) {\n  this.msg = msg;\n}\n\nconst catchRequestError = async (fn) => {\n  try {\n    return await fn();\n  } catch (e) {\n    if (e instanceof RequestError) {\n      console.error(e.msg);\n    } else {\n      throw e;\n    }\n    return null;\n  }\n};\n\n\nconst Context = React.createContext(null);\n\n// Returns the current provided Opencast instance.\nexport const useOpencast = () => React.useContext(Context);\n\nexport const Provider = ({ initial, children }) => {\n  const [, updateDummy] = useState(0);\n  const [opencast, updateOpencast] = useState(initial);\n  opencast.updateGlobalOc = (newInstance) => {\n    updateOpencast(newInstance);\n\n    // If the object reference didn't change, we use this dummy state to force a\n    // rerender.\n    if (opencast === newInstance) {\n      updateDummy(old => old + 1);\n    }\n  };\n\n  // This debug output will be useful for future debugging sessions.\n  useEffect(() => {\n    console.debug(\"Current Opencast connection: \", opencast);\n  });\n\n  return (\n    <Context.Provider value={opencast}>\n      {children}\n    </Context.Provider>\n  );\n};\n\nconst escapeString = s => {\n  return new XMLSerializer().serializeToString(new Text(s));\n}\n\nconst dcCatalog = ({ creator, title, seriesId }) => {\n  const seriesLine = seriesId\n    ? `<dcterms:isPartOf>${escapeString(seriesId)}</dcterms:isPartOf>`\n    : '';\n\n  return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <dublincore xmlns=\"http://www.opencastproject.org/xsd/1.0/dublincore/\"\n                xmlns:dcterms=\"http://purl.org/dc/terms/\"\n                xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n        <dcterms:created xsi:type=\"dcterms:W3CDTF\">\n          ${escapeString(new Date(Date.now()).toISOString())}\n        </dcterms:created>\n        <dcterms:creator>${escapeString(creator)}</dcterms:creator>\n        <dcterms:extent xsi:type=\"dcterms:ISO8601\">PT5.568S</dcterms:extent>\n        <dcterms:title>${escapeString(title)}</dcterms:title>\n        <dcterms:spatial>Opencast Studio</dcterms:spatial>\n        ${seriesLine}\n    </dublincore>`;\n}\n\nconst DEFAULT_ACL_TEMPLATE = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<Policy PolicyId=\"mediapackage-1\"\n  RuleCombiningAlgId=\"urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides\"\n  Version=\"2.0\"\n  xmlns=\"urn:oasis:names:tc:xacml:2.0:policy:schema:os\">\n  <Rule RuleId=\"user_read_Permit\" Effect=\"Permit\">\n    <Target>\n      <Actions>\n        <Action>\n          <ActionMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\">\n            <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">read</AttributeValue>\n            <ActionAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:action:action-id\"\n              DataType=\"http://www.w3.org/2001/XMLSchema#string\"/>\n          </ActionMatch>\n        </Action>\n      </Actions>\n    </Target>\n    <Condition>\n      <Apply FunctionId=\"urn:oasis:names:tc:xacml:1.0:function:string-is-in\">\n        <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">{{ userRole }}</AttributeValue>\n        <SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n          DataType=\"http://www.w3.org/2001/XMLSchema#string\"/>\n      </Apply>\n    </Condition>\n  </Rule>\n  <Rule RuleId=\"user_write_Permit\" Effect=\"Permit\">\n    <Target>\n      <Actions>\n        <Action>\n          <ActionMatch MatchId=\"urn:oasis:names:tc:xacml:1.0:function:string-equal\">\n            <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">write</AttributeValue>\n            <ActionAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:1.0:action:action-id\"\n              DataType=\"http://www.w3.org/2001/XMLSchema#string\"/>\n          </ActionMatch>\n        </Action>\n      </Actions>\n    </Target>\n    <Condition>\n      <Apply FunctionId=\"urn:oasis:names:tc:xacml:1.0:function:string-is-in\">\n        <AttributeValue DataType=\"http://www.w3.org/2001/XMLSchema#string\">{{ userRole }}</AttributeValue>\n        <SubjectAttributeDesignator AttributeId=\"urn:oasis:names:tc:xacml:2.0:subject:role\"\n          DataType=\"http://www.w3.org/2001/XMLSchema#string\"/>\n      </Apply>\n    </Condition>\n  </Rule>\n</Policy>\n`;\n","import css from '@emotion/css/macro'\n\nconst GlobalStyle = css`\n* {\n    box-sizing: border-box;\n}\n\nhtml, body, button, input {\n    font-family: Ubuntu, Roboto, \"Open Sans\", \"Segoe UI\", \"Helvetica Neue\", Verdana, sans-serif;\n}\n\nbody {\n    overflow-x: hidden;\n}\n\nlabel, button:not(:disabled) {\n    cursor: pointer;\n}\n\nbutton {\n    outline: none;\n}\n\n#root {\n  height: 100%;\n}\n\n@keyframes pulse {\n  from { opacity: 0.85 }\n  50% { opacity: 0.6 }\n  to { opacity: 0.85 }\n}\n`;\n\nexport default GlobalStyle;\n","import { darken } from '@theme-ui/color';\n\nconst heading = {\n  color: 'text',\n  fontFamily: 'heading',\n  lineHeight: 'heading',\n  fontWeight: 'heading'\n};\n\nconst baseButton = {\n  fontSize: 2,\n  '& svg': {\n    mr: 2\n  },\n  '&:disabled': {\n    bg: 'background',\n    borderColor: 'gray.2',\n    borderWidth: 1,\n    borderStyle: 'solid',\n    color: 'text',\n    cursor: 'not-allowed',\n    opacity: 0.5\n  }\n};\n\nconst base = {\n  breakpoints: ['576px', '768px', '992px', '1200px'],\n  space: [0, 4, 8, 16, 32, 64, 128, 256, 512],\n  fonts: {\n    body: 'Roboto, \"Open Sans\", \"Segoe UI\", \"Helvetica Neue\", Verdana, system-ui, sans-serif',\n    heading: 'Roboto, \"Open Sans\", \"Segoe UI\", \"Helvetica Neue\", Verdana, system-ui, sans-serif',\n    monospace: '\"Roboto Mono\", monospace'\n  },\n  fontSizes: [12, 14, 16, 20, 24, 32, 48, 64, 96],\n  fontWeights: {\n    body: 300,\n    heading: 600,\n    bold: 700,\n  },\n  lineHeights: {\n    body: 1.5,\n    heading: 1.125\n  },\n  heights: {\n    headerHeight: '3em'\n  },\n  colors: {\n    text: '#000',\n    background: '#fff',\n    primary: '#47af7a',\n    secondary: '#30c',\n    muted: '#888888',\n    highlight: '#3498db',\n    error: '#f14668',\n    gray: ['#363636', '#666666', '#aaaaaa', '#dddddd', '#f5f5f5'],\n    videoOverlay: 'rgba(255, 255, 255, 0.2)'\n  },\n  text: {\n    text: {\n      fontWeight: 'body',\n      fontSize: '18px',\n    },\n    heading: {\n      fontWeight: 'heading',\n      fontSize: '18px',\n    },\n  },\n  buttons: {\n    primary: {\n      ...baseButton,\n      bg: 'primary',\n      color: 'background',\n      '&:not(:disabled):hover': {\n        bg: darken('primary', 0.03)\n      },\n      '&:disabled': {\n        bg: 'gray.1'\n      },\n    },\n    danger: {\n      ...baseButton,\n      bg: 'error',\n      color: 'background',\n      '&:not(:disabled):hover': {\n        bg: darken('error', 0.03)\n      }\n    },\n    text: {\n      ...baseButton,\n      bg: 'background',\n      color: 'text',\n      border: theme => `1px solid ${theme.colors.gray[1]}`,\n      '&:not(:disabled):hover': {\n        bg: 'gray.3'\n      }\n    }\n  },\n  cards: {\n    primary: {\n      bg: 'background',\n      boxShadow: '0 0.5em 1em -0.125em rgba(10, 10, 10, 0.1), 0 0px 0 1px rgba(10, 10, 10, 0.02)',\n      color: 'text',\n      maxWidth: '100%',\n      position: 'relative'\n    }\n  },\n  styles: {\n    root: {\n      fontFamily: 'body',\n      lineHeight: 'body',\n      fontWeight: 'body'\n    },\n    h1: {\n      ...heading,\n      mt: 0,\n      mb: 3,\n      fontSize: 5,\n    },\n    h2: {\n      ...heading,\n      fontSize: 4\n    },\n    h3: {\n      ...heading,\n      fontSize: 3\n    },\n    h4: {\n      ...heading,\n      fontSize: 2\n    },\n    h5: {\n      ...heading,\n      fontSize: 1\n    },\n    h6: {\n      ...heading,\n      fontSize: 0\n    },\n    p: {\n      color: 'text',\n      fontFamily: 'body',\n      fontWeight: 'body',\n      lineHeight: 'body'\n    },\n    a: {\n      color: 'primary'\n    },\n    pre: {\n      fontFamily: 'monospace',\n      overflowX: 'auto',\n      code: {\n        color: 'inherit'\n      }\n    },\n    code: {\n      fontFamily: 'monospace',\n      fontSize: 'inherit'\n    },\n    table: {\n      width: '100%',\n      borderCollapse: 'separate',\n      borderSpacing: 0\n    },\n    th: {\n      textAlign: 'left',\n      borderBottomStyle: 'solid'\n    },\n    td: {\n      textAlign: 'left',\n      borderBottomStyle: 'solid'\n    },\n    img: {\n      maxWidth: '100%'\n    },\n    input: {\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: 'gray.2',\n      height: '2rem',\n      fontSize: '14pt',\n      borderRadius: 2,\n      px: 2,\n      py: 0,\n      outline: 'none',\n      transition: 'border-color 0.3s, box-shadow 0.3s',\n      width: '100%',\n      '&:focus': {\n        borderColor: 'primary',\n        boxShadow: theme => `0 0 3px 0 ${theme.colors.primary}`\n      },\n      '&[aria-invalid=\"true\"]': {\n        borderColor: 'error',\n        boxShadow: theme => `0 0 3px 0 ${theme.colors.error}`\n      }\n    },\n    select: {\n      height: '2rem',\n      fontSize: '14pt',\n      outline: 'none',\n      transition: 'border-color 0.3s, box-shadow 0.3s',\n      width: '100%',\n      '&:focus': {\n        borderColor: 'primary',\n        boxShadow: theme => `0 0 3px 0 ${theme.colors.primary}`\n      }\n    },\n    progress: {\n      bg: '#ebebeb',\n      color: '#4ab57f',\n      height: '8px',\n    }\n  },\n  container: {\n    mx: 'auto',\n    p: 3,\n    maxWidth: ['none', 'none', 960, 1152, 1344]\n  }\n};\n\nexport default base;\n","import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nimport enTranslations from './locales/en.json';\nimport deTranslations from './locales/de.json';\nimport elTranslations from './locales/el.json';\nimport esTranslations from './locales/es.json';\nimport faTranslations from './locales/fa.json';\nimport frTranslations from './locales/fr.json';\nimport nlTranslations from './locales/nl.json';\nimport trTranslations from './locales/tr.json';\n\nconst resources = {\n  en: { translation: enTranslations },\n  de: { translation: deTranslations },\n  el: { translation: elTranslations },\n  es: { translation: esTranslations },\n  fa: { translation: faTranslations },\n  fr: { translation: frTranslations },\n  nl: { translation: nlTranslations },\n  tr: { translation: trTranslations }\n};\n\ni18n\n  .use(initReactI18next)\n  .use(LanguageDetector)\n  .init({\n    resources,\n    fallbackLng: 'en',\n\n    keySeparator: false,\n\n    interpolation: {\n      escapeValue: false\n    },\n\n    detection: {\n      order: ['localStorage', 'navigator'],\n    }\n  });\n\nexport default i18n;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","//; -*- mode: rjsx;-*-\n/** @jsx jsx */\nimport { jsx, ThemeProvider } from 'theme-ui';\n\nimport { Global } from '@emotion/core';\nimport * as Sentry from '@sentry/browser';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport GlobalStyle from './style/global-style';\nimport theme from './theme';\n\nimport './i18n';\nimport * as serviceWorker from './serviceWorker';\nimport { SettingsManager, Provider as SettingsProvider } from './settings';\nimport { Opencast, Provider as OpencastProvider } from './opencast';\nimport { userHasWebcam } from './util';\n\nif (process.env.REACT_APP_ENABLE_SENTRY === '1') {\n  Sentry.init({ dsn: 'https://66e6b4dc3d59463fa34272abcb5da6b1@sentry.virtuos.uos.de/4' });\n}\n\n// Load the rest of the application and try to fetch the `settings.json`.\nconst initialize = Promise.all([\n  // Load rest of the application code\n  import('./App').then(mod => mod.default),\n\n  // Check for camera devices\n  userHasWebcam(),\n\n  // Load the settings and initialize Opencast\n  SettingsManager.init().then(async settingsManager => {\n    const oc = await Opencast.init(settingsManager.settings().opencast);\n    return [settingsManager, oc];\n  }),\n]);\n\nconst render = body => {\n  ReactDOM.render(body, document.getElementById('root'));\n};\n\n// After the initialization is done, render to the root element.\ninitialize.then(\n  ([App, userHasWebcam, [settingsManager, opencast]]) => {\n    render(\n      <React.StrictMode>\n        <ThemeProvider theme={theme}>\n          <Global styles={GlobalStyle} />\n          <OpencastProvider initial={opencast}>\n            <SettingsProvider settingsManager={settingsManager}>\n              <App settingsManager={settingsManager} userHasWebcam={userHasWebcam} />\n            </SettingsProvider>\n          </OpencastProvider>\n        </ThemeProvider>\n      </React.StrictMode>\n     );\n  },\n\n  // This error case is vey unlikely to occur.\n  e => render(<p>\n    {`Fatal error while loading app: ${e.message}`}\n    <br />\n    This might be caused by a incorrect configuration by the system administrator.\n  </p>),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}